<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<Meta name="ExplicitAutoJoints">true</Meta>
	<External>null</External>
	<External>nil</External>
	<Item class="Folder" referent="RBX4CBC7403E794418496CC954875BC0DE9">
		<Properties>
			<BinaryString name="AttributesSerialize"></BinaryString>
			<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
			<bool name="DefinesCapabilities">false</bool>
			<string name="Name">PlayerInfo</string>
			<int64 name="SourceAssetId">-1</int64>
			<BinaryString name="Tags"></BinaryString>
		</Properties>
		<Item class="Folder" referent="RBX9179B8290F7649448C4570FA20BE7940">
			<Properties>
				<BinaryString name="AttributesSerialize"></BinaryString>
				<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
				<bool name="DefinesCapabilities">false</bool>
				<string name="Name">ReplicatedStorage</string>
				<int64 name="SourceAssetId">-1</int64>
				<BinaryString name="Tags"></BinaryString>
			</Properties>
			<Item class="Folder" referent="RBX5B5B3B0EC09E4A18993784D9BFF780EF">
				<Properties>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">Configs</string>
					<int64 name="SourceAssetId">-1</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
				<Item class="ModuleScript" referent="RBX7AB9E13F41BF4F75943A19E7D3829319">
					<Properties>
						<Content name="LinkedSource"><null></null></Content>
						<ProtectedString name="Source"><![CDATA[
--//========================================================
--// StatsConfig (ReplicatedStorage)
--// Module for configuring UI data across stats/collectables.
--//========================================================

local CollectableOverrides = {
	["NoobFedora"] = {
		Name = "Noob Fedora",
		Description = "A classic hat from the earliest days of Roblox.",
		Tagline = "OG drip for true collectors.",
		Rarity = "Common",
		Highlights = { "Starter Item", "Legacy", "Cosmetic" },
	},
	["Snowman"] = {
		Name = "Snowman",
		Description = "A frosty friend that only appears when the chill sets in.",
		Tagline = "Built from pure winter magic.",
		Rarity = "Rare",
		Highlights = { "Seasonal", "Chilly", "Snowbound" },
	},
	["Sword"] = {
		Name = "Sword",
		Description = "An ancient blade forged for heroes who brave the darkest paths.",
		Tagline = "Legendary steel, timeless edge.",
		Rarity = "Legendary",
		Highlights = { "Mythic", "Weapon", "Heroic" },
	},
	["LuckyClover"] = {
		Name = "LuckyClover",
		Description = "An ancient blade forged for heroes who brave the darkest paths.",
		Tagline = "Legendary steel, timeless edge.",
		Rarity = "Legendary",
		Highlights = { "Mythic", "Weapon", "Heroic" },
	},
	["RubiksCube"] = {
		Name = "RubiksCube",
		Description = "An ancient blade forged for heroes who brave the darkest paths.",
		Tagline = "Legendary steel, timeless edge.",
		Rarity = "Epic",
		Highlights = { "Mythic", "Weapon", "Heroic" },
	},
	-- Add more overrides using CollectableId keys to customize rarity,
	-- descriptions, taglines, accent colors, and highlights.
}

local StatsConfig = {
	Levels = {
		StatSourceMode = "Leaderstats",
		XPPerLevel = 1000,
		XPPerMinute = 60,
		AttachToLeaderstats = true,
		CreateLeaderstatsIfMissing = false,
		LeaderstatsWaitSeconds = 10,
		Leaderstats = {
			XP = "XP",
			PlaytimeSeconds = "PlaytimeSeconds",
		},
		DataStoreName = "PlayerCardLevelDataV1",
	},
	Collectables = {
		RightPanel = {
			Title = "COLLECTABLE DETAILS",
			Empty = {
				Title = "Choose a Collectable",
				Body = "Select a collectable on the left to view its story, rarity, and highlights.",
			},
			Locked = {
				Title = "Collectable Locked",
				Body = "You haven't collected this yet. Find it in-game to unlock its details.",
			},
			HighlightsTitle = "Highlights",
		},
		Status = {
			CollectedLabel = "COLLECTED",
			MissingLabel = "MISSING",
			RarityPrefix = "RARITY: ",
			DescriptionFallback = "No description set.",
		},
		Items = CollectableOverrides,
	},
}

return StatsConfig]]></ProtectedString>
						<string name="ScriptGuid">{CD6896BF-E2BA-44A7-95BB-65DA1179BE94}</string>
						<BinaryString name="AttributesSerialize"></BinaryString>
						<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
						<bool name="DefinesCapabilities">false</bool>
						<string name="Name">StatConfig</string>
						<int64 name="SourceAssetId">-1</int64>
						<BinaryString name="Tags"></BinaryString>
					</Properties>
				</Item>
				<Item class="ModuleScript" referent="RBX1D4E3FD5157345F79CA8956152EB6A49">
					<Properties>
						<Content name="LinkedSource"><null></null></Content>
						<ProtectedString name="Source"><![CDATA[
--//========================================================
--// TitlesConfig (ReplicatedStorage)
--// Configure titles shown in PlayerCard UI.
--//========================================================

return {
	Titles = {
		{ Id = "Rookie", Name = "Rookie", Desc = "First steps into the world.", Rarity = "Common", RequiredLevel = 1 },
		{ Id = "RisingStar", Name = "Rising Star", Desc = "Shows consistent progress.", Rarity = "Uncommon", RequiredLevel = 3 },
		{ Id = "NightRunner", Name = "Night Runner", Desc = "Survive a full night without sprinting.", Rarity = "Rare", RequiredLevel = 5 },
		{ Id = "NoSignal", Name = "No Signal", Desc = "Complete the map with no flashlight.", Rarity = "Rare", RequiredLevel = 7 },
		{ Id = "ColdHands", Name = "Cold Hands", Desc = "Find the Black Sigil.", Rarity = "Epic", RequiredLevel = 10 },
		{ Id = "GrindLord", Name = "Grind Lord", Desc = "Keep pushing no matter what.", Rarity = "Epic", RequiredLevel = 12 },
		{ Id = "IronWill", Name = "Iron Will", Desc = "Never back down, never break.", Rarity = "Epic", RequiredLevel = 15 },
		{ Id = "LegendBorn", Name = "Legend Born", Desc = "A name whispered across servers.", Rarity = "Legendary", RequiredLevel = 18 },
		{ Id = "ShadowCrown", Name = "Shadow Crown", Desc = "Power in silence, victory in shadows.", Rarity = "Legendary", RequiredLevel = 22 },
		{ Id = "WorldEater", Name = "World Eater", Desc = "At the peak of mastery.", Rarity = "Legendary", RequiredLevel = 25 },
	},
}]]></ProtectedString>
						<string name="ScriptGuid">{D0B1F9A8-9D63-4D31-A1A6-412E3A75B0F2}</string>
						<BinaryString name="AttributesSerialize"></BinaryString>
						<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
						<bool name="DefinesCapabilities">false</bool>
						<string name="Name">TitlesConfig</string>
						<int64 name="SourceAssetId">-1</int64>
						<BinaryString name="Tags"></BinaryString>
					</Properties>
				</Item>
				<Item class="ModuleScript" referent="RBX728C1102476C4503A67B9A38F0A9B675">
					<Properties>
						<Content name="LinkedSource"><null></null></Content>
						<ProtectedString name="Source"><![CDATA[--// Modern Premium Shop Configuration
--// Clean, professional design with subtle rarity indicators

local ShopConfig = {}

--// Shop Header + Input Configuration
ShopConfig.ShopName = "SHOP"
ShopConfig.ShopSubtitle = "Ned make the map"
ShopConfig.EnableKeybind = true
ShopConfig.ShopKeybind = Enum.KeyCode.B

--// Background Image Configuration
ShopConfig.BackgroundImageId = "rbxassetid://151822810"
ShopConfig.ItemsPanelPatternImageId = "rbxassetid://126294497128009"
-- Pattern tiling size (smaller = more tiles covering the panel)
-- Example: 80 = lots of pattern, 160 = medium, 240 = huge (your current)
ShopConfig.ItemsPanelPatternTileSize = 80
ShopConfig.ItemsPanelPatternTransparency = 0.5





--// Rarity System Configuration - Subtle stroke colors only
ShopConfig.Rarities = {
	Common = {
		StrokeColor = Color3.fromRGB(120, 120, 120),
		StrokeTransparency = 0.3
	},
	Uncommon = {
		StrokeColor = Color3.fromRGB(100, 180, 100),
		StrokeTransparency = 0.4
	},
	Rare = {
		StrokeColor = Color3.fromRGB(100, 140, 200),
		StrokeTransparency = 0.3
	},
	Epic = {
		StrokeColor = Color3.fromRGB(160, 100, 200),
		StrokeTransparency = 0.25
	},
	Legendary = {
		StrokeColor = Color3.fromRGB(200, 160, 80),
		StrokeTransparency = 0.2
	},
	Cursed = {
		StrokeColor = Color3.fromRGB(157, 0, 21),
		StrokeTransparency = 0.2
	}
}

--// Shop Items Configuration
ShopConfig.Items = {

	-- BASIC / ESSENTIAL
	{
		DisplayName = "Flashlight",
		Description = "A standard handheld light. Reliable, simple, and better than the dark.",
		Price = 200,
		ImageId = "rbxassetid://102461996",
		ToolName = "Flashlight",
		Rarity = "Common"
	},

	{
		DisplayName = "Glow Stick",
		Description = "A weak disposable light that slowly fades. Useful when you don‚Äôt want to be seen holding a flashlight.",
		Price = 120,
		ImageId = "rbxassetid://104320110176326",
		ToolName = "GlowStick",
		Rarity = "Common"
	},

	{
		DisplayName = "Watch",
		Description = "Shows the current time. Nights feel longer when you know exactly how much remains.",
		Price = 150,
		ImageId = "rbxassetid://96714408085433",
		ToolName = "Watch",
		Rarity = "Uncommon"
	},

	{
		DisplayName = "Energy Drink",
		Description = "A quick boost of energy that increases movement speed for a short time. The crash comes fast.",
		Price = 300,
		ImageId = "rbxassetid://7203369576",
		ToolName = "EnergyDrink",
		Rarity = "Uncommon"
	},
	
	{
		DisplayName = "Medkit",
		Description = "Heal up fast.",
		Price = 300,
		ImageId = "rbxassetid://10315308789",
		ToolName = "Medkit",
		Rarity = "Uncommon"
	},

	-- IMPROVED VISIBILITY
	{
		DisplayName = "Advanced Flashlight",
		Description = "Brighter and more focused. Cuts through darkness faster, but drains quicker.",
		Price = 400,
		ImageId = "rbxassetid://102381306",
		ToolName = "AdvancedFlashlight",
		Rarity = "Rare"
	},

	-- DETECTION / AWARENESS
	{
		DisplayName = "Radar",
		Description = "Emits a pulsing signal that reacts to nearby movement. Not always accurate.",
		Price = 500,
		ImageId = "rbxassetid://18589427822",
		ToolName = "Radar",
		Rarity = "Rare"
	},

	{
		DisplayName = "Advanced Radar",
		Description = "Enhanced signal strength with faster feedback. False readings still occur.",
		Price = 750,
		ImageId = "rbxassetid://62183012",
		ToolName = "AdvancedRadar",
		Rarity = "Epic"
	},

	-- DISTRACTION / AREA CONTROL
	{
		DisplayName = "Noise Decoy",
		Description = "A small device that emits mechanical noise after being thrown. It won‚Äôt save you, but it might buy time.",
		Price = 650,
		ImageId = "rbxassetid://107065880",
		ToolName = "NoiseDecoy",
		Rarity = "Epic"
	},

	{
		DisplayName = "Fog Canister",
		Description = "Releases a thick cloud of fog that obscures vision. Useful for escaping‚Äîor hiding mistakes.",
		Price = 700,
		ImageId = "rbxassetid://92809005659269",
		ToolName = "Fog Canister",
		Rarity = "Epic"
	},

	-- POWER / ENVIRONMENT
	{
		DisplayName = "Portable Generator",
		Description = "Temporarily restores power in nearby areas. Loud, unstable, and impossible to ignore.",
		Price = 1000,
		ImageId = "rbxassetid://13321880274",
		ToolName = "PortableGenerator",
		Rarity = "Legendary"
	},

	-- AI
	{
		DisplayName = "Containment Relay",
		Description = "A last-resort suppression system. Consumes power to temporarily reduce the threat‚Äôs aggression.",
		Price = 1400,
		ImageId = "rbxassetid://11903551487",
		ToolName = "ContainmentRelay",
		Rarity = "Legendary"
	},

	-- CURSED ITEMS (RARE SHOP APPEARANCE)
	{
		DisplayName = "Blood Coin",
		Description = "Doubles earnings for the night. The cost is paid in comfort, not money.",
		Price = 1200,
		ImageId = "rbxassetid://92405101544544",
		ToolName = "BloodCoin",
		Rarity = "Cursed"
	},

	{
		DisplayName = "Watcher‚Äôs Eye",
		Description = "Heightens awareness beyond normal limits. Sometimes it notices things that aren‚Äôt there.",
		Price = 1350,
		ImageId = "rbxassetid://92127531345008",
		ToolName = "WatchersEye",
		Rarity = "Cursed"
	},

	{
		DisplayName = "Totem of Undying",
		Description = "Prevents death once. What happens after is never clean.",
		Price = 1600,
		ImageId = "rbxassetid://8228195722",
		ToolName = "Totem of Undying",
		Rarity = "Cursed"
	},

	{
		DisplayName = "Cursed Artifact",
		Description = "Grants a powerful benefit at night. The side effects are unpredictable.",
		Price = 1800,
		ImageId = "rbxassetid://6603730449",
		ToolName = "CursedArtifact",
		Rarity = "Cursed"
	}

}

--// Sound Configuration
ShopConfig.Sounds = {
	SuccessSound = "rbxassetid://3997124966",
	FailSound = "rbxassetid://2390695935",

	OpenSound = "rbxassetid://89842591486388",   -- <‚Äî set
	CloseSound = "rbxassetid://89842591486388",  -- <‚Äî set
	HoverSound = "rbxassetid://139800881181209",   -- <‚Äî set (item card hover)

	-- Hover sound behavior configuration
	PlayOnHover = false,   -- Play sound when hovering over item cards
	PlayOnClick = true     -- Play sound when clicking on item cards
}


--// Modern UI Configuration
ShopConfig.UI = {
	-- Neutral color palette
	PrimaryColor = Color3.fromRGB(20, 20, 25),
	SecondaryColor = Color3.fromRGB(30, 30, 35),
	TertiaryColor = Color3.fromRGB(40, 40, 45),
	CardColor = Color3.fromRGB(35, 35, 40),
	CardHoverColor = Color3.fromRGB(40, 40, 45),
	ButtonColor = Color3.fromRGB(45, 45, 50),
	ButtonHoverColor = Color3.fromRGB(55, 55, 60),
	AccentColor = Color3.fromRGB(100, 200, 100),
	TextColor = Color3.fromRGB(240, 240, 240),
	SecondaryTextColor = Color3.fromRGB(180, 180, 180),
	PriceColor = Color3.fromRGB(255, 200, 100),

	-- Buy Button Styling
	BuyButton = {
		NormalColor = Color3.fromRGB(180, 180, 190), -- Silver base
		HoverColor = Color3.fromRGB(200, 200, 210), -- Lighter silver on hover
		SuccessColor = Color3.fromRGB(80, 180, 80), -- Green for owned
		FailColor = Color3.fromRGB(220, 80, 80), -- Red for insufficient funds
		TextColor = Color3.fromRGB(40, 40, 45), -- Dark text for contrast
		SuccessTextColor = Color3.fromRGB(255, 255, 255), -- White text for success
		FailTextColor = Color3.fromRGB(255, 255, 255), -- White text for fail
		Size = UDim2.new(0.35, 0, 0.75, 0), -- Slightly smaller and more proportional
		CornerRadius = 6, -- More subtle corner radius
		StrokeTransparency = 0.7 -- Subtle stroke
	},

	-- Modern sizing
	CardSize = UDim2.new(0, 200, 0, 240),
	ButtonSize = UDim2.new(0, 120, 0, 36),
	ImageSize = UDim2.new(0, 120, 0, 120),

	-- Subtle effects
	StrokeThickness = 1,
	ShadowOffset = Vector2.new(2, 2),
	ShadowSize = Vector2.new(0, 6),
	CornerRadius = 12,

	-- Clean animations
	TweenSpeed = 0.25,
	HoverScale = 1.02,
	ClickScale = 0.98
}

return ShopConfig]]></ProtectedString>
						<string name="ScriptGuid">{27051582-6142-4111-94F4-931757FBC1D3}</string>
						<BinaryString name="AttributesSerialize"></BinaryString>
						<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
						<bool name="DefinesCapabilities">false</bool>
						<string name="Name">ShopConfig</string>
						<int64 name="SourceAssetId">-1</int64>
						<BinaryString name="Tags"></BinaryString>
					</Properties>
				</Item>
			</Item>
		</Item>
		<Item class="Folder" referent="RBXD5EC7370F1AA41F48F887C1D47A07595">
			<Properties>
				<BinaryString name="AttributesSerialize"></BinaryString>
				<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
				<bool name="DefinesCapabilities">false</bool>
				<string name="Name">ServerScriptService</string>
				<int64 name="SourceAssetId">-1</int64>
				<BinaryString name="Tags"></BinaryString>
			</Properties>
			<Item class="Script" referent="RBXEBCF48BF37F4416CBF615453C4B77E6B">
				<Properties>
					<ProtectedString name="Source"><![CDATA[--// TitlesService.server.lua
--// ServerScriptService - handles title equip requests

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local DataStoreService = game:GetService("DataStoreService")

local function loadStatsConfig()
	local configFolder = ReplicatedStorage:FindFirstChild("Configs")
	local module = configFolder and configFolder:FindFirstChild("StatsConfig") or ReplicatedStorage:FindFirstChild("StatsConfig")
	if not module then
		module = configFolder and configFolder:FindFirstChild("StatConfig") or ReplicatedStorage:FindFirstChild("StatConfig")
	end
	if not module then
		module = configFolder and configFolder:WaitForChild("StatsConfig", 3) or ReplicatedStorage:WaitForChild("StatsConfig", 3)
	end
	if not module then
		module = configFolder and configFolder:WaitForChild("StatConfig", 3) or ReplicatedStorage:WaitForChild("StatConfig", 3)
	end

	if module then
		local ok, result = pcall(require, module)
		if ok and typeof(result) == "table" then
			return result
		end
	end

	warn("[TitlesService] StatsConfig not found or failed to load; using defaults.")
	return {}
end

local function loadTitlesConfig()
	local configFolder = ReplicatedStorage:FindFirstChild("Configs")
	local module = configFolder and configFolder:FindFirstChild("TitlesConfig") or ReplicatedStorage:FindFirstChild("TitlesConfig")
	if not module then
		module = configFolder and configFolder:WaitForChild("TitlesConfig", 3) or ReplicatedStorage:WaitForChild("TitlesConfig", 3)
	end

	if module then
		local ok, result = pcall(require, module)
		if ok and typeof(result) == "table" then
			return result
		end
	end

	warn("[TitlesService] TitlesConfig not found or failed to load; using defaults.")
	return { Titles = {} }
end

local StatsConfig = loadStatsConfig()
local LevelConfig = StatsConfig.Levels or {}
local leaderConfig = LevelConfig.Leaderstats or {}
local XP_PER_LEVEL = LevelConfig.XPPerLevel or 1000
local LEADERSTAT_XP_NAME = leaderConfig.XP or "XP"

local TitlesConfig = loadTitlesConfig()
local titlesStore = DataStoreService:GetDataStore("PlayerEquippedTitles_v1")

local titlesById = {}
for _, title in ipairs(TitlesConfig.Titles or {}) do
	if title and title.Id then
		titlesById[title.Id] = title
	end
end

local function computeLevel(totalXP: number): number
	totalXP = math.max(0, math.floor(totalXP))
	return math.floor(totalXP / XP_PER_LEVEL) + 1
end

local function getPlayerXP(player: Player): number
	local leaderstats = player:FindFirstChild("leaderstats")
	if not leaderstats then
		return 0
	end
	local xpValue = leaderstats:FindFirstChild(LEADERSTAT_XP_NAME)
	if xpValue and xpValue:IsA("IntValue") then
		return xpValue.Value
	end
	return 0
end

local function ensureRemotes()
	local remotes = ReplicatedStorage:FindFirstChild("TitlesRemotes")
	if not remotes then
		remotes = Instance.new("Folder")
		remotes.Name = "TitlesRemotes"
		remotes.Parent = ReplicatedStorage
	end

	local equipEvent = remotes:FindFirstChild("EquipTitle")
	if not equipEvent then
		equipEvent = Instance.new("RemoteEvent")
		equipEvent.Name = "EquipTitle"
		equipEvent.Parent = remotes
	end

	return equipEvent
end

local equipEvent = ensureRemotes()

local function loadEquippedTitle(player: Player)
	local ok, saved = pcall(function()
		return titlesStore:GetAsync(player.UserId)
	end)
	if not ok then
		warn("[TitlesService] Failed to load equipped title for", player.UserId)
		return
	end
	if typeof(saved) == "string" and saved ~= "" then
		local title = titlesById[saved]
		if title then
			player:SetAttribute("EquippedTitle", saved)
		end
	end
end

local function saveEquippedTitle(player: Player, titleId: string)
	local ok = pcall(function()
		return titlesStore:SetAsync(player.UserId, titleId)
	end)
	if not ok then
		warn("[TitlesService] Failed to save equipped title for", player.UserId)
	end
end

Players.PlayerAdded:Connect(function(player: Player)
	loadEquippedTitle(player)
end)

equipEvent.OnServerEvent:Connect(function(player: Player, titleId: string)
	if typeof(titleId) ~= "string" then
		return
	end

	if titleId == "" then
		player:SetAttribute("EquippedTitle", "")
		saveEquippedTitle(player, "")
		return
	end

	local title = titlesById[titleId]
	if not title then
		warn("[TitlesService] Invalid title id requested:", titleId)
		return
	end

	local xp = getPlayerXP(player)
	local level = computeLevel(xp)
	local requiredLevel = tonumber(title.RequiredLevel) or 0

	if level < requiredLevel then
		return
	end

	player:SetAttribute("EquippedTitle", titleId)
	saveEquippedTitle(player, titleId)
end)

print("[TitlesService] Titles equip service running.")
]]></ProtectedString>
					<bool name="Disabled">false</bool>
					<Content name="LinkedSource"><null></null></Content>
					<token name="RunContext">0</token>
					<string name="ScriptGuid">{E388265E-9A6F-47B6-81F8-2B34340A60D9}</string>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">TitlesService</string>
					<int64 name="SourceAssetId">-1</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
			</Item>
			<Item class="Script" referent="RBXC5E7B204D5DD49AD8DE6ED7F9CEBBA82">
				<Properties>
					<ProtectedString name="Source"><![CDATA[--// Shop Purchase Handler
--// Secure server-side purchase logic

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local ServerStorage = game:GetService("ServerStorage")

--// Create RemoteEvent for purchases
local purchaseEvent = Instance.new("RemoteEvent")
purchaseEvent.Name = "ShopPurchase"
purchaseEvent.Parent = ReplicatedStorage

--// Shop Configuration
local ShopConfig = require(ReplicatedStorage:WaitForChild("Configs"):WaitForChild("ShopConfig"))

--// Function to validate and process purchase
local function processPurchase(player, toolName, price)
	-- Validate player
	if not player or not player.Parent then
		warn("Invalid player in purchase request")
		return false, "Invalid player"
	end
	
	-- Get player's cash
	local leaderstats = player:FindFirstChild("leaderstats")
	if not leaderstats then
		return false, "No leaderstats found"
	end
	
	local cash = leaderstats:FindFirstChild("Cash")
	if not cash then
		return false, "No cash stat found"
	end
	
	-- Check if player has enough cash
	if cash.Value < price then
		return false, "Insufficient funds"
	end
	
	-- Find the tool in ServerStorage
	local toolsFolder = ServerStorage:FindFirstChild("Tools")
	if not toolsFolder then
		warn("Tools folder not found in ServerStorage")
		return false, "Shop configuration error"
	end
	
	local tool = toolsFolder:FindFirstChild(toolName)
	if not tool then
		warn("Tool not found: " .. toolName)
		return false, "Tool not available"
	end
	
	-- Check if player already has this tool
	local backpack = player:FindFirstChild("Backpack")
	if backpack then
		for _, item in ipairs(backpack:GetChildren()) do
			if item.Name == toolName then
				return false, "You already own this tool"
			end
		end
	end
	
	-- Process the purchase
	cash.Value = cash.Value - price
	
	-- Clone and give the tool to player
	local toolClone = tool:Clone()
	local backpack = player:WaitForChild("Backpack")
	toolClone.Parent = backpack
	
	print("‚úÖ " .. player.Name .. " purchased " .. toolName .. " for $" .. price)
	return true, "Purchase successful!"
end

--// Handle purchase requests
purchaseEvent.OnServerEvent:Connect(function(player, toolName)
	-- Validate input parameters
	if type(toolName) ~= "string" then
		warn("Invalid purchase parameters from " .. player.Name)
		return
	end
	
	-- Find the item in config to get the correct price
	local itemData = nil
	for _, item in ipairs(ShopConfig.Items) do
		if item.ToolName == toolName then
			itemData = item
			break
		end
	end
	
	if not itemData then
		warn("Invalid item from " .. player.Name .. ": " .. toolName)
		return
	end
	
	-- Process the purchase using server-side price
	local success, message = processPurchase(player, toolName, itemData.Price)
	
	-- Send result back to client
	local resultEvent = ReplicatedStorage:FindFirstChild("ShopPurchaseResult")
	if resultEvent then
		resultEvent:FireClient(player, success, message, toolName)
	end
end)

--// Create result event for client feedback
local resultEvent = Instance.new("RemoteEvent")
resultEvent.Name = "ShopPurchaseResult"
resultEvent.Parent = ReplicatedStorage

print("üõí Shop purchase handler initialized")]]></ProtectedString>
					<bool name="Disabled">false</bool>
					<Content name="LinkedSource"><null></null></Content>
					<token name="RunContext">0</token>
					<string name="ScriptGuid">{CC06D845-BDB5-4184-A978-AD82237E87FC}</string>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">ShopHandler</string>
					<int64 name="SourceAssetId">-1</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
			</Item>
			<Item class="Script" referent="RBXA6FF2325AE674B1C97FB651F1EB80146">
				<Properties>
					<ProtectedString name="Source"><![CDATA[--// LevelDataService.server.lua
	--// ServerScriptService - persists XP + Playtime leaderstats for PlayerCard UI

local Players = game:GetService("Players")
local DataStoreService = game:GetService("DataStoreService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local DataStoreService = game:GetService("DataStoreService")

local WEEK_SECONDS = 60 * 60 * 24 * 7
local ADMIN_USER_IDS = {
	-- Add your UserIds here for rollback commands (example: 123456789)
}

local function loadStatsConfig()
	local configFolder = ReplicatedStorage:FindFirstChild("Configs")
	local module = configFolder and configFolder:FindFirstChild("StatsConfig") or ReplicatedStorage:FindFirstChild("StatsConfig")
	if not module then
		module = configFolder and configFolder:FindFirstChild("StatConfig") or ReplicatedStorage:FindFirstChild("StatConfig")
	end
	if not module then
		module = configFolder and configFolder:WaitForChild("StatsConfig", 3) or ReplicatedStorage:WaitForChild("StatsConfig", 3)
	end
	if not module then
		module = configFolder and configFolder:WaitForChild("StatConfig", 3) or ReplicatedStorage:WaitForChild("StatConfig", 3)
	end

	if module then
		local ok, result = pcall(require, module)
		if ok and typeof(result) == "table" then
			return result
		end
	end

	warn("[LevelDataService] StatsConfig not found or failed to load; using defaults.")
	return {}
end

local StatsConfig = loadStatsConfig()
local LevelConfig = StatsConfig.Levels or {}
local leaderConfig = LevelConfig.Leaderstats or {}

local STAT_SOURCE_MODE = LevelConfig.StatSourceMode or "Leaderstats"
local XP_PER_MINUTE = LevelConfig.XPPerMinute or 250
local XP_PER_SECOND = XP_PER_MINUTE / 60
local DATASTORE_NAME = LevelConfig.DataStoreName or "PlayerCardLevelDataV1"
local XP_STAT_NAME = leaderConfig.XP or "XP"
local PLAYTIME_STAT_NAME = leaderConfig.PlaytimeSeconds or "PlaytimeSeconds"
local ATTACH_TO_LEADERSTATS = (LevelConfig.AttachToLeaderstats ~= false)
local CREATE_LEADERSTATS_IF_MISSING = (LevelConfig.CreateLeaderstatsIfMissing == true)
local LEADERSTATS_WAIT_SECONDS = LevelConfig.LeaderstatsWaitSeconds or 10

local store = DataStoreService:GetDataStore(DATASTORE_NAME)
local backupStore = DataStoreService:GetDataStore(DATASTORE_NAME .. "_Backups")
local registryStore = DataStoreService:GetOrderedDataStore(DATASTORE_NAME .. "_Registry")
local auditStore = DataStoreService:GetDataStore(DATASTORE_NAME .. "_AuditLog")

local sessions = {}
local pendingConnections = {}

local function getWeekId(timeValue: number): number
	return math.floor(timeValue / WEEK_SECONDS)
end

local function registerPlayer(player: Player)
	local userId = tostring(player.UserId)
	local success, err = pcall(function()
		registryStore:SetAsync(userId, os.time())
	end)
	if not success then
		warn("[LevelDataService] Failed to register userId " .. userId .. ": " .. tostring(err))
	end
end

local function logAdminAction(adminId: number, action: string, details: {[string]: any}?)
	local entry = {
		AdminId = adminId,
		Action = action,
		Details = details or {},
		Timestamp = os.time(),
	}
	local success, err = pcall(function()
		auditStore:SetAsync(tostring(adminId) .. ":" .. tostring(os.time()), entry)
	end)
	if not success then
		warn("[LevelDataService] Failed to write audit log: " .. tostring(err))
	end
end

local function getOrCreateInt(parent: Instance, name: string)
	local value = parent:FindFirstChild(name)
	if value and value:IsA("IntValue") then
		return value
	end
	if value then
		value:Destroy()
	end
	value = Instance.new("IntValue")
	value.Name = name
	value.Value = 0
	value.Parent = parent
	return value
end

local function loadData(player: Player)
	local key = "player_" .. player.UserId
	local success, data = pcall(function()
		return store:GetAsync(key)
	end)
	if success and typeof(data) == "table" then
		return data
	end
	return { XP = 0, PlaytimeSeconds = 0, LastBackupWeek = nil }
end

local function saveData(player: Player)
	local record = sessions[player]
	if not record then return end

	local key = "player_" .. player.UserId
	local payload = {
		XP = record.xp.Value,
		PlaytimeSeconds = record.playtime.Value,
		LastBackupWeek = player:GetAttribute("LevelDataLastBackupWeek"),
	}

	local success, err = pcall(function()
		store:SetAsync(key, payload)
	end)

	if not success then
		warn("[LevelDataService] Failed saving data for", player.Name, err)
	end

	local function saveWeeklyBackup()
		local weekId = getWeekId(os.time())
		local attrName = "LevelDataLastBackupWeek"
		local lastWeek = player:GetAttribute(attrName)
		if lastWeek == weekId then
			return
		end
		local backupKey = tostring(player.UserId) .. ":" .. tostring(weekId)
		local backupSuccess, backupErr = pcall(function()
			backupStore:SetAsync(backupKey, payload)
		end)
		if backupSuccess then
			player:SetAttribute(attrName, weekId)
		else
			warn("[LevelDataService] Failed weekly backup for " .. player.Name .. ": " .. tostring(backupErr))
		end
	end

	saveWeeklyBackup()
end

local function resolveLeaderstats(player: Player)
	if not ATTACH_TO_LEADERSTATS then
		return nil
	end

	local leaderstats = player:FindFirstChild("leaderstats")
	if not leaderstats and LEADERSTATS_WAIT_SECONDS > 0 then
		leaderstats = player:WaitForChild("leaderstats", LEADERSTATS_WAIT_SECONDS)
	end

	if not leaderstats and CREATE_LEADERSTATS_IF_MISSING then
		leaderstats = Instance.new("Folder")
		leaderstats.Name = "leaderstats"
		leaderstats.Parent = player
	end

	return leaderstats
end

local function startSession(player: Player)
	if sessions[player] then
		return
	end

	local leaderstats = resolveLeaderstats(player)
	if not leaderstats then
		if pendingConnections[player] then
			return
		end

		warn("[LevelDataService] leaderstats not found for", player.Name, "- waiting for existing leaderstats.")
		pendingConnections[player] = player.ChildAdded:Connect(function(child)
			if child.Name == "leaderstats" then
				local conn = pendingConnections[player]
				if conn then
					conn:Disconnect()
					pendingConnections[player] = nil
				end
				startSession(player)
			end
		end)
		return
	end

	local xpValue = getOrCreateInt(leaderstats, XP_STAT_NAME)
	local playtimeValue = getOrCreateInt(leaderstats, PLAYTIME_STAT_NAME)

	local data = loadData(player)
	xpValue.Value = tonumber(data.XP) or 0
	playtimeValue.Value = tonumber(data.PlaytimeSeconds) or 0
	player:SetAttribute("LevelDataLastBackupWeek", data.LastBackupWeek)

	local record = {
		xp = xpValue,
		playtime = playtimeValue,
		xpRemainder = 0,
		conn = nil,
	}

	sessions[player] = record

	record.conn = task.spawn(function()
		while player.Parent do
			if STAT_SOURCE_MODE == "Leaderstats" then
				record.xpRemainder += XP_PER_SECOND
				local whole = math.floor(record.xpRemainder)
				if whole > 0 then
					xpValue.Value += whole
					record.xpRemainder -= whole
				end
				playtimeValue.Value += 1
			end
			task.wait(1)
		end
	end)
end

local function applyLevelData(player: Player, data: {[string]: any})
	local leaderstats = resolveLeaderstats(player)
	if leaderstats then
		local xpValue = getOrCreateInt(leaderstats, XP_STAT_NAME)
		local playtimeValue = getOrCreateInt(leaderstats, PLAYTIME_STAT_NAME)
		xpValue.Value = tonumber(data.XP) or 0
		playtimeValue.Value = tonumber(data.PlaytimeSeconds) or 0
	end

	local record = sessions[player]
	if record then
		record.xp.Value = tonumber(data.XP) or 0
		record.playtime.Value = tonumber(data.PlaytimeSeconds) or 0
		record.xpRemainder = 0
	end

	player:SetAttribute("LevelDataLastBackupWeek", data.LastBackupWeek)
end

local function restoreFromBackup(player: Player, weekId: number)
	if not store then
		warn("[LevelDataService] DataStore disabled; cannot restore.")
		return false
	end
	local backupKey = tostring(player.UserId) .. ":" .. tostring(weekId)
	local success, backupData = pcall(function()
		return backupStore:GetAsync(backupKey)
	end)
	if not success or type(backupData) ~= "table" then
		warn("[LevelDataService] No backup found for " .. player.Name .. " (week " .. tostring(weekId) .. ")")
		return false
	end
	applyLevelData(player, backupData)
	pcall(function()
		store:SetAsync("player_" .. player.UserId, backupData)
	end)
	print("‚úÖ [LevelDataService] Restored backup for " .. player.Name .. " (week " .. tostring(weekId) .. ")")
	return true
end

local function restoreUserIdFromBackup(userId: string, weekId: number)
	if not store then
		warn("[LevelDataService] DataStore disabled; cannot restore.")
		return false
	end
	local backupKey = userId .. ":" .. tostring(weekId)
	local success, backupData = pcall(function()
		return backupStore:GetAsync(backupKey)
	end)
	if not success or type(backupData) ~= "table" then
		warn("[LevelDataService] No backup found for userId " .. userId .. " (week " .. tostring(weekId) .. ")")
		return false
	end

	local saveSuccess, saveErr = pcall(function()
		store:SetAsync("player_" .. userId, backupData)
	end)
	if not saveSuccess then
		warn("[LevelDataService] Failed to restore userId " .. userId .. ": " .. tostring(saveErr))
		return false
	end

	local onlinePlayer = Players:GetPlayerByUserId(tonumber(userId))
	if onlinePlayer then
		applyLevelData(onlinePlayer, backupData)
	end

	print("‚úÖ [LevelDataService] Restored backup for userId " .. userId .. " (week " .. tostring(weekId) .. ")")
	return true
end

local function restoreAllUsersFromBackup(weekId: number)
	if not store then
		warn("[LevelDataService] DataStore disabled; cannot restore.")
		return
	end
	local pages
	local success, err = pcall(function()
		pages = registryStore:GetSortedAsync(false, 100)
	end)
	if not success then
		warn("[LevelDataService] Failed to read registry: " .. tostring(err))
		return
	end

	while true do
		for _, entry in ipairs(pages:GetCurrentPage()) do
			restoreUserIdFromBackup(entry.key, weekId)
			task.wait(0.2)
		end

		if pages.IsFinished then
			break
		end

		local advanceSuccess, advanceErr = pcall(function()
			pages:AdvanceToNextPageAsync()
		end)
		if not advanceSuccess then
			warn("[LevelDataService] Failed to advance registry pages: " .. tostring(advanceErr))
			break
		end
	end
end

local function viewUserData(userId: string)
	local success, data = pcall(function()
		return store:GetAsync("player_" .. userId)
	end)
	if not success then
		warn("[LevelDataService] Failed to read data for userId " .. userId)
		return
	end
	if type(data) ~= "table" then
		warn("[LevelDataService] No data found for userId " .. userId)
		return
	end
	print("üëÄ [LevelDataService] UserId " .. userId .. " data: XP=" .. tostring(data.XP or 0) .. ", PlaytimeSeconds=" .. tostring(data.PlaytimeSeconds or 0))
end

local function attachAdminCommands(player: Player)
	player.Chatted:Connect(function(message)
		local lowerMessage = string.lower(message)
		if not string.match(lowerMessage, "^!rollbacklevelweek")
			and not string.match(lowerMessage, "^!rollbacklevelweekall")
			and not string.match(lowerMessage, "^!rollbackleveluser")
			and not string.match(lowerMessage, "^!viewleveluser") then
			return
		end

		local isAdmin = false
		for _, adminId in ipairs(ADMIN_USER_IDS) do
			if player.UserId == adminId then
				isAdmin = true
				break
			end
		end
		if not isAdmin then
			return
		end

		local weeksAgo = tonumber(string.match(lowerMessage, "%s(%d+)$")) or 1
		local targetWeekId = getWeekId(os.time()) - weeksAgo

		if string.match(lowerMessage, "^!viewleveluser") then
			local targetId = string.match(lowerMessage, "^!viewleveluser%s+(%d+)")
			if not targetId then
				warn("‚ùå Usage: !viewleveluser <userId>")
				return
			end
			logAdminAction(player.UserId, "view_level_user", {UserId = targetId})
			viewUserData(targetId)
			return
		end

		if string.match(lowerMessage, "^!rollbacklevelweekall") then
			task.spawn(function()
				logAdminAction(player.UserId, "rollback_level_week_all", {WeekId = targetWeekId})
				restoreAllUsersFromBackup(targetWeekId)
			end)
			return
		end

		if string.match(lowerMessage, "^!rollbackleveluser") then
			local targetId = string.match(lowerMessage, "^!rollbackleveluser%s+(%d+)")
			if not targetId then
				warn("‚ùå Usage: !rollbackleveluser <userId> <weeksAgo>")
				return
			end
			logAdminAction(player.UserId, "rollback_level_user", {UserId = targetId, WeekId = targetWeekId})
			restoreUserIdFromBackup(targetId, targetWeekId)
			return
		end

		logAdminAction(player.UserId, "rollback_level_week_online", {WeekId = targetWeekId})
		for _, targetPlayer in ipairs(Players:GetPlayers()) do
			restoreFromBackup(targetPlayer, targetWeekId)
		end
	end)
end

for _, player in ipairs(Players:GetPlayers()) do
	registerPlayer(player)
	startSession(player)
	attachAdminCommands(player)
end

Players.PlayerAdded:Connect(function(player)
	registerPlayer(player)
	startSession(player)
	attachAdminCommands(player)
end)

Players.PlayerRemoving:Connect(function(player)
	saveData(player)
	sessions[player] = nil
	if pendingConnections[player] then
		pendingConnections[player]:Disconnect()
		pendingConnections[player] = nil
	end
end)

game:BindToClose(function()
	for player in pairs(sessions) do
		saveData(player)
	end
end)

	print("[LevelDataService] Leaderstats XP + Playtime DataStore active.")
	]]></ProtectedString>
					<bool name="Disabled">false</bool>
					<Content name="LinkedSource"><null></null></Content>
					<token name="RunContext">0</token>
					<string name="ScriptGuid">{AE3B7691-B614-4C43-918F-531D6571430E}</string>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">LevelDataService</string>
					<int64 name="SourceAssetId">-1</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
			</Item>
			<Item class="Script" referent="RBX4CE814A0EF0340BC997BA38771B0DD3A">
				<Properties>
					<ProtectedString name="Source"><![CDATA[--// Services 
local Players = game:GetService("Players")
local DataStoreService = game:GetService("DataStoreService")
local MarketplaceService = game:GetService("MarketplaceService")

--// Gamepass
local VIP_PASS_ID = 1607601065

--// Simple DataStore - one store for all player data
local PlayerData = DataStoreService:GetDataStore("PlayerData_Leaderstats")
local BackupData = DataStoreService:GetDataStore("PlayerData_Leaderstats_Backups")
local PlayerRegistry = DataStoreService:GetOrderedDataStore("PlayerRegistry_Leaderstats")
local AuditLog = DataStoreService:GetDataStore("PlayerData_Leaderstats_AuditLog")
local DATASTORE_RETRIES = 3
local RETRY_DELAY_SECONDS = 2
local MAX_RETRY_DELAY_SECONDS = 30
local WEEK_SECONDS = 60 * 60 * 24 * 7
local ADMIN_USER_IDS = {
	-- Add your UserIds here for rollback commands (example: 123456789)
}

local savePlayerData

local function ensureLeaderstats(plr)
	local leaderstats = plr:FindFirstChild("leaderstats")
	if not leaderstats then
		leaderstats = Instance.new("Folder")
		leaderstats.Name = "leaderstats"
		leaderstats.Parent = plr
	end

	local wins = leaderstats:FindFirstChild("Wins")
	if not wins then
		wins = Instance.new("IntValue")
		wins.Name = "Wins"
		wins.Parent = leaderstats
	end

	local cash = leaderstats:FindFirstChild("Cash")
	if not cash then
		cash = Instance.new("IntValue")
		cash.Name = "Cash"
		cash.Parent = leaderstats
	end

	local vip = leaderstats:FindFirstChild("VIP")
	if not vip then
		vip = Instance.new("BoolValue")
		vip.Name = "VIP"
		vip.Value = false
		vip.Parent = leaderstats
	end

	return leaderstats, wins, cash, vip
end

local function getWeekId(timeValue)
	return math.floor(timeValue / WEEK_SECONDS)
end

local function saveWeeklyBackup(plr, data)
	local weekId = getWeekId(os.time())
	if data.LastBackupWeek == weekId then
		return
	end

	local userId = tostring(plr.UserId)
	local backupKey = userId .. ":" .. tostring(weekId)
	local success, err = pcall(function()
		BackupData:SetAsync(backupKey, data)
	end)

	if success then
		data.LastBackupWeek = weekId
		plr:SetAttribute("LastBackupWeek", weekId)
		print("üóÇÔ∏è Saved weekly backup for userId " .. userId .. " (week " .. weekId .. ")")
	else
		warn("‚ùå Failed to save weekly backup for userId " .. userId .. ": " .. tostring(err))
	end
end

local function registerPlayer(plr)
	local userId = tostring(plr.UserId)
	local success, err = pcall(function()
		PlayerRegistry:SetAsync(userId, os.time())
	end)
	if not success then
		warn("‚ùå Failed to register userId " .. userId .. " in registry: " .. tostring(err))
	end
end

local function restoreFromBackup(plr, weekId)
	local userId = tostring(plr.UserId)
	local backupKey = userId .. ":" .. tostring(weekId)

	local success, backupData = pcall(function()
		return BackupData:GetAsync(backupKey)
	end)

	if not success or not backupData then
		warn("‚ùå No backup found for " .. plr.Name .. " (week " .. weekId .. ")")
		return false
	end

	local _, wins, cash, vip = ensureLeaderstats(plr)
	wins.Value = backupData.Wins or 0
	cash.Value = backupData.Cash or 0
	plr:SetAttribute("DataLoaded", true)

	task.spawn(function()
		local passSuccess, owns = pcall(function()
			return MarketplaceService:UserOwnsGamePassAsync(plr.UserId, VIP_PASS_ID)
		end)
		if passSuccess and owns then
			vip.Value = true
		else
			vip.Value = false
		end
	end)

	savePlayerData(plr, wins.Value, cash.Value)
	print("‚úÖ Restored backup for " .. plr.Name .. " (week " .. weekId .. ")")
	return true
end

local function restoreUserIdFromBackup(userId, weekId)
	local backupKey = userId .. ":" .. tostring(weekId)

	local success, backupData = pcall(function()
		return BackupData:GetAsync(backupKey)
	end)

	if not success or not backupData then
		warn("‚ùå No backup found for userId " .. userId .. " (week " .. weekId .. ")")
		return false
	end

	backupData.LastSaved = os.time()

	local saveSuccess, saveErr = pcall(function()
		PlayerData:SetAsync(userId, backupData)
	end)

	if not saveSuccess then
		warn("‚ùå Failed to restore userId " .. userId .. ": " .. tostring(saveErr))
		return false
	end

	local onlinePlayer = Players:GetPlayerByUserId(tonumber(userId))
	if onlinePlayer then
		local _, wins, cash = ensureLeaderstats(onlinePlayer)
		wins.Value = backupData.Wins or 0
		cash.Value = backupData.Cash or 0
		onlinePlayer:SetAttribute("DataLoaded", true)
	end

	print("‚úÖ Restored backup for userId " .. userId .. " (week " .. weekId .. ")")
	return true
end

local function restoreAllUsersFromBackup(weekId)
	local pages
	local success, err = pcall(function()
		pages = PlayerRegistry:GetSortedAsync(false, 100)
	end)
	if not success then
		warn("‚ùå Failed to read player registry: " .. tostring(err))
		return
	end

	while true do
		for _, entry in ipairs(pages:GetCurrentPage()) do
			restoreUserIdFromBackup(entry.key, weekId)
			task.wait(0.2)
		end

		if pages.IsFinished then
			break
		end

		local advanceSuccess, advanceErr = pcall(function()
			pages:AdvanceToNextPageAsync()
		end)
		if not advanceSuccess then
			warn("‚ùå Failed to advance registry pages: " .. tostring(advanceErr))
			break
		end
	end
end

local function viewUserData(userId)
	local success, data = pcall(function()
		return PlayerData:GetAsync(userId)
	end)

	if not success then
		warn("‚ùå Failed to read data for userId " .. userId)
		return
	end

	if not data then
		warn("‚ùå No data found for userId " .. userId)
		return
	end

	print("üëÄ UserId " .. userId .. " data: Wins=" .. tostring(data.Wins or 0) .. ", Cash=" .. tostring(data.Cash or 0))
end

local function logAdminAction(adminId, action, details)
	local entry = {
		AdminId = adminId,
		Action = action,
		Details = details or {},
		Timestamp = os.time()
	}

	local success, err = pcall(function()
		AuditLog:SetAsync(tostring(adminId) .. ":" .. tostring(os.time()), entry)
	end)

	if not success then
		warn("‚ùå Failed to write audit log: " .. tostring(err))
	end
end

---------------------------------------------------------
-- Load Player Data
---------------------------------------------------------
local function loadPlayerData(plr)
	local userId = tostring(plr.UserId)

	for attempt = 1, DATASTORE_RETRIES do
		local success, data = pcall(function()
			return PlayerData:GetAsync(userId)
		end)

		if success then
			if data then
				print("‚úÖ Loaded data for " .. plr.Name .. ": Wins=" .. (data.Wins or 0) .. ", Cash=" .. (data.Cash or 0))
				return data.Wins or 0, data.Cash or 0, true, data.LastBackupWeek
			end

			print("üÜï No data found for " .. plr.Name .. ", starting fresh")
			return 0, 0, true, nil
		end

		warn("‚ö†Ô∏è Data load failed for " .. plr.Name .. " (attempt " .. attempt .. "/" .. DATASTORE_RETRIES .. ")")
		task.wait(RETRY_DELAY_SECONDS)
	end

	warn("‚ùå Data load failed for " .. plr.Name .. " after retries; skipping autosave to avoid data loss")
	return 0, 0, false, nil
end

---------------------------------------------------------
-- Save Player Data
---------------------------------------------------------
savePlayerData = function(plr, wins, cash)
	if plr:GetAttribute("DataLoaded") ~= true then
		warn("‚ö†Ô∏è Skipping save for " .. plr.Name .. " because data did not finish loading")
		return
	end

	local userId = tostring(plr.UserId)
	local lastBackupWeek = plr:GetAttribute("LastBackupWeek")
	local data = {
		Wins = wins,
		Cash = cash,
		LastSaved = os.time(),
		LastBackupWeek = lastBackupWeek
	}

	saveWeeklyBackup(plr, data)
	
	local success, err = pcall(function()
		PlayerData:UpdateAsync(userId, function()
			return data
		end)
	end)
	
	if success then
		print("üíæ Saved data for " .. plr.Name .. ": Wins=" .. wins .. ", Cash=" .. cash)
	else
		warn("‚ùå Failed to save data for " .. plr.Name .. ": " .. tostring(err))
	end
end

---------------------------------------------------------
-- Player Added
---------------------------------------------------------
local function playerAdded(plr)
	print("üëã " .. plr.Name .. " joined the game")
	registerPlayer(plr)

	-- Load saved data
	plr:SetAttribute("DataLoaded", false)
	local loadedWins, loadedCash, dataLoaded, lastBackupWeek = loadPlayerData(plr)
	if dataLoaded then
		local _, wins, cash, vip = ensureLeaderstats(plr)
		wins.Value = loadedWins
		cash.Value = loadedCash
		plr:SetAttribute("LastBackupWeek", lastBackupWeek)
		plr:SetAttribute("DataLoaded", true)
		task.spawn(function()
			local success, owns = pcall(function()
				return MarketplaceService:UserOwnsGamePassAsync(plr.UserId, VIP_PASS_ID)
			end)
			if success and owns then
				vip.Value = true
				print("‚≠ê " .. plr.Name .. " has VIP pass")
			end
		end)
	else
		task.spawn(function()
			local retryDelay = RETRY_DELAY_SECONDS
			while plr.Parent do
				task.wait(retryDelay)
				local retryWins, retryCash, retryLoaded, retryLastBackupWeek = loadPlayerData(plr)
				if retryLoaded then
					local _, wins, cash, vip = ensureLeaderstats(plr)
					wins.Value = retryWins
					cash.Value = retryCash
					plr:SetAttribute("LastBackupWeek", retryLastBackupWeek)
					plr:SetAttribute("DataLoaded", true)
					print("‚úÖ Retried data load succeeded for " .. plr.Name)
					task.spawn(function()
						local success, owns = pcall(function()
							return MarketplaceService:UserOwnsGamePassAsync(plr.UserId, VIP_PASS_ID)
						end)
						if success and owns then
							vip.Value = true
							print("‚≠ê " .. plr.Name .. " has VIP pass")
						end
					end)
					break
				end
				retryDelay = math.min(retryDelay * 2, MAX_RETRY_DELAY_SECONDS)
			end
		end)
	end

	plr.Chatted:Connect(function(message)
		local lowerMessage = string.lower(message)
		if not string.match(lowerMessage, "^!rollbackweek") and not string.match(lowerMessage, "^!rollbackweekall") and not string.match(lowerMessage, "^!rollbackuser") and not string.match(lowerMessage, "^!viewuser") then
			return
		end

		local isAdmin = false
		for _, adminId in ipairs(ADMIN_USER_IDS) do
			if plr.UserId == adminId then
				isAdmin = true
				break
			end
		end
		if not isAdmin then
			return
		end

		local weeksAgo = tonumber(string.match(lowerMessage, "%s(%d+)$")) or 1
		local targetWeekId = getWeekId(os.time()) - weeksAgo

		if string.match(lowerMessage, "^!viewuser") then
			local targetId = string.match(lowerMessage, "^!viewuser%s+(%d+)")
			if not targetId then
				warn("‚ùå Usage: !viewuser <userId>")
				return
			end
			logAdminAction(plr.UserId, "view_user", {UserId = targetId})
			viewUserData(targetId)
			return
		end

		if string.match(lowerMessage, "^!rollbackweekall") then
			task.spawn(function()
				logAdminAction(plr.UserId, "rollback_week_all", {WeekId = targetWeekId})
				restoreAllUsersFromBackup(targetWeekId)
			end)
			return
		end

		if string.match(lowerMessage, "^!rollbackuser") then
			local targetId = string.match(lowerMessage, "^!rollbackuser%s+(%d+)")
			if not targetId then
				warn("‚ùå Usage: !rollbackuser <userId> <weeksAgo>")
				return
			end
			logAdminAction(plr.UserId, "rollback_user", {UserId = targetId, WeekId = targetWeekId})
			restoreUserIdFromBackup(targetId, targetWeekId)
			return
		end

		logAdminAction(plr.UserId, "rollback_week_online", {WeekId = targetWeekId})
		for _, targetPlayer in ipairs(Players:GetPlayers()) do
			restoreFromBackup(targetPlayer, targetWeekId)
		end
	end)
end

---------------------------------------------------------
-- Player Removing
---------------------------------------------------------
local function playerRemoving(plr)
	print("üëã " .. plr.Name .. " is leaving the game")
	
	local ls = plr:FindFirstChild("leaderstats")
	if not ls then return end

	local wins = ls:FindFirstChild("Wins")
	local cash = ls:FindFirstChild("Cash")
	if not wins or not cash then return end

	-- Save current data
	savePlayerData(plr, wins.Value, cash.Value)
end
---------------------------------------------------------
-- Auto-save every 60 seconds
---------------------------------------------------------
local function autoSaveAll()
	for _, plr in ipairs(Players:GetPlayers()) do
		local ls = plr:FindFirstChild("leaderstats")
		if ls then
			local wins = ls:FindFirstChild("Wins")
			local cash = ls:FindFirstChild("Cash")
			if wins and cash then
				savePlayerData(plr, wins.Value, cash.Value)
			end
		end
	end
end

-- Auto-save every minute
task.spawn(function()
	while true do
		task.wait(60)
		autoSaveAll()
	end
end)

---------------------------------------------------------
-- Player Connections
---------------------------------------------------------
for _, plr in ipairs(Players:GetPlayers()) do
	task.spawn(playerAdded, plr)
end

Players.PlayerAdded:Connect(playerAdded)
Players.PlayerRemoving:Connect(playerRemoving)

-- Save all data when server shuts down
game:BindToClose(function()
	print("üîí Server shutting down, saving all player data...")
	autoSaveAll()
end)

print("üéÆ Leaderstats system initialized")
]]></ProtectedString>
					<bool name="Disabled">false</bool>
					<Content name="LinkedSource"><null></null></Content>
					<token name="RunContext">0</token>
					<string name="ScriptGuid">{0C12D1C6-60F7-4E1F-AB78-811747459971}</string>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">Leaderstats</string>
					<int64 name="SourceAssetId">13151211615</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
			</Item>
			<Item class="Script" referent="RBX07D067D2688745E5AC795F76A48CE984">
				<Properties>
					<ProtectedString name="Source"><![CDATA[--// CollectablesService.server.lua
--// ServerScriptService

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local DataStoreService = game:GetService("DataStoreService")

------------------------------------------------------------
-- SETTINGS
------------------------------------------------------------
local WORKSPACE_FOLDER_NAME = "Collectables"
local MAX_COLLECT_DISTANCE = 100
local CLICK_DISTANCE = 100

local USE_DATASTORE = true
local DATASTORE_NAME = "CollectablesV1"
local STORE_COLLECT_TIME = true

local BACKUP_DATASTORE_NAME = DATASTORE_NAME .. "_Backups"
local REGISTRY_DATASTORE_NAME = DATASTORE_NAME .. "_Registry"
local AUDIT_DATASTORE_NAME = DATASTORE_NAME .. "_AuditLog"
local WEEK_SECONDS = 60 * 60 * 24 * 7
local ADMIN_USER_IDS = {
	-- Add your UserIds here for rollback commands (example: 123456789)
}

------------------------------------------------------------
-- FOLDERS / REMOTES (create first so UI never hangs)
------------------------------------------------------------
local function getOrMakeFolder(parent: Instance, name: string): Folder
	local f = parent:FindFirstChild(name)
	if not f then
		f = Instance.new("Folder")
		f.Name = name
		f.Parent = parent
	end
	return f :: Folder
end

local remotes = getOrMakeFolder(ReplicatedStorage, "CollectablesRemotes")

local collectedRE = remotes:FindFirstChild("Collected")
if not collectedRE then
	collectedRE = Instance.new("RemoteEvent")
	collectedRE.Name = "Collected"
	collectedRE.Parent = remotes
end

local catalogFolder = getOrMakeFolder(ReplicatedStorage, "CollectablesCatalog")
local previewFolder = getOrMakeFolder(ReplicatedStorage, "CollectablesPreview")

------------------------------------------------------------
-- DATASTORE
------------------------------------------------------------
local store = nil
if USE_DATASTORE then
	store = DataStoreService:GetDataStore(DATASTORE_NAME)
end
local backupStore = DataStoreService:GetDataStore(BACKUP_DATASTORE_NAME)
local registryStore = DataStoreService:GetOrderedDataStore(REGISTRY_DATASTORE_NAME)
local auditStore = DataStoreService:GetDataStore(AUDIT_DATASTORE_NAME)

local function getWeekId(timeValue: number): number
	return math.floor(timeValue / WEEK_SECONDS)
end

local function registerPlayer(player: Player)
	local userId = tostring(player.UserId)
	local success, err = pcall(function()
		registryStore:SetAsync(userId, os.time())
	end)
	if not success then
		warn("[Collectables] Failed to register userId " .. userId .. ": " .. tostring(err))
	end
end

local function logAdminAction(adminId: number, action: string, details: {[string]: any}?)
	local entry = {
		AdminId = adminId,
		Action = action,
		Details = details or {},
		Timestamp = os.time(),
	}
	local success, err = pcall(function()
		auditStore:SetAsync(tostring(adminId) .. ":" .. tostring(os.time()), entry)
	end)
	if not success then
		warn("[Collectables] Failed to write audit log: " .. tostring(err))
	end
end

local function loadPlayerData(userId: number): {[string]: number}
	if not store then return {} end
	local ok, data = pcall(function()
		return store:GetAsync(tostring(userId))
	end)
	if ok and type(data) == "table" then
		return data
	end
	return {}
end

local function savePlayerData(player: Player)
	if not store then return end

	local f = player:FindFirstChild("Collectables")
	if not f then return end

	local data: {[string]: number} = {}
	for _, v in ipairs(f:GetChildren()) do
		if v:IsA("BoolValue") and v.Value == true then
			local t = player:GetAttribute("CollectableTime_" .. v.Name)
			if type(t) ~= "number" then
				t = os.time()
			end
			data[v.Name] = t
		end
	end

	pcall(function()
		store:SetAsync(tostring(player.UserId), data)
	end)

	local function saveWeeklyBackup()
		local weekId = getWeekId(os.time())
		local attrName = "CollectablesLastBackupWeek"
		local lastWeek = player:GetAttribute(attrName)
		if lastWeek == weekId then
			return
		end
		local backupKey = tostring(player.UserId) .. ":" .. tostring(weekId)
		local success, err = pcall(function()
			backupStore:SetAsync(backupKey, data)
		end)
		if success then
			player:SetAttribute(attrName, weekId)
		else
			warn("[Collectables] Failed weekly backup for userId " .. tostring(player.UserId) .. ": " .. tostring(err))
		end
	end

	saveWeeklyBackup()
end

------------------------------------------------------------
-- UTIL
------------------------------------------------------------
local function getCollectId(inst: Instance): string
	local id = inst:GetAttribute("CollectableId")
	if typeof(id) == "string" and id ~= "" then
		return id
	end
	return inst.Name
end

local function anchorPreviewClone(clone: Instance)
	for _, d in ipairs(clone:GetDescendants()) do
		if d:IsA("ClickDetector") then
			d:Destroy()
		elseif d:IsA("Script") or d:IsA("LocalScript") then
			d:Destroy()
		elseif d:IsA("BasePart") then
			d.Anchored = true
			d.CanCollide = false
			d.CanTouch = false
			d.CanQuery = false
			d.CastShadow = false
		end
	end
end

local function ensureCatalogAndPreview(source: Instance)
	if not (source:IsA("BasePart") or source:IsA("Model")) then return end

	local id = getCollectId(source)

	-- Catalog entry
	local entry = catalogFolder:FindFirstChild(id)
	if not entry then
		entry = Instance.new("Folder")
		entry.Name = id
		entry.Parent = catalogFolder
	end

	entry:SetAttribute("Id", id)
	entry:SetAttribute("Name", source:GetAttribute("DisplayName") or id)
	entry:SetAttribute("Desc", source:GetAttribute("Description") or "")
	entry:SetAttribute("Rarity", source:GetAttribute("Rarity") or "Common")
	entry:SetAttribute("Image", source:GetAttribute("Icon") or "")

	-- Preview clone (guarded)
	if not previewFolder:FindFirstChild(id) then
		task.defer(function()
			local oldArchivable = source.Archivable
			source.Archivable = true
			local ok, clone = pcall(function()
				return source:Clone()
			end)
			source.Archivable = oldArchivable

			if ok and clone then
				clone.Name = id
				anchorPreviewClone(clone)
				clone.Parent = previewFolder
			else
				warn("[Collectables] Preview clone failed for:", source:GetFullName())
			end
		end)
	end
end

-- Distance from point to the *surface* of a rotated part (OBB), not just its center
local function distancePointToPartSurface(point: Vector3, part: BasePart): number
	local lp = part.CFrame:PointToObjectSpace(point)
	local half = part.Size * 0.5

	local dx = math.max(0, math.abs(lp.X) - half.X)
	local dy = math.max(0, math.abs(lp.Y) - half.Y)
	local dz = math.max(0, math.abs(lp.Z) - half.Z)

	return math.sqrt(dx*dx + dy*dy + dz*dz)
end

local function getOrMakePlayerCollectFolder(player: Player): Folder
	local f = player:FindFirstChild("Collectables")
	if not f then
		f = Instance.new("Folder")
		f.Name = "Collectables"
		f.Parent = player
	end
	return f :: Folder
end

local function isCollected(player: Player, id: string): boolean
	local a = player:GetAttribute("Collectable_" .. id)
	if typeof(a) == "boolean" then return a end

	local f = player:FindFirstChild("Collectables")
	if f then
		local b = f:FindFirstChild(id)
		if b and b:IsA("BoolValue") then
			return b.Value == true
		end
	end
	return false
end

local function setCollected(player: Player, id: string, collectedTime: number?)
	player:SetAttribute("Collectable_" .. id, true)
	if STORE_COLLECT_TIME then
		player:SetAttribute("CollectableTime_" .. id, collectedTime or os.time())
	end

	local f = getOrMakePlayerCollectFolder(player)
	local b = f:FindFirstChild(id)
	if not b then
		b = Instance.new("BoolValue")
		b.Name = id
		b.Parent = f
	end
	b.Value = true
end

local function clearCollectableAttributes(player: Player)
	for name, _ in pairs(player:GetAttributes()) do
		if string.sub(name, 1, #"Collectable_") == "Collectable_"
			or string.sub(name, 1, #"CollectableTime_") == "CollectableTime_" then
			player:SetAttribute(name, nil)
		end
	end
end

local function applyCollectableData(player: Player, data: {[string]: number})
	clearCollectableAttributes(player)

	local f = getOrMakePlayerCollectFolder(player)
	for _, child in ipairs(f:GetChildren()) do
		if child:IsA("BoolValue") then
			child:Destroy()
		end
	end

	for id, t in pairs(data) do
		if type(id) == "string" and type(t) == "number" then
			setCollected(player, id, t)
		end
	end
end

local function restoreFromBackup(player: Player, weekId: number)
	if not store then
		warn("[Collectables] DataStore disabled; cannot restore.")
		return false
	end
	local backupKey = tostring(player.UserId) .. ":" .. tostring(weekId)
	local success, backupData = pcall(function()
		return backupStore:GetAsync(backupKey)
	end)
	if not success or type(backupData) ~= "table" then
		warn("[Collectables] No backup found for " .. player.Name .. " (week " .. tostring(weekId) .. ")")
		return false
	end
	applyCollectableData(player, backupData)
	pcall(function()
		store:SetAsync(tostring(player.UserId), backupData)
	end)
	print("‚úÖ [Collectables] Restored backup for " .. player.Name .. " (week " .. tostring(weekId) .. ")")
	return true
end

local function restoreUserIdFromBackup(userId: string, weekId: number)
	if not store then
		warn("[Collectables] DataStore disabled; cannot restore.")
		return false
	end
	local backupKey = userId .. ":" .. tostring(weekId)
	local success, backupData = pcall(function()
		return backupStore:GetAsync(backupKey)
	end)
	if not success or type(backupData) ~= "table" then
		warn("[Collectables] No backup found for userId " .. userId .. " (week " .. tostring(weekId) .. ")")
		return false
	end

	local saveSuccess, saveErr = pcall(function()
		store:SetAsync(userId, backupData)
	end)
	if not saveSuccess then
		warn("[Collectables] Failed to restore userId " .. userId .. ": " .. tostring(saveErr))
		return false
	end

	local onlinePlayer = Players:GetPlayerByUserId(tonumber(userId))
	if onlinePlayer then
		applyCollectableData(onlinePlayer, backupData)
	end

	print("‚úÖ [Collectables] Restored backup for userId " .. userId .. " (week " .. tostring(weekId) .. ")")
	return true
end

local function restoreAllUsersFromBackup(weekId: number)
	if not store then
		warn("[Collectables] DataStore disabled; cannot restore.")
		return
	end
	local pages
	local success, err = pcall(function()
		pages = registryStore:GetSortedAsync(false, 100)
	end)
	if not success then
		warn("[Collectables] Failed to read registry: " .. tostring(err))
		return
	end

	while true do
		for _, entry in ipairs(pages:GetCurrentPage()) do
			restoreUserIdFromBackup(entry.key, weekId)
			task.wait(0.2)
		end

		if pages.IsFinished then
			break
		end

		local advanceSuccess, advanceErr = pcall(function()
			pages:AdvanceToNextPageAsync()
		end)
		if not advanceSuccess then
			warn("[Collectables] Failed to advance registry pages: " .. tostring(advanceErr))
			break
		end
	end
end

local function viewUserData(userId: string)
	if not store then
		warn("[Collectables] DataStore disabled; cannot view data.")
		return
	end
	local success, data = pcall(function()
		return store:GetAsync(userId)
	end)
	if not success then
		warn("[Collectables] Failed to read data for userId " .. userId)
		return
	end
	if type(data) ~= "table" then
		warn("[Collectables] No data found for userId " .. userId)
		return
	end
	local count = 0
	for _ in pairs(data) do
		count += 1
	end
	print("üëÄ [Collectables] UserId " .. userId .. " collectables: " .. tostring(count))
end

local function attachAdminCommands(player: Player)
	player.Chatted:Connect(function(message)
		local lowerMessage = string.lower(message)
		if not string.match(lowerMessage, "^!rollbackcollectweek")
			and not string.match(lowerMessage, "^!rollbackcollectweekall")
			and not string.match(lowerMessage, "^!rollbackcollectuser")
			and not string.match(lowerMessage, "^!viewcollectuser") then
			return
		end

		local isAdmin = false
		for _, adminId in ipairs(ADMIN_USER_IDS) do
			if player.UserId == adminId then
				isAdmin = true
				break
			end
		end
		if not isAdmin then
			return
		end

		local weeksAgo = tonumber(string.match(lowerMessage, "%s(%d+)$")) or 1
		local targetWeekId = getWeekId(os.time()) - weeksAgo

		if string.match(lowerMessage, "^!viewcollectuser") then
			local targetId = string.match(lowerMessage, "^!viewcollectuser%s+(%d+)")
			if not targetId then
				warn("‚ùå Usage: !viewcollectuser <userId>")
				return
			end
			logAdminAction(player.UserId, "view_collect_user", {UserId = targetId})
			viewUserData(targetId)
			return
		end

		if string.match(lowerMessage, "^!rollbackcollectweekall") then
			task.spawn(function()
				logAdminAction(player.UserId, "rollback_collect_week_all", {WeekId = targetWeekId})
				restoreAllUsersFromBackup(targetWeekId)
			end)
			return
		end

		if string.match(lowerMessage, "^!rollbackcollectuser") then
			local targetId = string.match(lowerMessage, "^!rollbackcollectuser%s+(%d+)")
			if not targetId then
				warn("‚ùå Usage: !rollbackcollectuser <userId> <weeksAgo>")
				return
			end
			logAdminAction(player.UserId, "rollback_collect_user", {UserId = targetId, WeekId = targetWeekId})
			restoreUserIdFromBackup(targetId, targetWeekId)
			return
		end

		logAdminAction(player.UserId, "rollback_collect_week_online", {WeekId = targetWeekId})
		for _, targetPlayer in ipairs(Players:GetPlayers()) do
			restoreFromBackup(targetPlayer, targetWeekId)
		end
	end)
end

------------------------------------------------------------
-- CLICK HOOKING (KEY FIX: hook ALL parts, not just 1)
------------------------------------------------------------
local worldFolder = workspace:WaitForChild(WORKSPACE_FOLDER_NAME)

local hookedSource: {[Instance]: boolean} = {}
local hookedPart: {[BasePart]: boolean} = {}

local function getAllClickableParts(source: Instance): {BasePart}
	local parts = {}

	if source:IsA("BasePart") then
		table.insert(parts, source)
		return parts
	end

	-- Model: clickable anywhere
	if source:IsA("Model") then
		for _, d in ipairs(source:GetDescendants()) do
			if d:IsA("BasePart") and d:GetAttribute("IgnoreClick") ~= true then
				table.insert(parts, d)
			end
		end
	end

	return parts
end

local function hookPartClick(part: BasePart, source: Instance, id: string)
	if hookedPart[part] then return end
	hookedPart[part] = true

	-- ClickDetectors need ray-query to be on
	if part.CanQuery == false then
		part.CanQuery = true
	end

	local cd = part:FindFirstChildOfClass("ClickDetector")
	if not cd then
		cd = Instance.new("ClickDetector")
		cd.Parent = part
	end
	cd.MaxActivationDistance = CLICK_DISTANCE

	cd.MouseClick:Connect(function(player: Player)
		if isCollected(player, id) then return end

		local char = player.Character
		local hrp = char and char:FindFirstChild("HumanoidRootPart")
		if not hrp then return end

		if not part:IsDescendantOf(workspace) then return end
		if not source:IsDescendantOf(workspace) then return end

		-- ‚úÖ Robust distance check (surface distance)
		local d = distancePointToPartSurface(hrp.Position, part)
		if d > MAX_COLLECT_DISTANCE then
			return
		end

		local t = os.time()
		setCollected(player, id, t)
		collectedRE:FireClient(player, id)
	end)
end

local function hookCollectable(source: Instance)
	if hookedSource[source] then return end
	hookedSource[source] = true

	if not (source:IsA("BasePart") or source:IsA("Model")) then return end

	local id = getCollectId(source)
	source:SetAttribute("CollectableId", id)

	ensureCatalogAndPreview(source)

	local parts = getAllClickableParts(source)
	if #parts == 0 then
		warn("[Collectables] No BaseParts found for:", source:GetFullName())
		return
	end

	for _, part in ipairs(parts) do
		hookPartClick(part, source, id)
	end
end

-- Initial scan + dynamic additions
for _, child in ipairs(worldFolder:GetChildren()) do
	hookCollectable(child)
end

worldFolder.ChildAdded:Connect(function(child)
	task.defer(function()
		hookCollectable(child)
	end)
end)

------------------------------------------------------------
-- PLAYER LOAD / SAVE
------------------------------------------------------------
Players.PlayerAdded:Connect(function(player)
	registerPlayer(player)
	local saved = loadPlayerData(player.UserId)
	applyCollectableData(player, saved)
	attachAdminCommands(player)
end)

for _, player in ipairs(Players:GetPlayers()) do
	registerPlayer(player)
	local saved = loadPlayerData(player.UserId)
	applyCollectableData(player, saved)
	attachAdminCommands(player)
end

Players.PlayerRemoving:Connect(function(player)
	savePlayerData(player)
end)

task.spawn(function()
	if not store then return end
	while true do
		task.wait(60)
		for _, p in ipairs(Players:GetPlayers()) do
			savePlayerData(p)
		end
	end
end)

print("[Collectables] Service running.")
]]></ProtectedString>
					<bool name="Disabled">false</bool>
					<Content name="LinkedSource"><null></null></Content>
					<token name="RunContext">0</token>
					<string name="ScriptGuid">{D581A615-7849-4672-AA7F-1D9E3317DBDD}</string>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">CollectablesService</string>
					<int64 name="SourceAssetId">-1</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
			</Item>
		</Item>
		<Item class="Folder" referent="RBXC362FBFFD147448C8057FCE3D4EC1323">
			<Properties>
				<BinaryString name="AttributesSerialize"></BinaryString>
				<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
				<bool name="DefinesCapabilities">false</bool>
				<string name="Name">StarterGUI</string>
				<int64 name="SourceAssetId">-1</int64>
				<BinaryString name="Tags"></BinaryString>
			</Properties>
			<Item class="LocalScript" referent="RBX22F45D695D3D4EA18BBF4738B86658F2">
				<Properties>
					<ProtectedString name="Source"><![CDATA[--[[

‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïê‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ïî‚ïù  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ñà‚ïî‚ïù   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë
‚ñà‚ñà‚ïë      ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë
‚ïö‚ïê‚ïù      ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù

Fauzan's Custom Leaderboard ¬© 2025, Version 1.0 | Developed by Fauzan
(Upgraded + cleaned: modern, smooth, NO weird extra elements)

Edits requested:
- Removed the ugly white/transparent OUTER stroke around the whole UI (main frame + header + mini button + close button)
  (Player entry styling remains; VIP gold outline stays)

--]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local REFRESH_RATE = 2
local ANIMATION_SPEED = 0.30
-- Mini button icon (replace 0 with your image asset id)
local MINI_BTN_ICON = "rbxassetid://2795572800"


local isVisible = true
local isAnimating = false

local WINS_COLOR = Color3.fromRGB(255, 255, 255)

pcall(function()
	StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.PlayerList, false)
end)

-- Kill old UI if it exists (prevents duplicates on respawn)
local old = playerGui:FindFirstChild("CustomLeaderboard")
if old then old:Destroy() end



--========================
-- Theme (brighter, still clean)
--========================
local THEME = {
	Width = 300,
	Corner = 14,

	MainBG  = Color3.fromRGB(22,22,26),
	MainBG2 = Color3.fromRGB(14,14,18),

	HeaderBG = Color3.fromRGB(28,28,32),

	Text = Color3.fromRGB(255,255,255),
	SubText = Color3.fromRGB(215,215,222),

	EntryBG = Color3.fromRGB(32,32,38),
	EntryStroke = Color3.fromRGB(78,78,88),
	EntryStrokeT = 0.62,

	Money = Color3.fromRGB(255, 205, 110),
}

local function formatNumber(n)
	n = tonumber(n) or 0
	if n >= 1_000_000_000 then
		return string.format("%.1fB", n / 1_000_000_000)
	elseif n >= 1_000_000 then
		return string.format("%.1fM", n / 1_000_000)
	elseif n >= 1_000 then
		return string.format("%.1fK", n / 1_000)
	else
		return tostring(n)
	end
end

local function addCorner(inst, px)
	local c = Instance.new("UICorner")
	c.CornerRadius = UDim.new(0, px)
	c.Parent = inst
	return c
end

local function addStroke(inst, color, thickness, transparency)
	local s = Instance.new("UIStroke")
	s.Color = color
	s.Thickness = thickness
	s.Transparency = transparency
	s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	s.Parent = inst
	return s
end

local function addGradient(inst, c1, c2, rot)
	local g = Instance.new("UIGradient")
	g.Color = ColorSequence.new(c1, c2)
	g.Rotation = rot or 135
	g.Parent = inst
	return g
end

local function getStrings(plr)
	local s = {}
	local ls = plr:FindFirstChild("leaderstats")
	if ls then
		for _, c in ipairs(ls:GetChildren()) do
			if c:IsA("StringValue") and c.Value ~= "" then
				table.insert(s, c.Value)
			end
		end
	end
	return s
end

--========================
-- ScreenGui
--========================
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CustomLeaderboard"
screenGui.ResetOnSpawn = true
screenGui.DisplayOrder = 100
screenGui.IgnoreGuiInset = true
screenGui.Parent = playerGui

--========================
-- Main Frame
--========================
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, THEME.Width, 0, 0)
mainFrame.Position = UDim2.new(1, -(THEME.Width + 10), 0, 10)
mainFrame.BackgroundColor3 = THEME.MainBG
mainFrame.BackgroundTransparency = 0.06
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
addCorner(mainFrame, THEME.Corner)
-- REMOVED OUTER STROKE HERE (was causing the white transparent box)
addGradient(mainFrame, THEME.MainBG, THEME.MainBG2, 135)

-- CanvasGroup = clean fade for EVERYTHING (entries included)
local content = Instance.new("CanvasGroup")
content.Name = "Content"
content.Size = UDim2.new(1, 0, 1, 0)
content.BackgroundTransparency = 1
content.GroupTransparency = 0
content.Parent = mainFrame

--========================
-- Header
--========================
local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0, 45)
header.BackgroundColor3 = THEME.HeaderBG
header.BackgroundTransparency = 0.12
header.BorderSizePixel = 0
header.Parent = content
addCorner(header, THEME.Corner)
-- REMOVED HEADER STROKE (also contributed to the outer box look)
addGradient(header, THEME.HeaderBG, Color3.fromRGB(20,20,24), 135)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -120, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Text = "PLAYERS"
title.TextColor3 = THEME.Text
title.TextSize = 18
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = header

-- Column headers
local cashHeader = Instance.new("TextLabel")
cashHeader.Name = "CashHeader"
cashHeader.Size = UDim2.new(0, 60, 1, 0)
cashHeader.Position = UDim2.new(1, -130, 0, 0)
cashHeader.BackgroundTransparency = 1
cashHeader.Text = "Cash"
cashHeader.TextColor3 = THEME.SubText
cashHeader.TextSize = 14
cashHeader.Font = Enum.Font.Gotham
cashHeader.TextXAlignment = Enum.TextXAlignment.Right
cashHeader.Parent = header

local winsHeader = Instance.new("TextLabel")
winsHeader.Name = "WinsHeader"
winsHeader.Size = UDim2.new(0, 55, 1, 0)
winsHeader.Position = UDim2.new(1, -70, 0, 0)
winsHeader.BackgroundTransparency = 1
winsHeader.Text = "Wins"
winsHeader.TextColor3 = THEME.SubText
winsHeader.TextSize = 14
winsHeader.Font = Enum.Font.Gotham
winsHeader.TextXAlignment = Enum.TextXAlignment.Right
winsHeader.Parent = header

-- Close button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -38, 0, 7)
closeBtn.BackgroundColor3 = Color3.fromRGB(34,34,40)
closeBtn.BackgroundTransparency = 0.18
closeBtn.BorderSizePixel = 0
closeBtn.Text = "√ó"
closeBtn.TextColor3 = Color3.fromRGB(235,235,240)
closeBtn.TextSize = 20
closeBtn.Font = Enum.Font.GothamBold
closeBtn.AutoButtonColor = false
closeBtn.Parent = header
addCorner(closeBtn, 999)
-- REMOVED CLOSE BUTTON STROKE (it was occasionally reading like a glow/outline)

local closeScale = Instance.new("UIScale")
closeScale.Scale = 1
closeScale.Parent = closeBtn

closeBtn.MouseEnter:Connect(function()
	TweenService:Create(closeScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1.08}):Play()
	TweenService:Create(closeBtn, TweenInfo.new(0.12), {BackgroundTransparency = 0.10}):Play()
end)
closeBtn.MouseLeave:Connect(function()
	TweenService:Create(closeScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1.00}):Play()
	TweenService:Create(closeBtn, TweenInfo.new(0.12), {BackgroundTransparency = 0.18}):Play()
end)

--========================
-- List
--========================
local list = Instance.new("Frame")
list.Size = UDim2.new(1, 0, 1, -45)
list.Position = UDim2.new(0, 0, 0, 45)
list.BackgroundTransparency = 1
list.BorderSizePixel = 0
list.Parent = content

local layout = Instance.new("UIListLayout")
layout.SortOrder = Enum.SortOrder.Name
layout.Padding = UDim.new(0, 8)
layout.Parent = list

local padding = Instance.new("UIPadding")
padding.PaddingTop = UDim.new(0, 8)
padding.PaddingBottom = UDim.new(0, 10)
padding.PaddingLeft = UDim.new(0, 10)
padding.PaddingRight = UDim.new(0, 10)
padding.Parent = list
--========================
-- Mini button (when hidden) - IMAGE ICON (no text)
--========================
local miniBtn = Instance.new("TextButton")
miniBtn.Size = UDim2.new(0, 55, 0, 55)
miniBtn.Position = UDim2.new(1, -65, 0, 10)

miniBtn.BackgroundColor3 = Color3.fromRGB(48,48,58)
miniBtn.BackgroundTransparency = 0.06
miniBtn.BorderSizePixel = 0

miniBtn.Text = "" -- no emoji text
miniBtn.AutoButtonColor = false
miniBtn.Visible = false
miniBtn.Parent = screenGui
addCorner(miniBtn, 16)

addGradient(
	miniBtn,
	Color3.fromRGB(58,58,72),
	Color3.fromRGB(34,34,44),
	135
)

-- Icon shadow (helps it pop on any background)
local iconShadow = Instance.new("ImageLabel")
iconShadow.Name = "IconShadow"
iconShadow.BackgroundTransparency = 1
iconShadow.Size = UDim2.new(0, 28, 0, 28)
iconShadow.Position = UDim2.new(0.5, -14 + 1, 0.5, -14 + 1)
iconShadow.Image = MINI_BTN_ICON
iconShadow.ImageColor3 = Color3.fromRGB(0,0,0)
iconShadow.ImageTransparency = 0.55
iconShadow.ScaleType = Enum.ScaleType.Fit
iconShadow.Parent = miniBtn

-- Main icon (bright + crisp)
local icon = Instance.new("ImageLabel")
icon.Name = "Icon"
icon.BackgroundTransparency = 1
icon.Size = UDim2.new(0, 28, 0, 28)
icon.Position = UDim2.new(0.5, -14, 0.5, -14)
icon.Image = MINI_BTN_ICON
icon.ImageColor3 = Color3.fromRGB(255,255,255)
icon.ImageTransparency = 0
icon.ScaleType = Enum.ScaleType.Fit
icon.Parent = miniBtn

-- Subtle hover polish
miniBtn.MouseEnter:Connect(function()
	TweenService:Create(miniBtn, TweenInfo.new(0.12), {BackgroundTransparency = 0.02}):Play()
end)
miniBtn.MouseLeave:Connect(function()
	TweenService:Create(miniBtn, TweenInfo.new(0.12), {BackgroundTransparency = 0.06}):Play()
end)



--========================
-- Toggle (smooth fade for ALL via CanvasGroup)
--========================
local function toggle()
	if isAnimating then return end
	isAnimating = true
	isVisible = not isVisible

	if isVisible then
		mainFrame.Visible = true
		miniBtn.Visible = false
		content.GroupTransparency = 1

		TweenService:Create(mainFrame, TweenInfo.new(ANIMATION_SPEED, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
			Position = UDim2.new(1, -(THEME.Width + 10), 0, 10)
		}):Play()

		TweenService:Create(content, TweenInfo.new(ANIMATION_SPEED * 0.75, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
			GroupTransparency = 0
		}):Play()

		task.delay(ANIMATION_SPEED + 0.05, function()
			isAnimating = false
		end)
	else
		TweenService:Create(content, TweenInfo.new(ANIMATION_SPEED * 0.75, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
			GroupTransparency = 1
		}):Play()

		TweenService:Create(mainFrame, TweenInfo.new(ANIMATION_SPEED, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
			Position = UDim2.new(1, 120, 0, 10)
		}):Play()

		task.delay(ANIMATION_SPEED, function()
			mainFrame.Visible = false
			miniBtn.Visible = true
			isAnimating = false
		end)
	end
end

closeBtn.MouseButton1Click:Connect(toggle)
miniBtn.MouseButton1Click:Connect(toggle)

UserInputService.InputBegan:Connect(function(input, gpe)
	if gpe then return end
	if input.KeyCode == Enum.KeyCode.Tab then
		toggle()
	end
end)

--========================
-- Entries
--========================
local entries = {}

local function createEntry(plr)
	local e = Instance.new("Frame")
	e.Name = plr.Name
	e.Size = UDim2.new(1, 0, 0, 34)
	e.BackgroundColor3 = THEME.EntryBG
	e.BackgroundTransparency = 0.12
	e.BorderSizePixel = 0
	e.Parent = list

	addCorner(e, 10)
	local es = addStroke(e, THEME.EntryStroke, 1, THEME.EntryStrokeT)
	local eGrad = addGradient(e, THEME.EntryBG, Color3.fromRGB(22,22,28), 135)


	-- Avatar
	local avatar = Instance.new("ImageLabel")
	avatar.Name = "Avatar"
	avatar.Size = UDim2.new(0, 26, 0, 26)
	avatar.Position = UDim2.new(0, 6, 0, 4)
	avatar.BackgroundTransparency = 1
	avatar.Image = "rbxthumb://type=AvatarHeadShot&id=" .. plr.UserId .. "&w=100&h=100"
	avatar.Parent = e
	addCorner(avatar, 999)

	-- Name
	local name = Instance.new("TextLabel")
	name.Name = "Name"
	name.Size = UDim2.new(1, -130, 1, 0)
	name.Position = UDim2.new(0, 40, 0, 0)
	name.BackgroundTransparency = 1
	name.Text = plr.Name
	name.TextColor3 = (plr == player) and Color3.fromRGB(180, 220, 255) or THEME.Text
	name.TextSize = 14
	name.Font = (plr == player) and Enum.Font.GothamBold or Enum.Font.Gotham
	name.TextXAlignment = Enum.TextXAlignment.Left
	name.TextTruncate = Enum.TextTruncate.AtEnd
	name.Parent = e

	-- Cash
	local cashLabel = Instance.new("TextLabel")
	cashLabel.Name = "CashLabel"
	cashLabel.Size = UDim2.new(0, 70, 1, 0)
	cashLabel.Position = UDim2.new(1, -150, 0, 0)
	cashLabel.BackgroundTransparency = 1
	cashLabel.Text = "$0"
	cashLabel.TextColor3 = THEME.Money
	cashLabel.TextSize = 14
	cashLabel.Font = Enum.Font.GothamBold
	cashLabel.TextXAlignment = Enum.TextXAlignment.Right
	cashLabel.Parent = e

	-- Wins
	local winsLabel = Instance.new("TextLabel")
	winsLabel.Name = "WinsLabel"
	winsLabel.Size = UDim2.new(0, 70, 1, 0)
	winsLabel.Position = UDim2.new(1, -75, 0, 0)
	winsLabel.BackgroundTransparency = 1
	winsLabel.Text = "0 W"
	winsLabel.TextColor3 = WINS_COLOR
	winsLabel.TextSize = 14
	winsLabel.Font = Enum.Font.GothamBold
	winsLabel.TextXAlignment = Enum.TextXAlignment.Right
	winsLabel.Parent = e

	-- Local player highlight (NO glow, just clean stroke tweak)
	local ls = plr:FindFirstChild("leaderstats")
	local vipValue = false
	if ls then
		local vipObj = ls:FindFirstChild("VIP")
		if vipObj and vipObj.Value == true then
			vipValue = true
		end
	end

	if (plr == player) and (not vipValue) then
		e.BackgroundColor3 = Color3.fromRGB(28,28,34)
		e.BackgroundTransparency = 0.10
		es.Color = Color3.fromRGB(180,180,190)
		es.Thickness = 1.5
		es.Transparency = 0.55
	end

	-- VIP styling (modern champagne VIP: muted, premium, matches dark UI)
	if vipValue then
		-- Muted ‚Äúchampagne‚Äù palette (NOT bright yellow)
		local VIP_BG_TOP    = Color3.fromRGB(62, 52, 30)
		local VIP_BG_BOTTOM = Color3.fromRGB(32, 28, 18)
		local VIP_BORDER    = Color3.fromRGB(165, 145, 92)   -- soft champagne
		local VIP_SOFT      = Color3.fromRGB(255, 242, 205)  -- warm highlight (subtle)

		-- Background / gradient
		e.BackgroundColor3 = VIP_BG_TOP
		e.BackgroundTransparency = 0.16

		if eGrad then
			eGrad.Color = ColorSequence.new({
				ColorSequenceKeypoint.new(0, VIP_BG_TOP),
				ColorSequenceKeypoint.new(1, VIP_BG_BOTTOM),
			})
			eGrad.Rotation = 135
		end

		-- Border: thinner + more transparent so it blends with your modern style
		es.Color = VIP_BORDER
		es.Thickness = 1.6
		es.Transparency = 0.42

		-- Extra ‚Äúdepth‚Äù stroke (very faint, NOT a glow)
		local vipInner = Instance.new("UIStroke")
		vipInner.Color = VIP_SOFT
		vipInner.Thickness = 1
		vipInner.Transparency = 0.88
		vipInner.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
		vipInner.Parent = e

		-- Make VIP name slightly warmer (optional but looks premium)
		task.defer(function()
			local n = e:FindFirstChild("Name")
			if n then
				n.TextColor3 = Color3.fromRGB(245, 235, 205)
				n.Font = Enum.Font.GothamBold
			end
		end)

		-- VIP tag (same star but soft + clean)
		local vipTag = Instance.new("TextLabel")
		vipTag.Name = "VIPTag"
		vipTag.Size = UDim2.new(0, 18, 1, 0)
		vipTag.Position = UDim2.new(0, 0, 0, 0) -- positioned in updateEntry
		vipTag.BackgroundTransparency = 1
		vipTag.Text = "‚≠ê"
		vipTag.TextColor3 = VIP_SOFT
		vipTag.TextTransparency = 0.12
		vipTag.TextSize = 13
		vipTag.Font = Enum.Font.GothamBold
		vipTag.Parent = e

		-- Shimmer sweep (kept, but MUCH more subtle + slower)
		local shimmer = Instance.new("Frame")
		shimmer.Name = "Shimmer"
		shimmer.Size = UDim2.new(0, 32, 1, 0)
		shimmer.Position = UDim2.new(-0.25, 0, 0, 0)
		shimmer.BackgroundTransparency = 1
		shimmer.ZIndex = 10
		shimmer.Parent = e

		local shimmerGrad = Instance.new("UIGradient")
		shimmerGrad.Rotation = 0
		shimmerGrad.Color = ColorSequence.new({
			ColorSequenceKeypoint.new(0, Color3.fromRGB(255,255,255)),
			ColorSequenceKeypoint.new(0.5, VIP_SOFT),
			ColorSequenceKeypoint.new(1, Color3.fromRGB(255,255,255))
		})
		-- key change: faint highlight, not a bright bar
		shimmerGrad.Transparency = NumberSequence.new({
			NumberSequenceKeypoint.new(0, 1),
			NumberSequenceKeypoint.new(0.5, 0.84),
			NumberSequenceKeypoint.new(1, 1)
		})
		shimmerGrad.Parent = shimmer

		task.spawn(function()
			while e and e.Parent do
				TweenService:Create(shimmer, TweenInfo.new(2.8, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {
					Position = UDim2.new(1.25, 0, 0, 0)
				}):Play()
				task.wait(2.8)
				shimmer.Position = UDim2.new(-0.25, 0, 0, 0)
				task.wait(0.7)
			end
		end)
	end


	return e
end

local function updateEntry(plr, e)
	-- Name + tags
	local name = e:FindFirstChild("Name")
	if name then
		local s = getStrings(plr)
		local n = plr.Name
		if #s > 0 then
			n = "[" .. table.concat(s, "] [") .. "] " .. n
		end

		if name.Text ~= n then
			name.Text = n
			local oc = name.TextColor3
			name.TextColor3 = Color3.fromRGB(255, 255, 255)
			TweenService:Create(name, TweenInfo.new(0.35, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {TextColor3 = oc}):Play()
		end

		local vipTag = e:FindFirstChild("VIPTag")
		if vipTag then
			local maxX = e.AbsoluteSize.X - 160
			local x = 40 + math.min(name.TextBounds.X + 6, maxX)
			vipTag.Position = UDim2.new(0, math.floor(x), 0, 0)
		end
	end

	-- Wins
	local winsLabel = e:FindFirstChild("WinsLabel")
	if winsLabel then
		local winsValue = 0
		local ls = plr:FindFirstChild("leaderstats")
		if ls then
			local winsObj = ls:FindFirstChild("Wins")
			if winsObj and winsObj:IsA("IntValue") then
				winsValue = winsObj.Value
			end
		end

		local newText = tostring(winsValue) .. " W"
		if winsLabel.Text ~= newText then
			winsLabel.Text = newText
			winsLabel.TextColor3 = Color3.fromRGB(180, 255, 180)
			TweenService:Create(winsLabel, TweenInfo.new(0.35, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {TextColor3 = WINS_COLOR}):Play()
		end
	end

	-- Cash
	local cashLabel = e:FindFirstChild("CashLabel")
	if cashLabel then
		local cashValue = 0
		local ls = plr:FindFirstChild("leaderstats")
		if ls then
			local cashObj = ls:FindFirstChild("Cash")
			if cashObj and cashObj:IsA("IntValue") then
				cashValue = cashObj.Value
			end
		end

		local newText = "$" .. formatNumber(cashValue)
		if cashLabel.Text ~= newText then
			cashLabel.Text = newText
			cashLabel.TextStrokeColor3 = THEME.Money
			cashLabel.TextStrokeTransparency = 0.85
			TweenService:Create(cashLabel, TweenInfo.new(0.55, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
				TextStrokeTransparency = 1
			}):Play()
		end
	end
end

local function updateAll()
	local all = Players:GetPlayers()
	local count = #all

	title.Text = "PLAYERS (" .. count .. ")"

	for _, plr in ipairs(all) do
		local e = entries[plr.UserId]
		if not e or not e.Parent then
			e = createEntry(plr)
			entries[plr.UserId] = e

			e.Position = UDim2.new(0, 40, 0, 0)
			local bt = e.BackgroundTransparency
			e.BackgroundTransparency = 1
			TweenService:Create(e, TweenInfo.new(ANIMATION_SPEED, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
				Position = UDim2.new(0, 0, 0, 0),
				BackgroundTransparency = bt
			}):Play()
		end

		updateEntry(plr, e)
	end

	for uid, e in pairs(entries) do
		local found = false
		for _, plr in ipairs(all) do
			if plr.UserId == uid then
				found = true
				break
			end
		end
		if not found then
			TweenService:Create(e, TweenInfo.new(ANIMATION_SPEED, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
				Position = UDim2.new(0, -40, 0, 0),
				BackgroundTransparency = 1
			}):Play()
			task.delay(ANIMATION_SPEED, function()
				if e then e:Destroy() end
			end)
			entries[uid] = nil
		end
	end

	local h = 45 + (count * 38) + 14
	TweenService:Create(mainFrame, TweenInfo.new(ANIMATION_SPEED, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		Size = UDim2.new(0, THEME.Width, 0, math.min(h, 550))
	}):Play()
end

local function monitor(plr)
	local ls = plr:FindFirstChild("leaderstats") or plr:WaitForChild("leaderstats", 10)
	if not ls then return end

	local function hook(v)
		if v:IsA("StringValue")
			or (v.Name == "Wins" and v:IsA("IntValue"))
			or (v.Name == "Cash" and v:IsA("IntValue"))
			or (v.Name == "VIP" and v:IsA("BoolValue")) then

			v.Changed:Connect(function()
				task.wait(0.05)
				updateAll()
			end)
		end
	end

	for _, c in ipairs(ls:GetChildren()) do hook(c) end
	ls.ChildAdded:Connect(function(c)
		hook(c)
		task.wait(0.05)
		updateAll()
	end)
	ls.ChildRemoved:Connect(function()
		task.wait(0.05)
		updateAll()
	end)
end

Players.PlayerAdded:Connect(function(plr)
	task.wait(0.4)
	monitor(plr)
	updateAll()
end)

Players.PlayerRemoving:Connect(function()
	task.wait(0.05)
	updateAll()
end)

for _, plr in ipairs(Players:GetPlayers()) do
	task.spawn(monitor, plr)
end

task.spawn(function()
	while true do
		task.wait(REFRESH_RATE)
		updateAll()
	end
end)

task.wait(0.5)
updateAll()

print("‚úÖ Leaderboard loaded - clean + smooth")
]]></ProtectedString>
					<bool name="Disabled">false</bool>
					<Content name="LinkedSource"><null></null></Content>
					<token name="RunContext">0</token>
					<string name="ScriptGuid">{AB804646-A9FF-44B7-B0C8-4704743885EE}</string>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">CustomLeaderboardClient</string>
					<int64 name="SourceAssetId">-1</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
			</Item>
			<Item class="LocalScript" referent="RBX7B2F367B415749E58B022B73BB02BE66">
				<Properties>
					<ProtectedString name="Source"><![CDATA[--// PlayerHoverCard.client.lua
--// StarterGui

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local camera = workspace.CurrentCamera

local MAX_DISTANCE = 50
local FADE_TIME = 0.12
local AVATAR_SIZE = 32

local function loadTitlesConfig()
	local configFolder = ReplicatedStorage:FindFirstChild("Configs")
	local module = configFolder and configFolder:FindFirstChild("TitlesConfig") or ReplicatedStorage:FindFirstChild("TitlesConfig")
	if not module then
		module = configFolder and configFolder:WaitForChild("TitlesConfig", 3) or ReplicatedStorage:WaitForChild("TitlesConfig", 3)
	end

	if module then
		local ok, result = pcall(require, module)
		if ok and typeof(result) == "table" then
			return result
		end
	end

	warn("[PlayerHoverCard] TitlesConfig not found or failed to load; using defaults.")
	return { Titles = {} }
end

local titlesConfig = loadTitlesConfig()
local titlesById = {}
for _, title in ipairs(titlesConfig.Titles or {}) do
	if title and title.Id then
		titlesById[title.Id] = title
	end
end

local rarityColors = {
	Common = Color3.fromRGB(160, 160, 170),
	Uncommon = Color3.fromRGB(120, 200, 150),
	Rare = Color3.fromRGB(120, 170, 255),
	Epic = Color3.fromRGB(190, 140, 255),
	Legendary = Color3.fromRGB(235, 200, 120),
}

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "PlayerHoverCard"
screenGui.IgnoreGuiInset = true
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local card = Instance.new("Frame")
card.Name = "Card"
card.Size = UDim2.new(0, 260, 0, 74)
card.BackgroundColor3 = Color3.fromRGB(16, 16, 22)
card.BackgroundTransparency = 1
card.BorderSizePixel = 0
card.Visible = false
card.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = card

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(255, 255, 255)
stroke.Thickness = 1
stroke.Transparency = 1
stroke.Parent = card

local gradient = Instance.new("UIGradient")
gradient.Rotation = 135
gradient.Color = ColorSequence.new(Color3.fromRGB(20, 20, 28), Color3.fromRGB(10, 10, 14))
gradient.Parent = card

local scale = Instance.new("UIScale")
scale.Scale = 0.98
scale.Parent = card

local avatar = Instance.new("ImageLabel")
avatar.Name = "Avatar"
avatar.BackgroundColor3 = Color3.fromRGB(24, 24, 32)
avatar.BackgroundTransparency = 1
avatar.BorderSizePixel = 0
avatar.Position = UDim2.new(0, 12, 0, 20)
avatar.Size = UDim2.new(0, AVATAR_SIZE, 0, AVATAR_SIZE)
avatar.Image = ""
avatar.ScaleType = Enum.ScaleType.Crop
avatar.ImageTransparency = 1
avatar.Parent = card
local avatarCorner = Instance.new("UICorner")
avatarCorner.CornerRadius = UDim.new(0, AVATAR_SIZE / 2)
avatarCorner.Parent = avatar

local nameLabel = Instance.new("TextLabel")
nameLabel.BackgroundTransparency = 1
nameLabel.Position = UDim2.new(0, 12 + AVATAR_SIZE + 10, 0, 16)
nameLabel.Size = UDim2.new(1, -(24 + AVATAR_SIZE), 0, 22)
nameLabel.Font = Enum.Font.GothamMedium
nameLabel.TextSize = 17
nameLabel.TextColor3 = Color3.fromRGB(240, 236, 228)
nameLabel.TextXAlignment = Enum.TextXAlignment.Left
nameLabel.TextTransparency = 1
nameLabel.Parent = card

local titleLabel = Instance.new("TextLabel")
titleLabel.BackgroundTransparency = 1
titleLabel.Position = UDim2.new(0, 12 + AVATAR_SIZE + 10, 0, 38)
titleLabel.Size = UDim2.new(1, -(24 + AVATAR_SIZE), 0, 18)
titleLabel.Font = Enum.Font.Gotham
titleLabel.TextSize = 12
titleLabel.TextColor3 = Color3.fromRGB(170, 160, 140)
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.TextTransparency = 1
titleLabel.Parent = card

local fadeIn = TweenInfo.new(FADE_TIME, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local fadeOut = TweenInfo.new(FADE_TIME, Enum.EasingStyle.Quad, Enum.EasingDirection.In)

local function setVisible(visible: boolean)
	if visible then
		card.Visible = true
		TweenService:Create(card, fadeIn, {BackgroundTransparency = 0.08}):Play()
		TweenService:Create(stroke, fadeIn, {Transparency = 0.75}):Play()
		TweenService:Create(scale, fadeIn, {Scale = 1}):Play()
		TweenService:Create(avatar, fadeIn, {BackgroundTransparency = 0.15}):Play()
		TweenService:Create(avatar, fadeIn, {ImageTransparency = 0}):Play()
		TweenService:Create(nameLabel, fadeIn, {TextTransparency = 0}):Play()
		TweenService:Create(titleLabel, fadeIn, {TextTransparency = 0}):Play()
	else
		TweenService:Create(card, fadeOut, {BackgroundTransparency = 1}):Play()
		TweenService:Create(stroke, fadeOut, {Transparency = 1}):Play()
		TweenService:Create(scale, fadeOut, {Scale = 0.98}):Play()
		TweenService:Create(avatar, fadeOut, {BackgroundTransparency = 1}):Play()
		TweenService:Create(avatar, fadeOut, {ImageTransparency = 1}):Play()
		TweenService:Create(nameLabel, fadeOut, {TextTransparency = 1}):Play()
		TweenService:Create(titleLabel, fadeOut, {TextTransparency = 1}):Play()
		task.delay(FADE_TIME, function()
			if card.BackgroundTransparency >= 0.95 then
				card.Visible = false
			end
		end)
	end
end

local function getTitleName(titleId: string?)
	if not titleId or titleId == "" then
		return "No Title Equipped"
	end
	local title = titlesById[titleId]
	return title and title.Name or "No Title Equipped"
end

local function getTitleAccent(titleId: string?)
	if not titleId or titleId == "" then
		return Color3.fromRGB(120, 120, 130)
	end
	local title = titlesById[titleId]
	local rarity = title and title.Rarity
	return (rarity and rarityColors[rarity]) or Color3.fromRGB(170, 160, 140)
end

local function getTargetPlayer(mousePos: Vector2): Player?
	if not camera then return nil end
	local ray = camera:ScreenPointToRay(mousePos.X, mousePos.Y)
	local params = RaycastParams.new()
	params.FilterType = Enum.RaycastFilterType.Blacklist
	params.FilterDescendantsInstances = { player.Character }
	params.IgnoreWater = true

	local result = workspace:Raycast(ray.Origin, ray.Direction * 500, params)
	if not result or not result.Instance then
		return nil
	end

	local hit = result.Instance
	local char = hit:FindFirstAncestorOfClass("Model")
	local targetPlayer = char and Players:GetPlayerFromCharacter(char)
	if not targetPlayer then
		return nil
	end

	local myChar = player.Character
	local myRoot = myChar and myChar:FindFirstChild("HumanoidRootPart")
	local targetRoot = char and char:FindFirstChild("HumanoidRootPart")
	if not myRoot or not targetRoot then
		return nil
	end

	if (myRoot.Position - targetRoot.Position).Magnitude > MAX_DISTANCE then
		return nil
	end

	return targetPlayer
end

local currentTarget: Player? = nil
local currentAvatarUserId: number? = nil

RunService.RenderStepped:Connect(function()
	local mousePos = UserInputService:GetMouseLocation()
	card.Position = UDim2.new(0, mousePos.X + 16, 0, mousePos.Y + 12)

	local targetPlayer = getTargetPlayer(mousePos)
	if targetPlayer ~= currentTarget then
		currentTarget = targetPlayer
		if currentTarget then
			nameLabel.Text = currentTarget.DisplayName .. " @" .. currentTarget.Name
			local equippedTitle = currentTarget:GetAttribute("EquippedTitle")
			titleLabel.Text = getTitleName(equippedTitle)
			local accentColor = getTitleAccent(equippedTitle)
			titleLabel.TextColor3 = accentColor
			stroke.Color = accentColor
			if currentAvatarUserId ~= currentTarget.UserId then
				currentAvatarUserId = currentTarget.UserId
				task.spawn(function()
					local ok, content = pcall(function()
						return Players:GetUserThumbnailAsync(currentAvatarUserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size180x180)
					end)
					if ok and typeof(content) == "string" and currentAvatarUserId == currentTarget.UserId then
						avatar.Image = content
					end
				end)
			end
			setVisible(true)
		else
			setVisible(false)
		end
	elseif currentTarget then
		local equippedTitle = currentTarget:GetAttribute("EquippedTitle")
		titleLabel.Text = getTitleName(equippedTitle)
		local accentColor = getTitleAccent(equippedTitle)
		titleLabel.TextColor3 = accentColor
		stroke.Color = accentColor
	end
end)
]]></ProtectedString>
					<bool name="Disabled">false</bool>
					<Content name="LinkedSource"><null></null></Content>
					<token name="RunContext">0</token>
					<string name="ScriptGuid">{17C5E09D-0E49-4E4B-9C19-AC070A9D9A06}</string>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">PlayerHoverCard</string>
					<int64 name="SourceAssetId">-1</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
			</Item>
			<Item class="ScreenGui" referent="RBX7F656DDB86E543B19E86A3CF17FC1874">
				<Properties>
					<bool name="ClipToDeviceSafeArea">true</bool>
					<int name="DisplayOrder">0</int>
					<token name="SafeAreaCompatibility">1</token>
					<token name="ScreenInsets">2</token>
					<bool name="Enabled">true</bool>
					<bool name="ResetOnSpawn">true</bool>
					<token name="ZIndexBehavior">1</token>
					<bool name="AutoLocalize">true</bool>
					<Ref name="RootLocalizationTable">null</Ref>
					<token name="SelectionBehaviorDown">0</token>
					<token name="SelectionBehaviorLeft">0</token>
					<token name="SelectionBehaviorRight">0</token>
					<token name="SelectionBehaviorUp">0</token>
					<bool name="SelectionGroup">false</bool>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">PlayerCard</string>
					<int64 name="SourceAssetId">124873348702500</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
				<Item class="LocalScript" referent="RBXD39E143194D5463591C23A6B3E06090B">
					<Properties>
						<ProtectedString name="Source"><![CDATA[--//========================================================
--// PlayerCardUi_EliteTabs.client.lua  | DevPanels (V3)
--// Premium Profile Hub w/ Tabs: Overview / Collectables / Titles
--// Fixes:
--//   ‚úÖ Removed Badges tab + all badge logic
--//   ‚úÖ Tabs no longer jump to the wrong page (no index confusion)
--//   ‚úÖ No more ‚Äúside page bleed‚Äù (clips pages + disables swipe inputs)
--//========================================================

--//////////////////////////////////////////////////////////
-- SERVICES
--//////////////////////////////////////////////////////////
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local GuiService = game:GetService("GuiService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local function loadStatsConfig()
	local configFolder = ReplicatedStorage:FindFirstChild("Configs")
	local module = configFolder and configFolder:FindFirstChild("StatsConfig") or ReplicatedStorage:FindFirstChild("StatsConfig")
	if not module then
		module = configFolder and configFolder:FindFirstChild("StatConfig") or ReplicatedStorage:FindFirstChild("StatConfig")
	end
	if not module then
		module = configFolder and configFolder:WaitForChild("StatsConfig", 3) or ReplicatedStorage:WaitForChild("StatsConfig", 3)
	end
	if not module then
		module = configFolder and configFolder:WaitForChild("StatConfig", 3) or ReplicatedStorage:WaitForChild("StatConfig", 3)
	end

	if module then
		local ok, result = pcall(require, module)
		if ok and typeof(result) == "table" then
			return result
		end
	end

	warn("[PlayerCardUi] StatsConfig not found or failed to load; using defaults.")
	return { Collectables = {} }
end

local StatsConfig = loadStatsConfig()
local LevelConfig = StatsConfig.Levels or {}
local CollectablesConfig = StatsConfig.Collectables or {}
local CollectablesPanelConfig = CollectablesConfig.RightPanel or {}
local CollectablesStatusConfig = CollectablesConfig.Status or {}
local COLLECTED_LABEL = CollectablesStatusConfig.CollectedLabel or "COLLECTED"
local MISSING_LABEL = CollectablesStatusConfig.MissingLabel or "MISSING"
local RARITY_PREFIX = CollectablesStatusConfig.RarityPrefix or "RARITY: "
local DESCRIPTION_FALLBACK = CollectablesStatusConfig.DescriptionFallback or "No description set."

local function loadTitlesConfig()
	local configFolder = ReplicatedStorage:FindFirstChild("Configs")
	local module = configFolder and configFolder:FindFirstChild("TitlesConfig") or ReplicatedStorage:FindFirstChild("TitlesConfig")
	if not module then
		module = configFolder and configFolder:WaitForChild("TitlesConfig", 3) or ReplicatedStorage:WaitForChild("TitlesConfig", 3)
	end

	if module then
		local ok, result = pcall(require, module)
		if ok and typeof(result) == "table" then
			return result
		end
	end

	warn("[PlayerCardUi] TitlesConfig not found or failed to load; using defaults.")
	return { Titles = {} }
end

local TitlesConfig = loadTitlesConfig()

--//////////////////////////////////////////////////////////
-- PLAYER / GUI
--//////////////////////////////////////////////////////////
local plr = Players.LocalPlayer
local playerGui = plr:WaitForChild("PlayerGui")
local gui = script.Parent :: ScreenGui
gui.Enabled = true
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false

local toggleEvent = gui:FindFirstChild("TogglePlayerCard")
if not toggleEvent then
	toggleEvent = Instance.new("BindableEvent")
	toggleEvent.Name = "TogglePlayerCard"
	toggleEvent.Parent = gui
end

--//////////////////////////////////////////////////////////
-- SETTINGS
--//////////////////////////////////////////////////////////
local OPEN_BUTTON_NAMES = { "PlayerCardButton", "TopBarEdit" }
local CLOSE_WITH_ESC = true
local CLOSE_ON_DIM_CLICK = true

-- Mobile scale tuning
local MOBILE_SCALE_PADDING = 0.88
local MIN_SCALE = 0.56
local MAX_SCALE = 1.00

-- Click sound
local CLICK_SOUND_ID = "rbxassetid://95635059379804"
local CLICK_VOLUME = 0.85

-- Playtime & XP
local XP_PER_LEVEL = LevelConfig.XPPerLevel or 1000
local XP_PER_MINUTE = LevelConfig.XPPerMinute or 250
local XP_PER_SECOND = XP_PER_MINUTE / 60
local sessionXP = 0

-- Stats source
local STAT_SOURCE_MODE = LevelConfig.StatSourceMode or "SessionOnly" -- "SessionOnly" or "Leaderstats"
local leaderConfig = LevelConfig.Leaderstats or {}
local LEADERSTAT_XP_NAME = leaderConfig.XP or "XP"
local LEADERSTAT_PLAYTIME_NAME = leaderConfig.PlaytimeSeconds or "PlaytimeSeconds"

--//////////////////////////////////////////////////////////
-- THEME
--//////////////////////////////////////////////////////////
local THEME = {
	Black = Color3.fromRGB(0,0,0),
	BG = Color3.fromRGB(8,8,10),
	Panel = Color3.fromRGB(14,12,10),
	Card = Color3.fromRGB(18,16,14),
	Card2 = Color3.fromRGB(12,10,8),

	Text = Color3.fromRGB(240,236,228),
	Muted = Color3.fromRGB(170,160,140),

	Accent = Color3.fromRGB(212,175,55),
	AccentDark = Color3.fromRGB(78,60,24),
	TabInactive = Color3.fromRGB(140,110,32),

	Good = Color3.fromRGB(105, 255, 140),
	Warn = Color3.fromRGB(255, 200, 100),
	Bad  = Color3.fromRGB(255, 110, 110),
}

--//////////////////////////////////////////////////////////
-- DATA (Titles from TitlesConfig; Collectables come from server catalog)
--//////////////////////////////////////////////////////////
local DATA = {
	Titles = TitlesConfig.Titles or {},
	Rarity = {
		Common    = { Color=Color3.fromRGB(150,150,160) },
		Uncommon  = { Color=Color3.fromRGB(120,200,140) },
		Rare      = { Color=Color3.fromRGB(120,170,255) },
		Epic      = { Color=Color3.fromRGB(200,120,255) },
		Legendary = { Color=Color3.fromRGB(255,210,110) },
	},
}

table.sort(DATA.Titles, function(a, b)
	local aLevel = tonumber(a.RequiredLevel) or 0
	local bLevel = tonumber(b.RequiredLevel) or 0
	if aLevel == bLevel then
		return (a.Name or a.Id or "") < (b.Name or b.Id or "")
	end
	return aLevel < bLevel
end)

do
	local seen = {}
	for _, title in ipairs(DATA.Titles) do
		local id = title and title.Id
		if not id then
			warn("[PlayerCardUi] Title missing Id in TitlesConfig.")
		elseif seen[id] then
			warn(("[PlayerCardUi] Duplicate Title Id detected in TitlesConfig: %s"):format(id))
		else
			seen[id] = true
		end
	end
end

local function rarityColor(name: string?)
	local r = name and DATA.Rarity[name]
	return (r and r.Color) or DATA.Rarity.Common.Color
end

--//////////////////////////////////////////////////////////
-- COLLECTABLES CATALOG (from server)
--//////////////////////////////////////////////////////////
local CatalogFolder = ReplicatedStorage:WaitForChild("CollectablesCatalog", 10)
local PreviewFolder = ReplicatedStorage:FindFirstChild("CollectablesPreview")

local function getCollectablesCatalog()
	local list = {}

	if CatalogFolder then
		for _, entry in ipairs(CatalogFolder:GetChildren()) do
			table.insert(list, {
				Id = entry.Name,
				Name = entry:GetAttribute("Name") or entry.Name,
				Desc = entry:GetAttribute("Desc") or "",
				Image = entry:GetAttribute("Image") or "",
				Rarity = entry:GetAttribute("Rarity") or "Common",
			})
		end
		table.sort(list, function(a,b) return (a.Name or a.Id) < (b.Name or b.Id) end)
	end

	return list
end

local COLLECTABLES = getCollectablesCatalog()

local function getCollectableConfig(id: string)
	local items = CollectablesConfig.Items
	if typeof(items) == "table" then
		return items[id] or {}
	end
	return {}
end

local function getCollectableDisplay(item)
	local config = getCollectableConfig(item.Id)
	local rarity = config.Rarity or item.Rarity
	return {
		Id = item.Id,
		Name = config.Name or item.Name,
		Desc = config.Description or item.Desc or "",
		Tagline = config.Tagline or "",
		Rarity = rarity,
		Accent = config.AccentColor or rarityColor(rarity),
		Highlights = config.Highlights or {},
	}
end

local function formatPanelText(text, fallback, name)
	if typeof(text) ~= "string" or text == "" then
		return fallback
	end
	return text:gsub("{name}", name or "Collectable")
end

--//////////////////////////////////////////////////////////
-- TITLES REMOTES
--//////////////////////////////////////////////////////////
local titlesRemotes = ReplicatedStorage:WaitForChild("TitlesRemotes", 5)
local titlesEquipEvent = titlesRemotes and titlesRemotes:FindFirstChild("EquipTitle")

--//////////////////////////////////////////////////////////
-- SOUND
--//////////////////////////////////////////////////////////
local clickSound = Instance.new("Sound")
clickSound.Name = "DevPanels_Click"
clickSound.SoundId = CLICK_SOUND_ID
clickSound.Volume = CLICK_VOLUME
clickSound.Parent = gui

local function click()
	clickSound.TimePosition = 0
	clickSound:Play()
end

--//////////////////////////////////////////////////////////
-- UI HELPERS
--//////////////////////////////////////////////////////////
local function new(className, props)
	local inst = Instance.new(className)
	for k,v in pairs(props or {}) do inst[k] = v end
	return inst
end

local function corner(parent, px)
	return new("UICorner", {CornerRadius = UDim.new(0, px), Parent = parent})
end

local function stroke(parent, thick, transparency, color)
	return new("UIStroke", {
		Thickness = thick,
		Color = color or THEME.Black,
		Transparency = transparency or 0,
		LineJoinMode = Enum.LineJoinMode.Round,
		Parent = parent
	})
end

local function gradient(parent, c1, c2, rot)
	local g = new("UIGradient", {Rotation = rot or 135, Parent = parent})
	g.Color = ColorSequence.new(c1, c2)
	return g
end

local function shadow(parent, alpha)
	return new("UIStroke", {
		Thickness = 10,
		Color = THEME.Black,
		Transparency = alpha or 0.78,
		LineJoinMode = Enum.LineJoinMode.Round,
		Parent = parent
	})
end

local function outlineText(obj)
	if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
		obj.TextStrokeTransparency = 0.55
		obj.TextStrokeColor3 = THEME.Black
	end
end

local function tween(obj, ti, props)
	local t = TweenService:Create(obj, ti, props)
	t:Play()
	return t
end

local function addButtonFX(btn: GuiButton, hoverScale, pressScale)
	hoverScale = hoverScale or 1.06
	pressScale = pressScale or 0.94

	local s = btn:FindFirstChildOfClass("UIScale") or new("UIScale", {Scale = 1, Parent = btn})
	btn.AutoButtonColor = false

	btn.MouseEnter:Connect(function()
		tween(s, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = hoverScale})
	end)
	btn.MouseLeave:Connect(function()
		tween(s, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1})
	end)

	btn.MouseButton1Down:Connect(function()
		tween(s, TweenInfo.new(0.08, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = pressScale})
	end)
	btn.MouseButton1Up:Connect(function()
		tween(s, TweenInfo.new(0.10, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = hoverScale})
	end)

	btn.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.Touch then
			tween(s, TweenInfo.new(0.08, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = pressScale})
		end
	end)
	btn.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.Touch then
			tween(s, TweenInfo.new(0.10, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1})
		end
	end)
end

local function formatTime(seconds)
	seconds = math.max(0, math.floor(seconds))
	local h = math.floor(seconds / 3600)
	local m = math.floor((seconds % 3600) / 60)
	local s = seconds % 60
	if h > 0 then return string.format("%dh %dm", h, m) end
	if m > 0 then return string.format("%dm %ds", m, s) end
	return string.format("%ds", s)
end

local function computeLevel(totalXP)
	totalXP = math.max(0, math.floor(totalXP))
	local lvl = math.floor(totalXP / XP_PER_LEVEL) + 1
	local inLevel = totalXP % XP_PER_LEVEL
	local alpha = inLevel / XP_PER_LEVEL
	return lvl, inLevel, alpha, totalXP
end

local function tweenBar(fillObj: Frame, knobObj: Frame, alpha: number)
	alpha = math.clamp(alpha, 0, 1)
	tween(fillObj, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(alpha, 0, 1, 0)})
	tween(knobObj, TweenInfo.new(0.18, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = UDim2.new(alpha, -9, 0.5, -9)})
end

--//////////////////////////////////////////////////////////
-- PROGRESS SOURCES (Attributes / Folders)
--//////////////////////////////////////////////////////////
local function hasBoolInFolder(folderName, key)
	local f = plr:FindFirstChild(folderName)
	if not f then return nil end
	local b = f:FindFirstChild(key)
	if b and b:IsA("BoolValue") then return b.Value end
	return nil
end

local function getCollectedCollectable(id: string): boolean
	local a = plr:GetAttribute("Collectable_" .. id)
	if typeof(a) == "boolean" then return a end
	local f = hasBoolInFolder("Collectables", id)
	if typeof(f) == "boolean" then return f end
	return false
end

local function getUnlockedTitle(id: string): boolean
	local a = plr:GetAttribute("Title_" .. id)
	if typeof(a) == "boolean" then return a end
	local f = hasBoolInFolder("Titles", id)
	if typeof(f) == "boolean" then return f end

	local xpValue = 0
	if STAT_SOURCE_MODE == "Leaderstats" then
		local ls = plr:FindFirstChild("leaderstats")
		local xpObj = ls and ls:FindFirstChild(LEADERSTAT_XP_NAME)
		if xpObj and xpObj:IsA("IntValue") then
			xpValue = xpObj.Value
		end
	else
		xpValue = sessionXP
	end

	local level = select(1, computeLevel(xpValue))
	for _, title in ipairs(DATA.Titles) do
		if title.Id == id then
			local req = tonumber(title.RequiredLevel) or 0
			return level >= req
		end
	end
	return false
end

local function getEquippedTitleId(): string?
	local a = plr:GetAttribute("EquippedTitle")
	if typeof(a) == "string" and a ~= "" then return a end
	return nil
end

local function setEquippedTitleId(id: string?)
	if titlesEquipEvent then
		titlesEquipEvent:FireServer(id or "")
	else
		plr:SetAttribute("EquippedTitle", id or "")
	end
end

--//////////////////////////////////////////////////////////
-- RESPONSIVE SCALE / SAFE VIEWPORT
--//////////////////////////////////////////////////////////
local baseSize = Vector2.new(1180, 620)

local function getSafeViewport()
	local vp = gui.AbsoluteSize
	local insetX, insetY = 0, 0

	local okInset, inset = pcall(function() return GuiService:GetGuiInset() end)
	if okInset and (typeof(inset) == "Vector2" or typeof(inset) == "Vector2int16") then
		insetY += inset.Y
	end

	local okSafe, left, top, right, bottom = pcall(function()
		return GuiService:GetSafeZoneOffsets()
	end)
	if okSafe then
		insetX += (left + right)
		insetY += (top + bottom)
	end

	return Vector2.new(math.max(1, vp.X - insetX), math.max(1, vp.Y - insetY))
end

local function computeTargetScale()
	local vp = getSafeViewport()
	local s = math.min(vp.X / baseSize.X, vp.Y / baseSize.Y) * MOBILE_SCALE_PADDING
	return math.clamp(s, MIN_SCALE, MAX_SCALE)
end

--//////////////////////////////////////////////////////////
-- BUILD UI (rebuild-safe)
--//////////////////////////////////////////////////////////
local old = gui:FindFirstChild("EliteProfileHub")
if old then old:Destroy() end

local root = new("Frame", {
	Name = "EliteProfileHub",
	BackgroundTransparency = 1,
	Size = UDim2.fromScale(1,1),
	Parent = gui
})

local dim = new("TextButton", {
	Name = "Dim",
	Text = "",
	BackgroundColor3 = THEME.Black,
	BackgroundTransparency = 1,
	Size = UDim2.fromScale(1,1),
	AutoButtonColor = false,
	Visible = false,
	Parent = root
})

local group = new("CanvasGroup", {
	Name = "Group",
	BackgroundTransparency = 1,
	GroupTransparency = 1,
	Visible = false,
	Size = UDim2.fromScale(1, 1),
	Position = UDim2.fromScale(0, 0),
	AnchorPoint = Vector2.new(0, 0),
	Parent = root
})

local panel = new("Frame", {
	Name = "Panel",
	AnchorPoint = Vector2.new(0.5,0.5),
	Position = UDim2.fromScale(0.5,0.5),
	Size = UDim2.new(0, baseSize.X, 0, baseSize.Y),
	BackgroundColor3 = THEME.BG,
	BorderSizePixel = 0,
	Parent = group
})
corner(panel, 26)
stroke(panel, 3, 0, THEME.Black)
shadow(panel, 0.78)
gradient(panel, THEME.BG, Color3.fromRGB(8,8,12), 135)

local uiScale = new("UIScale", {Scale = computeTargetScale() * 0.94, Parent = panel})

-- Header
local header = new("Frame", {
	Name = "Header",
	BackgroundColor3 = THEME.Panel,
	BorderSizePixel = 0,
	Size = UDim2.new(1,0,0,86),
	Parent = panel
})
corner(header, 26)
stroke(header, 2, 0, THEME.Black)
gradient(header, THEME.Panel, Color3.fromRGB(12,12,18), 135)

local title = new("TextLabel", {
	Name = "Title",
	BackgroundTransparency = 1,
	Position = UDim2.new(0, 18, 0, 12),
	Size = UDim2.new(1, -220, 0, 30),
	Font = Enum.Font.GothamBlack,
	TextSize = 26,
	TextColor3 = THEME.Text,
	TextXAlignment = Enum.TextXAlignment.Left,
	Text = "‚öô PROFILE HUB",
	Parent = header
})
outlineText(title)

local subtitle = new("TextLabel", {
	Name = "Subtitle",
	BackgroundTransparency = 1,
	Position = UDim2.new(0, 20, 0, 46),
	Size = UDim2.new(1, -220, 0, 18),
	Font = Enum.Font.GothamBold,
	TextSize = 13,
	TextColor3 = THEME.Muted,
	TextXAlignment = Enum.TextXAlignment.Left,
	Text = ("Session XP: +%d/min ¬∑ Tabs: Overview / Collectables / Titles"):format(XP_PER_MINUTE),
	Parent = header
})
outlineText(subtitle)

local closeBtn = new("TextButton", {
	Name = "Close",
	AnchorPoint = Vector2.new(1,0.5),
	Position = UDim2.new(1, -18, 0.5, 0),
	Size = UDim2.new(0, 56, 0, 46),
	BackgroundColor3 = Color3.fromRGB(28,28,38),
	Text = "‚úï",
	Font = Enum.Font.GothamBlack,
	TextSize = 20,
	TextColor3 = THEME.Text,
	BorderSizePixel = 0,
	Parent = header
})
corner(closeBtn, 14)
stroke(closeBtn, 2, 0, THEME.Black)
gradient(closeBtn, Color3.fromRGB(34,34,46), Color3.fromRGB(18,18,26), 135)
outlineText(closeBtn)
addButtonFX(closeBtn, 1.06, 0.92)

-- Tabs bar
local tabsBar = new("Frame", {
	Name = "TabsBar",
	BackgroundTransparency = 1,
	Size = UDim2.new(1, -36, 0, 44),
	Position = UDim2.new(0, 18, 0, 86),
	Parent = panel
})

local tabsLayout = new("UIListLayout", {
	FillDirection = Enum.FillDirection.Horizontal,
	SortOrder = Enum.SortOrder.LayoutOrder,
	Padding = UDim.new(0, 10),
	Parent = tabsBar
})

local tabUnderline = new("Frame", {
	Name = "Underline",
	BackgroundColor3 = THEME.Accent,
	BorderSizePixel = 0,
	Size = UDim2.new(0, 120, 0, 3),
	Position = UDim2.new(0, 0, 1, -3),
	Parent = tabsBar
})
corner(tabUnderline, 999)

-- Body container (IMPORTANT: clip to stop side-bleed)
local body = new("Frame", {
	Name = "Body",
	BackgroundColor3 = THEME.Card,
	BorderSizePixel = 0,
	Position = UDim2.new(0, 18, 0, 136),
	Size = UDim2.new(1, -36, 1, -154),
	Parent = panel
})
body.ClipsDescendants = true
corner(body, 22)
stroke(body, 2, 0, THEME.Black)
gradient(body, THEME.Card, Color3.fromRGB(14,14,18), 135)

local pages = new("Frame", {
	Name = "Pages",
	BackgroundTransparency = 1,
	Size = UDim2.fromScale(1,1),
	Parent = body
})
pages.ClipsDescendants = true

local pageLayout = new("UIPageLayout", {
	SortOrder = Enum.SortOrder.LayoutOrder,
	EasingStyle = Enum.EasingStyle.Quint,
	EasingDirection = Enum.EasingDirection.Out,
	TweenTime = 0.35,
	Padding = UDim.new(0, 0),
	Circular = false,
	Parent = pages
})
pageLayout.FillDirection = Enum.FillDirection.Horizontal

-- Disable swipes/scroll changing pages (prevents accidental ‚Äúpeek‚Äù)
pcall(function() pageLayout.TouchInputEnabled = false end)
pcall(function() pageLayout.GamepadInputEnabled = false end)
pcall(function() pageLayout.ScrollWheelInputEnabled = false end)

--//////////////////////////////////////////////////////////
-- PAGE BUILDERS
--//////////////////////////////////////////////////////////
local function makePage(name, order)
	local page = new("Frame", {
		Name = name,
		BackgroundTransparency = 1,
		Size = UDim2.fromScale(1,1),
		LayoutOrder = order,
		Parent = pages
	})
	return page
end

local function makeSearchRow(parent, placeholder)
	local row = new("Frame", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -24, 0, 44),
		Position = UDim2.new(0, 12, 0, 12),
		Parent = parent
	})

	local bg = new("Frame", {
		BackgroundColor3 = Color3.fromRGB(22,22,30),
		BorderSizePixel = 0,
		Size = UDim2.fromScale(1,1),
		Parent = row
	})
	corner(bg, 14)
	stroke(bg, 1, 0.35, THEME.Black)
	gradient(bg, Color3.fromRGB(26,26,36), Color3.fromRGB(16,16,24), 135)

	new("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 34, 1, 0),
		Position = UDim2.new(0, 12, 0, 0),
		Text = "‚åï",
		TextColor3 = THEME.Muted,
		Font = Enum.Font.GothamBlack,
		TextSize = 18,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = bg
	})

	local box = new("TextBox", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -52, 1, 0),
		Position = UDim2.new(0, 38, 0, 0),
		PlaceholderText = placeholder or "Search...",
		Text = "",
		ClearTextOnFocus = false,
		TextColor3 = THEME.Text,
		PlaceholderColor3 = THEME.Muted,
		Font = Enum.Font.GothamMedium,
		TextSize = 14,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = bg
	})
	outlineText(box)

	return box
end

local function makePill(parent, text, color)
	local pill = new("Frame", {
		BackgroundColor3 = color,
		BackgroundTransparency = 0.12,
		BorderSizePixel = 0,
		Size = UDim2.new(0, 140, 0, 26),
		Parent = parent
	})
	corner(pill, 999)
	stroke(pill, 1, 0.55, THEME.Black)

	local t = new("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.fromScale(1,1),
		Text = text,
		TextColor3 = THEME.Text,
		Font = Enum.Font.GothamBlack,
		TextSize = 12,
		Parent = pill
	})
	outlineText(t)

	return pill, t
end

local function makeInfoPill(parent, text, color, width)
	local pill = new("Frame", {
		BackgroundColor3 = color,
		BackgroundTransparency = 0.12,
		BorderSizePixel = 0,
		Size = UDim2.new(0, width or 140, 0, 26),
		Parent = parent
	})
	corner(pill, 999)
	stroke(pill, 1, 0.55, THEME.Black)

	local t = new("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.fromScale(1,1),
		Text = text,
		TextColor3 = THEME.Text,
		Font = Enum.Font.GothamBlack,
		TextSize = 12,
		Parent = pill
	})
	outlineText(t)

	return pill, t
end

local function makeSoftPill(parent, text, color, width)
	local pill = new("Frame", {
		BackgroundColor3 = color,
		BackgroundTransparency = 0.18,
		BorderSizePixel = 0,
		Size = UDim2.new(0, width or 140, 0, 26),
		Parent = parent
	})
	corner(pill, 999)

	local wash = new("Frame", {
		Name = "Wash",
		BackgroundColor3 = color,
		BackgroundTransparency = 0.82,
		BorderSizePixel = 0,
		Size = UDim2.fromScale(1,1),
		Parent = pill
	})
	corner(wash, 999)
	gradient(wash, Color3.fromRGB(255,255,255), color, 135)

	local t = new("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.fromScale(1,1),
		Text = text,
		TextColor3 = THEME.Text,
		Font = Enum.Font.GothamMedium,
		TextSize = 12,
		TextStrokeTransparency = 1,
		Parent = pill
	})

	return pill, t
end

local function clearChildren(frame)
	for _, c in ipairs(frame:GetChildren()) do
		if not c:IsA("UIGridLayout") and not c:IsA("UIListLayout") and not c:IsA("UIPadding") then
			c:Destroy()
		end
	end
end

local function setScrollCanvas(scroll: ScrollingFrame, layout)
	scroll.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 12)
end

--//////////////////////////////////////////////////////////
-- PAGES
--//////////////////////////////////////////////////////////
local overviewPage = makePage("Overview", 1)
local collectPage  = makePage("Collectables", 2)
local titlesPage   = makePage("Titles", 3)

--//////////////////////////////////////////////////////////
-- OVERVIEW CONTENT
--//////////////////////////////////////////////////////////
local ovWrap = new("Frame", {BackgroundTransparency=1, Size=UDim2.fromScale(1,1), Parent=overviewPage})
new("UIPadding", {PaddingTop=UDim.new(0,14),PaddingBottom=UDim.new(0,14),PaddingLeft=UDim.new(0,14),PaddingRight=UDim.new(0,14), Parent=ovWrap})

new("UIGridLayout", {
	CellPadding = UDim2.new(0, 14, 0, 14),
	CellSize = UDim2.new(0.33, -10, 1, 0),
	SortOrder = Enum.SortOrder.LayoutOrder,
	Parent = ovWrap
})

local function makeCard(parent, name)
	local c = new("Frame", {
		Name = name,
		BackgroundColor3 = THEME.Card2,
		BorderSizePixel = 0,
		Parent = parent
	})
	corner(c, 20)
	stroke(c, 2, 0, THEME.Black)
	gradient(c, THEME.Card2, Color3.fromRGB(10,10,14), 135)
	new("UIPadding", {PaddingTop=UDim.new(0,16),PaddingBottom=UDim.new(0,16),PaddingLeft=UDim.new(0,16),PaddingRight=UDim.new(0,16), Parent=c})
	return c
end

local leftCard  = makeCard(ovWrap, "ProfileCard")
local midCard   = makeCard(ovWrap, "StatsCard")
local rightCard = makeCard(ovWrap, "ShowcaseCard")

-- Left: profile
local nameRow = new("TextLabel", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1,0,0,30),
	Font = Enum.Font.GothamBlack,
	TextSize = 22,
	TextColor3 = THEME.Text,
	TextXAlignment = Enum.TextXAlignment.Left,
	Text = "‚òÖ " .. plr.Name,
	Parent = leftCard
})
outlineText(nameRow)

local avatarHolder = new("Frame", {BackgroundTransparency=1, Position=UDim2.new(0,0,0,44), Size=UDim2.new(1,0,0,290), Parent=leftCard})

	local ring = new("Frame", {
		AnchorPoint = Vector2.new(0.5,0.5),
		Position = UDim2.fromScale(0.5, 0.52),
		Size = UDim2.new(0, 230, 0, 230),
		BackgroundColor3 = THEME.BG,
		BorderSizePixel = 0,
		Parent = avatarHolder
	})
corner(ring, 999)
stroke(ring, 3, 0.10, THEME.Black)
local ringGlow = stroke(ring, 4, 0, THEME.Accent)

local avatar = new("ImageLabel", {
	BackgroundColor3 = Color3.fromRGB(10,10,14),
	AnchorPoint = Vector2.new(0.5,0.5),
	Position = UDim2.fromScale(0.5, 0.5),
	Size = UDim2.new(0, 208, 0, 208),
	Image = "",
	ScaleType = Enum.ScaleType.Crop,
	BorderSizePixel = 0,
	Parent = ring
})
corner(avatar, 999)
stroke(avatar, 2, 0, THEME.Black)

local userIdLabel = new("TextLabel", {
	BackgroundTransparency = 1,
	Position = UDim2.new(0, 0, 1, -58),
	Size = UDim2.new(1, 0, 0, 18),
	Font = Enum.Font.GothamBlack,
	TextSize = 13,
	TextColor3 = THEME.Muted,
	TextXAlignment = Enum.TextXAlignment.Center,
	Text = "USER ID",
	Parent = leftCard
})
outlineText(userIdLabel)

local userIdValue = new("TextLabel", {
	BackgroundTransparency = 1,
	Position = UDim2.new(0, 0, 1, -36),
	Size = UDim2.new(1, 0, 0, 28),
	Font = Enum.Font.GothamBlack,
	TextSize = 22,
	TextColor3 = THEME.Text,
	TextXAlignment = Enum.TextXAlignment.Center,
	Text = tostring(plr.UserId),
	Parent = leftCard
})
outlineText(userIdValue)

task.spawn(function()
	local ok, content = pcall(function()
		return Players:GetUserThumbnailAsync(plr.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size420x420)
	end)
	if ok and typeof(content) == "string" then
		avatar.Image = content
	end
end)

-- Mid: stats
local function sectionHeader(parent, text)
	local lbl = new("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1,0,0,18),
		Font = Enum.Font.GothamBlack,
		TextSize = 14,
		TextColor3 = THEME.Muted,
		TextXAlignment = Enum.TextXAlignment.Left,
		Text = text,
		Parent = parent
	})
	outlineText(lbl)
	return lbl
end

local function bigValue(parent, text)
	local lbl = new("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.new(1,0,0,42),
		Font = Enum.Font.GothamBlack,
		TextSize = 34,
		TextColor3 = THEME.Text,
		TextXAlignment = Enum.TextXAlignment.Left,
		Text = text,
		Parent = parent
	})
	outlineText(lbl)
	return lbl
end

local function makeBar(parent)
	local wrap = new("Frame", {BackgroundTransparency=1, Size=UDim2.new(1,0,0,26), Parent=parent})

	local bar = new("Frame", {
		BackgroundColor3 = Color3.fromRGB(40,40,52),
		BorderSizePixel = 0,
		Size = UDim2.new(1,0,0,10),
		Position = UDim2.new(0,0,0.5,-5),
		Parent = wrap
	})
	corner(bar, 99)
	stroke(bar, 1, 0.2, THEME.Black)

	local fill = new("Frame", {
		BackgroundColor3 = THEME.AccentDark,
		BorderSizePixel = 0,
		Size = UDim2.new(0,0,1,0),
		Parent = bar
	})
	corner(fill, 99)

	local knob = new("Frame", {
		BackgroundColor3 = THEME.Accent,
		BorderSizePixel = 0,
		Size = UDim2.new(0,18,0,18),
		Position = UDim2.new(0,-9,0.5,-9),
		Parent = bar
	})
	corner(knob, 99)
	stroke(knob, 2, 0, THEME.Black)

	return fill, knob
end

new("UIListLayout", {SortOrder=Enum.SortOrder.LayoutOrder, Padding=UDim.new(0,14), Parent=midCard})

sectionHeader(midCard, "PLAYTIME")
local playBig = bigValue(midCard, "0s")

local sessionRow = new("Frame", {BackgroundTransparency=1, Size=UDim2.new(1,0,0,22), Parent=midCard})
local sessionLbl = new("TextLabel", {
	BackgroundTransparency=1, Size=UDim2.new(0.5,0,1,0),
	Font=Enum.Font.GothamBold, TextSize=13, TextColor3=THEME.Muted,
	TextXAlignment=Enum.TextXAlignment.Left, Text="Session:", Parent=sessionRow
})
outlineText(sessionLbl)

local sessionVal = new("TextLabel", {
	BackgroundTransparency=1, Position=UDim2.new(0.5,0,0,0), Size=UDim2.new(0.5,0,1,0),
	Font=Enum.Font.GothamBlack, TextSize=13, TextColor3=THEME.Text,
	TextXAlignment=Enum.TextXAlignment.Right, Text="0s", Parent=sessionRow
})
outlineText(sessionVal)

sectionHeader(midCard, "LEVEL & XP")
local levelBig = bigValue(midCard, "Level 1")

local xpInfo = new("TextLabel", {
	BackgroundTransparency=1, Size=UDim2.new(1,0,0,18),
	Font=Enum.Font.GothamBold, TextSize=12, TextColor3=THEME.Muted,
	TextXAlignment=Enum.TextXAlignment.Left,
	Text=("Progress: +%d XP/min ¬∑ 1 level = %d XP"):format(XP_PER_MINUTE, XP_PER_LEVEL),
	Parent=midCard
})
outlineText(xpInfo)

local xpFill, xpKnob = makeBar(midCard)

local xpRow = new("Frame", {BackgroundTransparency=1, Size=UDim2.new(1,0,0,22), Parent=midCard})
local xpLeft = new("TextLabel", {
	BackgroundTransparency=1, Size=UDim2.new(0.65,0,1,0),
	Font=Enum.Font.GothamBold, TextSize=13, TextColor3=THEME.Muted,
	TextXAlignment=Enum.TextXAlignment.Left, Text="XP:", Parent=xpRow
})
outlineText(xpLeft)

local xpRight = new("TextLabel", {
	BackgroundTransparency=1, Position=UDim2.new(0.65,0,0,0), Size=UDim2.new(0.35,0,1,0),
	Font=Enum.Font.GothamBlack, TextSize=13, TextColor3=THEME.Text,
	TextXAlignment=Enum.TextXAlignment.Right, Text=("0 / %d"):format(XP_PER_LEVEL),
	Parent=xpRow
})
outlineText(xpRight)

-- Right: showcase
new("UIListLayout", {SortOrder=Enum.SortOrder.LayoutOrder, Padding=UDim.new(0,12), Parent=rightCard})
sectionHeader(rightCard, "SHOWCASE")

local equippedTitleLbl = new("TextLabel", {
	BackgroundTransparency=1,
	Size=UDim2.new(1,0,0,26),
	Font=Enum.Font.GothamBlack,
	TextSize=18,
	TextColor3=THEME.Text,
	TextXAlignment=Enum.TextXAlignment.Left,
	Text="Title: (none)",
	Parent=rightCard
})
outlineText(equippedTitleLbl)

local progRow = new("Frame", {BackgroundTransparency=1, Size=UDim2.new(1,0,0,30), Parent=rightCard})
local progPill1 = makePill(progRow, "Collectables: 0/0", THEME.AccentDark)
progPill1.Position = UDim2.new(0,0,0,2)
local progPill2 = makePill(progRow, "Titles: 0/0", Color3.fromRGB(28,28,40))
progPill2.Position = UDim2.new(0, 156, 0, 2)

	local hint = new("TextLabel", {
		BackgroundTransparency=1,
		Size=UDim2.new(1,0,0,60),
		Font=Enum.Font.GothamBold,
		TextSize=12,
		TextColor3=THEME.Muted,
		TextXAlignment=Enum.TextXAlignment.Left,
		Text="Collectables are synced from server catalog.\nTitles are loaded from your TitlesConfig module.",
		Parent=rightCard
	})
outlineText(hint)

--//////////////////////////////////////////////////////////
-- COLLECTABLES PAGE
--//////////////////////////////////////////////////////////
local collectWrap = new("Frame", {
	BackgroundTransparency = 1,
	Position = UDim2.new(0, 12, 0, 12),
	Size = UDim2.new(1, -24, 1, -24),
	Parent = collectPage
})
new("UIListLayout", {
	FillDirection = Enum.FillDirection.Horizontal,
	SortOrder = Enum.SortOrder.LayoutOrder,
	Padding = UDim.new(0, 12),
	Parent = collectWrap
})

local collectLeft = new("Frame", {
	BackgroundTransparency = 1,
	Size = UDim2.new(0.58, 0, 1, 0),
	LayoutOrder = 1,
	Parent = collectWrap
})

local collectRight = new("Frame", {
	BackgroundTransparency = 1,
	Size = UDim2.new(0.42, 0, 1, 0),
	LayoutOrder = 2,
	Parent = collectWrap
})

local collectSearch = makeSearchRow(collectLeft, "Search collectables...")
collectSearch.Font = Enum.Font.Gotham
collectSearch.TextStrokeTransparency = 1
local collectScroll = new("ScrollingFrame", {
	Name="CollectScroll",
	BackgroundTransparency=1,
	BorderSizePixel=0,
	Position=UDim2.new(0,12,0,68),
	Size=UDim2.new(1,-24,1,-80),
	ScrollBarThickness=5,
	ScrollBarImageColor3=Color3.fromRGB(70,70,90),
	Parent=collectLeft
})
local collectGrid = new("UIGridLayout", {
	CellPadding = UDim2.new(0, 12, 0, 12),
	CellSize = UDim2.new(0, 160, 0, 160),
	SortOrder = Enum.SortOrder.LayoutOrder,
	Parent = collectScroll
})
new("UIPadding", {PaddingTop=UDim.new(0,6),PaddingLeft=UDim.new(0,6),PaddingRight=UDim.new(0,6),PaddingBottom=UDim.new(0,10), Parent=collectScroll})

local collectDetailCard = new("Frame", {
	Name = "CollectDetailCard",
	BackgroundColor3 = THEME.Card2,
	BorderSizePixel = 0,
	Size = UDim2.new(1, 0, 1, 0),
	Parent = collectRight
})
corner(collectDetailCard, 18)
shadow(collectDetailCard, 0.9)
gradient(collectDetailCard, Color3.fromRGB(20,20,28), Color3.fromRGB(10,10,14), 135)
new("UIPadding", {PaddingTop=UDim.new(0,16),PaddingBottom=UDim.new(0,16),PaddingLeft=UDim.new(0,16),PaddingRight=UDim.new(0,16), Parent=collectDetailCard})

local detailContent = new("Frame", {
	Name = "DetailContent",
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 1, 0),
	Parent = collectDetailCard
})
new("UIListLayout", {SortOrder=Enum.SortOrder.LayoutOrder, Padding=UDim.new(0,12), Parent=detailContent})

local detailHeader = new("TextLabel", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 0, 22),
	Font = Enum.Font.GothamMedium,
	TextSize = 14,
	TextColor3 = THEME.Muted,
	TextStrokeTransparency = 1,
	TextXAlignment = Enum.TextXAlignment.Left,
	Text = CollectablesPanelConfig.Title or "COLLECTABLE DETAILS",
	Parent = detailContent
})

local detailPreview = new("Frame", {
	Name = "DetailPreview",
	BackgroundColor3 = Color3.fromRGB(22,22,30),
	BorderSizePixel = 0,
	Size = UDim2.new(1, 0, 0, 190),
	Parent = detailContent
})
corner(detailPreview, 16)

local detailName = new("TextLabel", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 0, 30),
	Font = Enum.Font.GothamMedium,
	TextSize = 20,
	TextColor3 = THEME.Text,
	TextStrokeTransparency = 1,
	TextXAlignment = Enum.TextXAlignment.Left,
	Text = "",
	Parent = detailContent
})

local detailTagline = new("TextLabel", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 0, 18),
	Font = Enum.Font.Gotham,
	TextSize = 13,
	TextColor3 = THEME.Muted,
	TextStrokeTransparency = 1,
	TextXAlignment = Enum.TextXAlignment.Left,
	Text = "",
	Visible = false,
	Parent = detailContent
})

local detailStatusRow = new("Frame", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 0, 30),
	Parent = detailContent
})
local detailStatusPill, detailStatusText = makeSoftPill(detailStatusRow, COLLECTED_LABEL, THEME.Good, 120)
detailStatusPill.Position = UDim2.new(0, 0, 0, 2)
local detailRarityPill, detailRarityText = makeSoftPill(detailStatusRow, ("%sCOMMON"):format(RARITY_PREFIX), rarityColor("Common"), 170)
detailRarityPill.Position = UDim2.new(0, 130, 0, 2)

local detailDesc = new("TextLabel", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 0, 84),
	Font = Enum.Font.GothamMedium,
	TextSize = 14,
	TextColor3 = THEME.Text,
	TextStrokeTransparency = 1,
	TextXAlignment = Enum.TextXAlignment.Left,
	TextYAlignment = Enum.TextYAlignment.Top,
	TextWrapped = true,
	Text = "",
	Parent = detailContent
})

local detailHighlightsTitle = new("TextLabel", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 0, 18),
	Font = Enum.Font.GothamMedium,
	TextSize = 13,
	TextColor3 = THEME.Muted,
	TextStrokeTransparency = 1,
	TextXAlignment = Enum.TextXAlignment.Left,
	Text = CollectablesPanelConfig.HighlightsTitle or "Highlights",
	Parent = detailContent
})

local detailHighlightsWrap = new("Frame", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 0, 64),
	Parent = detailContent
})
local detailHighlightsGrid = new("UIGridLayout", {
	CellPadding = UDim2.new(0, 8, 0, 8),
	CellSize = UDim2.new(0, 130, 0, 24),
	SortOrder = Enum.SortOrder.LayoutOrder,
	Parent = detailHighlightsWrap
})

local detailPlaceholder = new("Frame", {
	Name = "DetailPlaceholder",
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 1, 0),
	Parent = collectDetailCard
})
local detailPlaceholderLayout = new("UIListLayout", {SortOrder=Enum.SortOrder.LayoutOrder, Padding=UDim.new(0,8), Parent=detailPlaceholder})
detailPlaceholderLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
detailPlaceholderLayout.VerticalAlignment = Enum.VerticalAlignment.Center

local detailPlaceholderTitle = new("TextLabel", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 0, 26),
	Font = Enum.Font.GothamMedium,
	TextSize = 17,
	TextColor3 = THEME.Text,
	TextStrokeTransparency = 1,
	TextXAlignment = Enum.TextXAlignment.Center,
	Text = "",
	Parent = detailPlaceholder
})

local detailPlaceholderBody = new("TextLabel", {
	BackgroundTransparency = 1,
	Size = UDim2.new(1, 0, 0, 56),
	Font = Enum.Font.GothamMedium,
	TextSize = 12,
	TextColor3 = THEME.Muted,
	TextStrokeTransparency = 1,
	TextXAlignment = Enum.TextXAlignment.Center,
	TextWrapped = true,
	Text = "",
	Parent = detailPlaceholder
})

--//////////////////////////////////////////////////////////
-- TITLES PAGE
--//////////////////////////////////////////////////////////
local titlesSearch = makeSearchRow(titlesPage, "Search titles...")
titlesSearch.Font = Enum.Font.Gotham
titlesSearch.TextStrokeTransparency = 1
local titlesScroll = new("ScrollingFrame", {
	Name="TitlesScroll",
	BackgroundTransparency=1,
	BorderSizePixel=0,
	Position=UDim2.new(0,12,0,68),
	Size=UDim2.new(1,-24,1,-80),
	ScrollBarThickness=5,
	ScrollBarImageColor3=Color3.fromRGB(70,70,90),
	Parent=titlesPage
})
local titlesList = new("UIGridLayout", {
	CellPadding = UDim2.new(0, 14, 0, 14),
	CellSize = UDim2.new(0, 332, 0, 220),
	SortOrder = Enum.SortOrder.LayoutOrder,
	Parent = titlesScroll
})
new("UIPadding", {PaddingTop=UDim.new(0,6),PaddingLeft=UDim.new(0,6),PaddingRight=UDim.new(0,6),PaddingBottom=UDim.new(0,14), Parent=titlesScroll})

--//////////////////////////////////////////////////////////
-- TAB BUTTONS + NAV (FIXED: uses JumpTo(pageFrame), not index)
--//////////////////////////////////////////////////////////
local tabButtons = {}
local tabOrder = { "Overview", "Collectables", "Titles" }

local pagesByName = {
	Overview = overviewPage,
	Collectables = collectPage,
	Titles = titlesPage,
}

local function makeTabButton(text, order)
	local btn = new("TextButton", {
		Name = "Tab_" .. text,
		BackgroundColor3 = THEME.TabInactive,
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		Size = UDim2.new(0, 180, 0, 46),
		Text = text,
		TextColor3 = THEME.Text,
		Font = Enum.Font.GothamBlack,
		TextSize = 19,
		LayoutOrder = order,
		Parent = tabsBar
	})
	corner(btn, 14)
	addButtonFX(btn, 1.04, 0.95)

	return btn
end

for i, name in ipairs(tabOrder) do
	local b = makeTabButton(name, i)
	tabButtons[name] = b
end

local activeTab = "Overview"

local function setUnderlineTo(btn)
	local absPos = btn.AbsolutePosition
	local absSize = btn.AbsoluteSize
	local parentAbs = tabsBar.AbsolutePosition
	local x = absPos.X - parentAbs.X

	tween(tabUnderline, TweenInfo.new(0.20, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
		Position = UDim2.new(0, x + 14, 1, -3),
		Size = UDim2.new(0, math.max(60, absSize.X - 28), 0, 3)
	})
end

local function jumpToTab(name)
	if not pagesByName[name] then return end
	activeTab = name

	-- ‚úÖ correct page always
	pageLayout:JumpTo(pagesByName[name])

	for tabName, btn in pairs(tabButtons) do
		local isActive = (tabName == name)
		btn.BackgroundTransparency = 0
		btn.BackgroundColor3 = isActive and THEME.Accent or THEME.TabInactive
		btn.TextColor3 = isActive and THEME.Black or THEME.Text
	end

	setUnderlineTo(tabButtons[name])
	click()
end

for name, btn in pairs(tabButtons) do
	btn.MouseButton1Click:Connect(function()
		jumpToTab(name)
	end)
end

--//////////////////////////////////////////////////////////
-- VIEWPORT THUMB (unchanged from your version)
--//////////////////////////////////////////////////////////
local VIEWPORT_FOV = 30
local VIEWPORT_PADDING = 1.18
local VIEWPORT_ELEVATION = 0.18

local function getVisibleBounds(model: Instance)
	local minV = Vector3.new(math.huge, math.huge, math.huge)
	local maxV = Vector3.new(-math.huge, -math.huge, -math.huge)
	local found = false

	local function hasDecalOrTexture(p: BasePart)
		for _, ch in ipairs(p:GetChildren()) do
			if ch:IsA("Decal") or ch:IsA("Texture") then
				return true
			end
		end
		return false
	end

	for _, d in ipairs(model:GetDescendants()) do
		if d:IsA("BasePart") then
			if d:GetAttribute("IgnoreInPreview") == true then
				continue
			end

			local invisibleHelper =
				(d.Transparency >= 0.98)
				and (not d:IsA("MeshPart"))
				and (not hasDecalOrTexture(d))

			if invisibleHelper then
				continue
			end

			found = true

			local cf = d.CFrame
			local sx, sy, sz = d.Size.X * 0.5, d.Size.Y * 0.5, d.Size.Z * 0.5
			local corners = {
				Vector3.new(-sx,-sy,-sz), Vector3.new(-sx,-sy, sz),
				Vector3.new(-sx, sy,-sz), Vector3.new(-sx, sy, sz),
				Vector3.new( sx,-sy,-sz), Vector3.new( sx,-sy, sz),
				Vector3.new( sx, sy,-sz), Vector3.new( sx, sy, sz),
			}

			for _, c in ipairs(corners) do
				local w = (cf * CFrame.new(c)).Position
				minV = Vector3.new(math.min(minV.X, w.X), math.min(minV.Y, w.Y), math.min(minV.Z, w.Z))
				maxV = Vector3.new(math.max(maxV.X, w.X), math.max(maxV.Y, w.Y), math.max(maxV.Z, w.Z))
			end
		end
	end

	if not found and model.GetBoundingBox then
		local cf, size = model:GetBoundingBox()
		return cf.Position, size
	end

	local center = (minV + maxV) * 0.5
	local size = (maxV - minV)
	return center, size
end

local function makeViewportThumb(parent: Instance, id: string, hideModel: boolean, silhouette: boolean)
	local vf = new("ViewportFrame", {
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		Size = UDim2.fromScale(1,1),
		Parent = parent
	})
	vf.Ambient = Color3.fromRGB(90, 90, 90)
	vf.LightColor = Color3.fromRGB(255,255,255)
	vf.LightDirection = Vector3.new(-1, -1, -0.5)

	local cam = Instance.new("Camera")
	cam.FieldOfView = VIEWPORT_FOV
	cam.Parent = vf
	vf.CurrentCamera = cam

	local src = PreviewFolder and PreviewFolder:FindFirstChild(id)
	if not src or hideModel then
		return vf, nil
	end

	local clone = src:Clone()
	clone.Parent = vf

	local model: Model
	if clone:IsA("Model") then
		model = clone
	else
		model = Instance.new("Model")
		model.Name = "M"
		clone.Parent = model
		model.Parent = vf
	end

	for _, d in ipairs(model:GetDescendants()) do
		if d:IsA("BasePart") then
			d.Anchored = true
			d.CanCollide = false
			d.CanTouch = false
			d.CanQuery = false
			d.CastShadow = false
			if silhouette then
				d.Color = Color3.fromRGB(0,0,0)
				d.Material = Enum.Material.SmoothPlastic
				d.Reflectance = 0
				d.Transparency = 0
				if d:IsA("MeshPart") then
					d.TextureID = ""
				end
			end
		elseif silhouette and (d:IsA("Decal") or d:IsA("Texture") or d:IsA("SurfaceAppearance")) then
			d:Destroy()
		end
	end

	local center, size = getVisibleBounds(model)

	local abs = vf.AbsoluteSize
	local aspect = (abs.Y > 0) and (abs.X / abs.Y) or 1

	local halfY = math.rad(VIEWPORT_FOV * 0.5)
	local halfX = math.atan(math.tan(halfY) * aspect)

	local rx, ry, rz = size.X * 0.5, size.Y * 0.5, size.Z * 0.5
	local distX = rx / math.tan(halfX)
	local distY = ry / math.tan(halfY)
	local distZ = rz / math.tan(halfY)

	local dist = math.max(distX, distY, distZ) * VIEWPORT_PADDING + 0.35
	local dir = Vector3.new(1, VIEWPORT_ELEVATION, 1).Unit
	cam.CFrame = CFrame.new(center + dir * dist, center)

	return vf, model
end

--//////////////////////////////////////////////////////////
-- RENDERERS (Collectables / Titles)
--//////////////////////////////////////////////////////////
local collectCards = {}
local titleRows = {}
local selectedCollectableId: string? = nil
local detailSpinConn: RBXScriptConnection? = nil

local function setSelectedCollectable(id: string?)
	selectedCollectableId = id
	for key, pack in pairs(collectCards) do
		if pack.selectStroke then
			pack.selectStroke.Enabled = (key == id)
		end
	end
end

local function clearDetailHighlights()
	clearChildren(detailHighlightsWrap)
end

local function renderDetailHighlights(highlights)
	clearDetailHighlights()
	if typeof(highlights) ~= "table" or #highlights == 0 then
		detailHighlightsTitle.Visible = false
		detailHighlightsWrap.Visible = false
		return
	end
	detailHighlightsTitle.Visible = true
	detailHighlightsWrap.Visible = true
	for i, text in ipairs(highlights) do
		local pill = makeSoftPill(detailHighlightsWrap, tostring(text), THEME.AccentDark, 130)
		pill.LayoutOrder = i
	end
end

local function setDetailPreview(item, hideModel)
	for _, child in ipairs(detailPreview:GetChildren()) do
		child:Destroy()
	end
	if detailSpinConn then
		detailSpinConn:Disconnect()
		detailSpinConn = nil
	end
	local _, model = makeViewportThumb(detailPreview, item.Id, hideModel, false)
	if model then
		local spinRate = math.rad(18)
		detailSpinConn = RunService.RenderStepped:Connect(function(dt)
			model:PivotTo(model:GetPivot() * CFrame.Angles(0, spinRate * dt, 0))
		end)
	end
end

local function setCollectableDetailState(state, display)
	if state == "ready" then
		detailPlaceholder.Visible = false
		detailContent.Visible = true
		return
	end

	if detailSpinConn then
		detailSpinConn:Disconnect()
		detailSpinConn = nil
	end
	detailContent.Visible = false
	detailPlaceholder.Visible = true

	if state == "locked" then
		local locked = CollectablesPanelConfig.Locked or {}
		detailPlaceholderTitle.Text = formatPanelText(locked.Title, "Collectable Locked", display and display.Name or nil)
		detailPlaceholderBody.Text = formatPanelText(locked.Body, "You haven't collected this yet.", display and display.Name or nil)
	else
		local empty = CollectablesPanelConfig.Empty or {}
		detailPlaceholderTitle.Text = formatPanelText(empty.Title, "Choose a Collectable", nil)
		detailPlaceholderBody.Text = formatPanelText(empty.Body, "Select a collectable on the left to view its details.", nil)
	end
end

local function showCollectableDetails(item)
	local display = getCollectableDisplay(item)
	local collected = getCollectedCollectable(item.Id)

	if not collected then
		setCollectableDetailState("locked", display)
		return
	end

	setCollectableDetailState("ready", display)
	setDetailPreview(item, false)
	detailName.Text = display.Name or item.Id
	detailTagline.Text = display.Tagline or ""
	detailTagline.Visible = (detailTagline.Text ~= "")
	detailDesc.Text = (display.Desc ~= "" and display.Desc) or DESCRIPTION_FALLBACK

	detailStatusText.Text = COLLECTED_LABEL
	detailStatusPill.BackgroundColor3 = THEME.Good
	detailRarityText.Text = ("%s%s"):format(RARITY_PREFIX, display.Rarity or "Common")
	detailRarityPill.BackgroundColor3 = display.Accent or rarityColor(display.Rarity)

	renderDetailHighlights(display.Highlights)
end

local function updateCollectableCardVisual(id: string)
	local pack = collectCards[id]
	if not pack then return end

	local collected = getCollectedCollectable(id)
	local stateColor = collected and THEME.Good or THEME.Bad
	local stateText  = collected and COLLECTED_LABEL or MISSING_LABEL

	if pack.wash then pack.wash.BackgroundColor3 = stateColor end
	if pack.chip then pack.chip.BackgroundColor3 = stateColor end
	if pack.chipTxt then pack.chipTxt.Text = stateText end
	if pack.chipWash then pack.chipWash.BackgroundColor3 = stateColor end
	if pack.selectStroke then pack.selectStroke.Enabled = (selectedCollectableId == id) end

	if selectedCollectableId == id then
		showCollectableDetails(pack.item)
	end
end

local function buildCollectableCard(item, order)
	local collected = getCollectedCollectable(item.Id)
	local display = getCollectableDisplay(item)

	local stateColor = collected and THEME.Good or THEME.Bad
	local stateText  = collected and COLLECTED_LABEL or MISSING_LABEL

	local card = new("TextButton", {
		Name = "Collect_"..item.Id,
		BackgroundColor3 = Color3.fromRGB(18,18,26),
		BorderSizePixel = 0,
		LayoutOrder = order,
		Text = "",
		AutoButtonColor = false,
		Parent = collectScroll
	})
	corner(card, 18)
	shadow(card, 0.9)
	gradient(card, Color3.fromRGB(20,20,28), Color3.fromRGB(10,10,14), 135)
	local selectStroke = stroke(card, 2, 0.7, THEME.Accent)
	selectStroke.Enabled = false

	local preview = new("Frame", {
		BackgroundColor3 = Color3.fromRGB(20,20,28),
		BorderSizePixel = 0,
		Position = UDim2.new(0, 10, 0, 10),
		Size = UDim2.new(1, -20, 1, -64),
		Parent = card
	})
	corner(preview, 14)

	local SILHOUETTE_MISSING_MODEL = true
	makeViewportThumb(preview, item.Id, false, (not collected and SILHOUETTE_MISSING_MODEL))

	local name = new("TextLabel", {
		BackgroundTransparency = 1,
		AnchorPoint = Vector2.new(0.5, 1),
		Position = UDim2.new(0.5, 0, 1, -12),
		Size = UDim2.new(1, -24, 0, 20),
		Text = display.Name,
		TextColor3 = THEME.Text,
		Font = Enum.Font.GothamMedium,
		TextSize = 15,
		TextStrokeTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = card
	})

	local chip, chipTxt = makeSoftPill(card, stateText, stateColor, 92)
	chip.AnchorPoint = Vector2.new(1, 0)
	chip.Position = UDim2.new(1, -12, 0, 12)

	local chipWash = chip:FindFirstChild("Wash")
	if chipWash then
		chipWash.BackgroundTransparency = 0.78
	end

	chipTxt.TextSize = 11
	chipTxt.Font = Enum.Font.GothamMedium
	chipTxt.TextStrokeTransparency = 1

	local glow = new("Frame", {
		AnchorPoint = Vector2.new(1,0),
		Position = UDim2.new(1, -12, 0, 12),
		Size = UDim2.new(0, 86, 0, 24),
		BackgroundColor3 = stateColor,
		BackgroundTransparency = 0.92,
		BorderSizePixel = 0,
		Parent = card
	})
	corner(glow, 999)

	addButtonFX(card, 1.04, 0.95)

	card.MouseButton1Click:Connect(function()
		click()
		setSelectedCollectable(item.Id)
		showCollectableDetails(item)
	end)

	collectCards[item.Id] = {
		card = card,
		item = item,
		display = display,
		chip = chip,
		chipTxt = chipTxt,
		chipWash = chipWash,
		name = name,
		selectStroke = selectStroke,
	}

	return card
end

local function renderCollectables()
	collectCards = {}
	clearChildren(collectScroll)

	for i, item in ipairs(COLLECTABLES) do
		buildCollectableCard(item, i)
	end

	task.defer(function()
		setScrollCanvas(collectScroll, collectGrid)
	end)

	if selectedCollectableId and collectCards[selectedCollectableId] then
		setSelectedCollectable(selectedCollectableId)
		showCollectableDetails(collectCards[selectedCollectableId].item)
	else
		setSelectedCollectable(nil)
		setCollectableDetailState("empty")
	end
end

local pendingTitleEquipId: string? = nil

local function buildTitleRow(item, order)
	local unlocked = getUnlockedTitle(item.Id)
	local equipped = (getEquippedTitleId() == item.Id)
	local rarity = rarityColor(item.Rarity)
	local requiredLevel = tonumber(item.RequiredLevel) or 0
	local isPending = (pendingTitleEquipId == item.Id and not equipped)

	local row = new("Frame", {
		Name = "Title_"..item.Id,
		BackgroundColor3 = Color3.fromRGB(18,18,26),
		BorderSizePixel = 0,
		ClipsDescendants = true,
		LayoutOrder = order,
		Size = UDim2.fromScale(1, 1),
		Parent = titlesScroll
	})
	corner(row, 20)
	shadow(row, 0.9)
	gradient(row, Color3.fromRGB(20,20,28), Color3.fromRGB(10,10,14), 135)
	local rowScale = new("UIScale", {Scale = 1, Parent = row})

	local accent = new("Frame", {
		BackgroundColor3 = rarity,
		BackgroundTransparency = 0.25,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 0, 7),
		Parent = row
	})
	corner(accent, 20)
	gradient(accent, rarity, Color3.fromRGB(255,255,255), 0)

	local glow = new("Frame", {
		BackgroundColor3 = rarity,
		BackgroundTransparency = 0.95,
		BorderSizePixel = 0,
		Size = UDim2.fromScale(1,1),
		Parent = row
	})
	glow.ZIndex = 1
	corner(glow, 20)
	gradient(glow, Color3.fromRGB(255,255,255), rarity, 135)

	local content = new("Frame", {
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 16, 0, 14),
		Size = UDim2.new(1, -32, 1, -20),
		Parent = row
	})
	content.ZIndex = 2

	local name = new("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 0, 0, 0),
		Size = UDim2.new(1, -120, 0, 24),
		Text = item.Name,
		TextColor3 = THEME.Text,
		Font = Enum.Font.GothamMedium,
		TextSize = 17,
		TextStrokeTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = content
	})

	local status = new("TextLabel", {
		BackgroundTransparency = 1,
		AnchorPoint = Vector2.new(1, 0),
		Position = UDim2.new(1, 0, 0, 2),
		Size = UDim2.new(0, 110, 0, 18),
		Text = unlocked and (equipped and "EQUIPPED" or (isPending and "EQUIPPING..." or "UNEQUIPPED")) or "LOCKED",
		TextColor3 = unlocked and (equipped and THEME.Accent or (isPending and THEME.Warn or THEME.Good)) or THEME.Warn,
		Font = Enum.Font.GothamMedium,
		TextSize = 12,
		TextStrokeTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Right,
		Parent = content
	})

	local desc = new("TextLabel", {
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 0, 0, 28),
		Size = UDim2.new(1, 0, 0, 60),
		Text = item.Desc,
		TextColor3 = THEME.Muted,
		Font = Enum.Font.Gotham,
		TextSize = 14,
		TextStrokeTransparency = 1,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextWrapped = true,
		Parent = content
	})

	local badgeRow = new("Frame", {
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 0, 0, 94),
		Size = UDim2.new(1, 0, 0, 26),
		Parent = content
	})

	local levelPill, levelText = makeSoftPill(badgeRow, ("LV %d+"):format(requiredLevel), THEME.AccentDark, 120)
	levelPill.Position = UDim2.new(0, 0, 0, 0)
	levelText.TextSize = 14

	local btn = new("TextButton", {
		AnchorPoint = Vector2.new(0, 1),
		Position = UDim2.new(0, 0, 1, 0),
		Size = UDim2.new(1, 0, 0, 44),
		BackgroundColor3 = unlocked and (equipped and Color3.fromRGB(188, 168, 108) or THEME.Accent) or THEME.Panel,
		BackgroundTransparency = unlocked and 0.08 or 0.25,
		BorderSizePixel = 0,
		Text = unlocked and (equipped and "EQUIPPED" or (isPending and "EQUIPPING..." or "EQUIP")) or "LOCKED",
		TextColor3 = unlocked and THEME.Black or THEME.Text,
		Font = Enum.Font.GothamMedium,
		TextSize = 14,
		TextStrokeTransparency = 1,
		AutoButtonColor = false,
		Parent = content
	})
	corner(btn, 14)
	local btnSheen = new("Frame", {
		BackgroundColor3 = Color3.fromRGB(255,255,255),
		BackgroundTransparency = 0.85,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 0, 16),
		Parent = btn
	})
	corner(btnSheen, 14)
	addButtonFX(btn, 1.04, 0.94)

	row.MouseEnter:Connect(function()
		tween(rowScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1.03})
		tween(glow, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 0.85})
		tween(accent, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 0.08})
	end)

	row.MouseLeave:Connect(function()
		tween(rowScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1})
		tween(glow, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 0.95})
		tween(accent, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 0.25})
	end)

	btn.MouseButton1Click:Connect(function()
		click()
		if not unlocked then return end
		if getEquippedTitleId() == item.Id then return end
		if pendingTitleEquipId == item.Id then return end
		pendingTitleEquipId = item.Id
		renderTitles()
		setEquippedTitleId(item.Id)
		task.delay(1.5, function()
			if pendingTitleEquipId == item.Id and getEquippedTitleId() ~= item.Id then
				pendingTitleEquipId = nil
				renderTitles()
			end
		end)
		-- also refresh showcase text
		-- (countProgress will update it too)
	end)

	titleRows[item.Id] = {row=row, item=item, status=status, btn=btn}
	return row
end

function renderTitles()
	titleRows = {}
	clearChildren(titlesScroll)

	for i, item in ipairs(DATA.Titles) do
		buildTitleRow(item, i)
	end

	task.defer(function()
		setScrollCanvas(titlesScroll, titlesList)
	end)
end

--//////////////////////////////////////////////////////////
-- SEARCH FILTERS
--//////////////////////////////////////////////////////////
local function applyCollectSearch(text)
	text = (text or ""):lower()
	for _, pack in pairs(collectCards) do
		local display = pack.display or getCollectableDisplay(pack.item)
		local hay = ((display.Name or "") .. " " .. (display.Desc or "") .. " " .. (display.Id or "")):lower()
		pack.card.Visible = (text == "") or (hay:find(text, 1, true) ~= nil)
	end
end

local function applyTitlesSearch(text)
	text = (text or ""):lower()
	for _, pack in pairs(titleRows) do
		local item = pack.item
		local hay = ((item.Name or "") .. " " .. (item.Desc or "") .. " " .. (item.Id or "")):lower()
		pack.row.Visible = (text == "") or (hay:find(text, 1, true) ~= nil)
	end
end

collectSearch:GetPropertyChangedSignal("Text"):Connect(function()
	applyCollectSearch(collectSearch.Text)
end)
titlesSearch:GetPropertyChangedSignal("Text"):Connect(function()
	applyTitlesSearch(titlesSearch.Text)
end)

--//////////////////////////////////////////////////////////
-- COUNTERS + SHOWCASE REFRESH
--//////////////////////////////////////////////////////////
local function countProgress()
	local totalC = #COLLECTABLES
	local gotC = 0
	for _, it in ipairs(COLLECTABLES) do
		if getCollectedCollectable(it.Id) then
			gotC += 1
		end
	end

	local totalT = #DATA.Titles
	local gotT = 0
	for _, it in ipairs(DATA.Titles) do
		if getUnlockedTitle(it.Id) then
			gotT += 1
		end
	end

	-- tab counts

	-- showcase pills
	progPill1:FindFirstChildWhichIsA("TextLabel").Text = string.format("Collectables: %d/%d", gotC, totalC)
	progPill2:FindFirstChildWhichIsA("TextLabel").Text = string.format("Titles: %d/%d", gotT, totalT)

	-- equipped title
	local eq = getEquippedTitleId()
	if eq and eq ~= "" then
		local foundName
		for _, t in ipairs(DATA.Titles) do
			if t.Id == eq then
				foundName = t.Name
				break
			end
		end
		equippedTitleLbl.Text = "Title: " .. (foundName or eq)
	else
		equippedTitleLbl.Text = "Title: (none)"
	end
end

--//////////////////////////////////////////////////////////
-- LIVE UPDATES FROM SERVER (CollectablesRemotes/Collected)
--//////////////////////////////////////////////////////////
do
	local remotes = ReplicatedStorage:WaitForChild("CollectablesRemotes", 5)
	local collectedRE = remotes and remotes:WaitForChild("Collected", 5)

	if collectedRE then
		collectedRE.OnClientEvent:Connect(function(id: string)
			updateCollectableCardVisual(id)
			countProgress()
		end)
	else
		warn("[PlayerCardUi] CollectablesRemotes/Collected not found; UI will still open but won‚Äôt live-update.")
	end
end

-- Backup: attribute changes update visuals + counts
plr.AttributeChanged:Connect(function(attr)
	if string.sub(attr, 1, #"Collectable_") == "Collectable_" then
		local id = string.sub(attr, #"Collectable_" + 1)
		updateCollectableCardVisual(id)
		countProgress()
	elseif attr == "EquippedTitle" then
		pendingTitleEquipId = nil
		renderTitles()
		countProgress()
	end
end)

--//////////////////////////////////////////////////////////
-- STATS LOOP (Playtime + XP)
--//////////////////////////////////////////////////////////
local joinTime = os.clock()
local lastLevel = 1

local function getLeaderInt(name)
	local ls = plr:FindFirstChild("leaderstats")
	if not ls then return nil end
	local v = ls:FindFirstChild(name)
	if v and v:IsA("IntValue") then
		return v.Value
	end
	return nil
end

local function updateStats()
	local sessionSeconds = os.clock() - joinTime
	local totalPlaySeconds = sessionSeconds
	local totalXP = sessionXP

	if STAT_SOURCE_MODE == "Leaderstats" then
		local lsPlay = getLeaderInt(LEADERSTAT_PLAYTIME_NAME)
		if lsPlay ~= nil then totalPlaySeconds = lsPlay end
		local lsXP = getLeaderInt(LEADERSTAT_XP_NAME)
		if lsXP ~= nil then totalXP = lsXP end
	end

	playBig.Text = formatTime(totalPlaySeconds)
	sessionVal.Text = formatTime(sessionSeconds)

	local lvl, inLevel, xpAlpha = computeLevel(totalXP)
	levelBig.Text = ("Level %d"):format(lvl)
	xpRight.Text = ("%d / %d"):format(inLevel, XP_PER_LEVEL)
	tweenBar(xpFill, xpKnob, xpAlpha)

	if lvl > lastLevel then
		lastLevel = lvl
		tween(ringGlow, TweenInfo.new(0.10, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Thickness = 9})
		task.delay(0.12, function()
			tween(ringGlow, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Thickness = 4})
		end)
	end
end

task.spawn(function()
	local ticker = 0
	while gui.Parent do
		if STAT_SOURCE_MODE == "SessionOnly" then
			sessionXP += XP_PER_SECOND
		end
		updateStats()

		-- don‚Äôt spam heavy counting every frame; once every 2s is plenty
		ticker += 1
		if ticker % 2 == 0 then
			countProgress()
		end

		task.wait(1)
	end
end)

--//////////////////////////////////////////////////////////
-- OPEN/CLOSE ANIMATIONS
--//////////////////////////////////////////////////////////
local isOpen, busy = false, false
local targetScale = computeTargetScale()

local function fitPanel()
	targetScale = computeTargetScale()
	if not isOpen then
		uiScale.Scale = targetScale * 0.94
	end
end

fitPanel()
gui:GetPropertyChangedSignal("AbsoluteSize"):Connect(fitPanel)

local function openUI()
	if busy or isOpen then return end
	busy = true
	isOpen = true

	fitPanel()
	dim.Visible = true
	group.Visible = true

	group.GroupTransparency = 1
	uiScale.Scale = targetScale * 0.94
	dim.BackgroundTransparency = 1

	tween(dim, TweenInfo.new(0.16, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 0.45})
	tween(uiScale, TweenInfo.new(0.30, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Scale = targetScale})
	tween(group, TweenInfo.new(0.22, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {GroupTransparency = 0})

	task.delay(0.30, function()
		busy = false
	end)
end

local function closeUI()
	if busy or not isOpen then return end
	busy = true
	isOpen = false

	tween(dim, TweenInfo.new(0.14, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {BackgroundTransparency = 1})
	tween(uiScale, TweenInfo.new(0.22, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {Scale = targetScale * 0.94})
	tween(group, TweenInfo.new(0.16, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {GroupTransparency = 1})

	task.delay(0.22, function()
		if not isOpen then
			group.Visible = false
			dim.Visible = false
		end
		busy = false
	end)
end

toggleEvent.Event:Connect(function(open: boolean?)
	if open == nil then
		if isOpen then
			closeUI()
		else
			openUI()
		end
		return
	end
	if open then
		openUI()
	else
		closeUI()
	end
end)

-- close hooks
closeBtn.MouseButton1Click:Connect(function()
	click()
	closeUI()
end)

if CLOSE_ON_DIM_CLICK then
	dim.MouseButton1Click:Connect(function()
		click()
		closeUI()
	end)
end

if CLOSE_WITH_ESC then
	UserInputService.InputBegan:Connect(function(input, gp)
		if gp then return end
		if not isOpen then return end
		if input.KeyCode == Enum.KeyCode.Escape then
			click()
			closeUI()
		end
	end)
end

--//////////////////////////////////////////////////////////
-- OPEN BUTTON HOOK
--//////////////////////////////////////////////////////////
local hooked = false
local function tryHookOpenButton()
	if hooked then return end
	for _, name in ipairs(OPEN_BUTTON_NAMES) do
		local openBtn = gui:FindFirstChild(name, true)
			or playerGui:FindFirstChild(name, true)
		if openBtn and openBtn:IsA("GuiButton") then
			hooked = true
			openBtn.MouseButton1Click:Connect(function()
				click()
				openUI()
			end)
		end
	end
end

tryHookOpenButton()
playerGui.DescendantAdded:Connect(function()
	if not hooked then
		tryHookOpenButton()
	end
end)
gui.DescendantAdded:Connect(function()
	if not hooked then
		tryHookOpenButton()
	end
end)

--//////////////////////////////////////////////////////////
-- CATALOG REFRESH
--//////////////////////////////////////////////////////////
if CatalogFolder then
	CatalogFolder.ChildAdded:Connect(function()
		COLLECTABLES = getCollectablesCatalog()
		renderCollectables()
		countProgress()
	end)
	CatalogFolder.ChildRemoved:Connect(function()
		COLLECTABLES = getCollectablesCatalog()
		renderCollectables()
		countProgress()
	end)
end

--//////////////////////////////////////////////////////////
-- INITIAL RENDER + DEFAULT STATE
--//////////////////////////////////////////////////////////
renderCollectables()
renderTitles()
countProgress()

task.defer(function()
	task.wait()
	setUnderlineTo(tabButtons.Overview)
	jumpToTab("Overview")
end)

closeUI() -- start closed

print("[PlayerCardUi] Elite Tabs Profile Hub running. (V3: Overview/Collectables/Titles)")]]></ProtectedString>
						<bool name="Disabled">false</bool>
						<Content name="LinkedSource"><null></null></Content>
						<token name="RunContext">0</token>
						<string name="ScriptGuid">{FBD0DFF3-6260-4817-9CE3-FAFEE652CE0F}</string>
						<BinaryString name="AttributesSerialize"></BinaryString>
						<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
						<bool name="DefinesCapabilities">false</bool>
						<string name="Name">PlayerCardUi</string>
						<int64 name="SourceAssetId">-1</int64>
						<BinaryString name="Tags"></BinaryString>
					</Properties>
				</Item>
				<Item class="ImageButton" referent="RBXAF45E3CDF5DB43ECA2AD4B564686A7F0">
					<Properties>
						<Content name="HoverImage"><null></null></Content>
						<Content name="Image"><url>rbxassetid://1249556329</url></Content>
						<Color3 name="ImageColor3">
							<R>1</R>
							<G>1</G>
							<B>1</B>
						</Color3>
						<Vector2 name="ImageRectOffset">
							<X>0</X>
							<Y>0</Y>
						</Vector2>
						<Vector2 name="ImageRectSize">
							<X>0</X>
							<Y>0</Y>
						</Vector2>
						<float name="ImageTransparency">0</float>
						<Content name="PressedImage"><null></null></Content>
						<token name="ResampleMode">0</token>
						<token name="ScaleType">0</token>
						<Rect2D name="SliceCenter">
							<min>
								<X>0</X>
								<Y>0</Y>
							</min>
							<max>
								<X>0</X>
								<Y>0</Y>
							</max>
						</Rect2D>
						<float name="SliceScale">1</float>
						<UDim2 name="TileSize">
							<XS>1</XS>
							<XO>0</XO>
							<YS>1</YS>
							<YO>0</YO>
						</UDim2>
						<bool name="AutoButtonColor">true</bool>
						<Ref name="HoverHapticEffect">null</Ref>
						<bool name="Modal">false</bool>
						<Ref name="PressHapticEffect">null</Ref>
						<bool name="Selected">false</bool>
						<token name="Style">0</token>
						<bool name="Active">true</bool>
						<Vector2 name="AnchorPoint">
							<X>0</X>
							<Y>0</Y>
						</Vector2>
						<token name="AutomaticSize">0</token>
						<Color3 name="BackgroundColor3">
							<R>1</R>
							<G>1</G>
							<B>1</B>
						</Color3>
						<float name="BackgroundTransparency">1</float>
						<Color3 name="BorderColor3">
							<R>0</R>
							<G>0</G>
							<B>0</B>
						</Color3>
						<token name="BorderMode">0</token>
						<int name="BorderSizePixel">0</int>
						<bool name="ClipsDescendants">false</bool>
						<bool name="Draggable">false</bool>
						<bool name="Interactable">true</bool>
						<int name="LayoutOrder">0</int>
						<Ref name="NextSelectionDown">null</Ref>
						<Ref name="NextSelectionLeft">null</Ref>
						<Ref name="NextSelectionRight">null</Ref>
						<Ref name="NextSelectionUp">null</Ref>
						<UDim2 name="Position">
							<XS>0.0581249557</XS>
							<XO>0</XO>
							<YS>0.919275105</YS>
							<YO>0</YO>
						</UDim2>
						<float name="Rotation">0</float>
						<bool name="Selectable">true</bool>
						<Ref name="SelectionImageObject">null</Ref>
						<int name="SelectionOrder">0</int>
						<UDim2 name="Size">
							<XS>0.03629601</XS>
							<XO>0</XO>
							<YS>0.0777594745</YS>
							<YO>0</YO>
						</UDim2>
						<token name="SizeConstraint">0</token>
						<bool name="Visible">true</bool>
						<int name="ZIndex">1</int>
						<bool name="AutoLocalize">true</bool>
						<Ref name="RootLocalizationTable">null</Ref>
						<token name="SelectionBehaviorDown">0</token>
						<token name="SelectionBehaviorLeft">0</token>
						<token name="SelectionBehaviorRight">0</token>
						<token name="SelectionBehaviorUp">0</token>
						<bool name="SelectionGroup">false</bool>
						<BinaryString name="AttributesSerialize"></BinaryString>
						<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
						<bool name="DefinesCapabilities">false</bool>
						<string name="Name">PlayerCardButton</string>
						<int64 name="SourceAssetId">-1</int64>
						<BinaryString name="Tags"></BinaryString>
					</Properties>
				</Item>
			</Item>
			<Item class="ScreenGui" referent="RBXB9ECCC8E2804431CB2EB61CE8EBF190B">
				<Properties>
					<bool name="ClipToDeviceSafeArea">true</bool>
					<int name="DisplayOrder">0</int>
					<token name="SafeAreaCompatibility">1</token>
					<token name="ScreenInsets">2</token>
					<bool name="Enabled">true</bool>
					<bool name="ResetOnSpawn">true</bool>
					<token name="ZIndexBehavior">1</token>
					<bool name="AutoLocalize">true</bool>
					<Ref name="RootLocalizationTable">null</Ref>
					<token name="SelectionBehaviorDown">0</token>
					<token name="SelectionBehaviorLeft">0</token>
					<token name="SelectionBehaviorRight">0</token>
					<token name="SelectionBehaviorUp">0</token>
					<bool name="SelectionGroup">false</bool>
					<BinaryString name="AttributesSerialize"></BinaryString>
					<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
					<bool name="DefinesCapabilities">false</bool>
					<string name="Name">Shop</string>
					<int64 name="SourceAssetId">-1</int64>
					<BinaryString name="Tags"></BinaryString>
				</Properties>
				<Item class="LocalScript" referent="RBX7CB2E5AD15EA45EDB7F13888CE7F64D3">
					<Properties>
						<ProtectedString name="Source"><![CDATA[--// Ultra Clean Premium Shop UI (Client) - V2
--// Changes:
--//  1) Clicking empty UI NO LONGER closes the shop (only the close button / Esc)
--//  2) Close button is much fancier (glow, gradient, hover animation)
--//  3) Buy + Price area upgraded (premium action bar + price badge + CTA)
--//  4) Items panel now supports a configurable pattern background image:
--//        ShopConfig.ItemsPanelPatternImageId = "rbxassetid://...." (optional)
--//      Fallbacks: ShopConfig.BackgroundImageId

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local SoundService = game:GetService("SoundService")
local Lighting = game:GetService("Lighting")

local ShopConfig = require(ReplicatedStorage:WaitForChild("Configs"):WaitForChild("ShopConfig"))

local player = Players.LocalPlayer
local shopGui = script.Parent -- ScreenGui

local purchaseEvent = ReplicatedStorage:WaitForChild("ShopPurchase")
local resultEvent = ReplicatedStorage:WaitForChild("ShopPurchaseResult")

--========================
-- Theme
--========================
local UI = ShopConfig.UI or {}
local RARITIES = ShopConfig.Rarities or {}

local BUY = UI.BuyButton or {
	NormalColor = Color3.fromRGB(180,180,190),
	HoverColor = Color3.fromRGB(205,205,215),
	SuccessColor = Color3.fromRGB(80,180,80),
	FailColor = Color3.fromRGB(220,80,80),
	TextColor = Color3.fromRGB(40,40,45),
	SuccessTextColor = Color3.fromRGB(255,255,255),
	FailTextColor = Color3.fromRGB(255,255,255),
	CornerRadius = 12,
	StrokeTransparency = 0.72
}

local COLORS = {
	Primary   = UI.PrimaryColor or Color3.fromRGB(20,20,25),
	Secondary = UI.SecondaryColor or Color3.fromRGB(30,30,35),
	Tertiary  = UI.TertiaryColor or Color3.fromRGB(40,40,45),
	Card      = UI.CardColor or Color3.fromRGB(35,35,40),
	Text      = UI.TextColor or Color3.fromRGB(240,240,240),
	SubText   = UI.SecondaryTextColor or Color3.fromRGB(180,180,180),
	Price     = UI.PriceColor or Color3.fromRGB(255,200,100),
}

local TWEEN = UI.TweenSpeed or 0.22

local SHOP_NAME = ShopConfig.ShopName or "SHOP"
local SHOP_SUBTITLE = ShopConfig.ShopSubtitle or ""
local SHOP_KEYBIND = ShopConfig.ShopKeybind or Enum.KeyCode.B
local SHOP_KEYBIND_ENABLED = ShopConfig.EnableKeybind ~= false

-- Configurable pattern image for items panel:
local ITEMS_PATTERN_ID =
	ShopConfig.ItemsPanelPatternImageId
	or ShopConfig.BackgroundImageId
	or "rbxassetid://151822810"

--========================
-- State
--========================
local ui = {
	open = false,
	built = false,
	internalClosing = false,
	isPurchasing = false,
	selected = nil,
	cards = {},
	cardOrder = {},
	connections = {},
	blur = nil,
	AccentTween = nil,
}
local hasInitialized = false

--========================
-- Helpers
--========================
local function safeSetCore(tbl)
	pcall(function()
		StarterGui:SetCore("ChatMakeSystemMessage", tbl)
	end)
end

local function playSound(soundId)
	if not soundId or soundId == "" then return end
	local s = Instance.new("Sound")
	s.SoundId = soundId
	s.Volume = 0.5
	s.Parent = SoundService
	s:Play()
	s.Ended:Connect(function() s:Destroy() end)
end

local function rarityFor(item)
	local r = item and item.Rarity and RARITIES[item.Rarity]
	return r or RARITIES.Common or {StrokeColor = Color3.fromRGB(140,140,140), StrokeTransparency = 0.4}
end

local function new(className, props)
	local inst = Instance.new(className)
	for k, v in pairs(props or {}) do
		inst[k] = v
	end
	return inst
end

local function addCorner(parent, px)
	return new("UICorner", {CornerRadius = UDim.new(0, px), Parent = parent})
end

local function addStroke(parent, color, transparency, thickness)
	return new("UIStroke", {
		Color = color or Color3.fromRGB(255,255,255),
		Transparency = transparency ~= nil and transparency or 0.88,
		Thickness = thickness or 1,
		ApplyStrokeMode = Enum.ApplyStrokeMode.Border,
		Parent = parent
	})
end

local function addGradient(parent, c1, c2, rot)
	local g = new("UIGradient", {Rotation = rot or 90, Parent = parent})
	g.Color = ColorSequence.new(c1, c2)
	return g
end

local function tween(obj, info, props)
	local t = TweenService:Create(obj, info, props)
	t:Play()
	return t
end

local function disconnectAll()
	for _, c in ipairs(ui.connections) do
		pcall(function() c:Disconnect() end)
	end
	ui.connections = {}
end

local function stopAccentPulse()
	if ui.AccentTween then
		pcall(function()
			ui.AccentTween:Cancel()
		end)
		ui.AccentTween = nil
	end
	if ui.DetailsAccent then
		ui.DetailsAccent.BackgroundTransparency = 0.2
	end
end

local function startAccentPulse()
	stopAccentPulse()
	if ui.DetailsAccent then
		ui.DetailsAccent.BackgroundTransparency = 0.35
		ui.AccentTween = TweenService:Create(
			ui.DetailsAccent,
			TweenInfo.new(1.6, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
			{BackgroundTransparency = 0.15}
		)
		ui.AccentTween:Play()
	end
end

local function clearUI()
	if ui.Root and ui.Root.Parent then
		ui.Root:Destroy()
	end
	ui.Root = nil
	ui.Main = nil
	ui.Left = nil
	ui.Right = nil
	ui.ItemsScroll = nil
	ui.CashLabel = nil
	ui.SearchBox = nil
	ui.DetailsTop = nil
	ui.DetailsIcon = nil
	ui.DetailsName = nil
	ui.DetailsRarity = nil
	ui.DetailsDesc = nil
	ui.PriceValue = nil
	ui.BuyButton = nil
	ui.BuyGradient = nil
	ui.BuyScale = nil
	ui.CloseBtn = nil
	ui.CloseScale = nil
	ui.MainScale = nil
	ui.cards = {}
	ui.cardOrder = {}
	ui.selected = nil
	ui.built = false
end

local function setBlur(enabled)
	if not ui.blur then
		local existing = Lighting:FindFirstChild("ShopBlur")
		if existing and existing:IsA("BlurEffect") then
			ui.blur = existing
		else
			ui.blur = Instance.new("BlurEffect")
			ui.blur.Name = "ShopBlur"
			ui.blur.Size = 0
			ui.blur.Parent = Lighting
		end
	end

	local goal = enabled and 14 or 0
	tween(ui.blur, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = goal})

	if not enabled then
		task.delay(0.35, function()
			if ui.blur and ui.blur.Size <= 0.1 then
				ui.blur:Destroy()
				ui.blur = nil
			end
		end)
	end
end

local function getCashObject()
	local leaderstats = player:FindFirstChild("leaderstats") or player:WaitForChild("leaderstats", 10)
	if not leaderstats then return nil end
	return leaderstats:FindFirstChild("Cash") or leaderstats:WaitForChild("Cash", 10)
end

local function playerOwnsItem(toolName)
	if not toolName then return false end
	local backpack = player:FindFirstChild("Backpack")
	if backpack and backpack:FindFirstChild(toolName) then return true end
	local char = player.Character
	if char and char:FindFirstChild(toolName) then return true end
	return false
end

--========================
-- Close Request
--========================
local function requestClose()
	if ui.internalClosing then return end
	ui.internalClosing = true

	if ui.MainScale then
		tween(ui.MainScale, TweenInfo.new(0.16, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Scale = 0.975})
	end

	task.delay(0.16, function()
		stopAccentPulse()
		setBlur(false)
		disconnectAll()
		clearUI()
		ui.open = false
		ui.internalClosing = false
		shopGui.Enabled = false
	end)
end

--========================
-- UI Build
--========================
local function buildUI()
	if ui.built then return end

	disconnectAll()
	clearUI()

	-- Root: fully transparent (no dim overlay)
	ui.Root = new("Frame", {
		Name = "ShopRoot",
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		Size = UDim2.fromScale(1, 1),
		Parent = shopGui
	})

	-- Click-blocker overlay (DOES NOT CLOSE)
	-- Active=true so it eats clicks and prevents interacting with world, but we don't close on click.
	local clickBlocker = new("Frame", {
		Name = "ClickBlocker",
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		Size = UDim2.fromScale(1, 1),
		Active = true,
		Parent = ui.Root
	})

	-- Main panel (solid)
	ui.Main = new("Frame", {
		Name = "Main",
		AnchorPoint = Vector2.new(0.5, 0.5),
		Position = UDim2.fromScale(0.5, 0.5),
		Size = UDim2.new(0.86, 0, 0.76, 0),
		BackgroundColor3 = COLORS.Primary,
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		ZIndex = 5,
		Parent = ui.Root
	})
	addCorner(ui.Main, 22)
	addStroke(ui.Main, Color3.fromRGB(255,255,255), 0.88, 1)
	addGradient(ui.Main, COLORS.Primary, COLORS.Secondary, 135)

	new("UISizeConstraint", {
		MinSize = Vector2.new(760, 460),
		MaxSize = Vector2.new(1200, 720),
		Parent = ui.Main
	})

	ui.MainScale = new("UIScale", {Scale = 0.975, Parent = ui.Main})

	-- Header
	local header = new("Frame", {
		Name = "Header",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -32, 0, 72),
		Position = UDim2.new(0, 16, 0, 14),
		Parent = ui.Main
	})

	new("TextLabel", {
		Name = "Title",
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 420, 0, 34),
		Position = UDim2.new(0, 0, 0, 0),
		Text = SHOP_NAME,
		TextColor3 = COLORS.Text,
		Font = Enum.Font.GothamBlack,
		TextSize = 28,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = header
	})

	new("TextLabel", {
		Name = "Subtitle",
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 520, 0, 18),
		Position = UDim2.new(0, 0, 0, 36),
		Text = SHOP_SUBTITLE,
		TextColor3 = COLORS.SubText,
		Font = Enum.Font.GothamMedium,
		TextSize = 14,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = header
	})

	-- Cash pill
	local cashPill = new("Frame", {
		Name = "CashPill",
		AnchorPoint = Vector2.new(1, 0.5),
		Position = UDim2.new(1, -72, 0.5, 0),
		Size = UDim2.new(0, 220, 0, 42),
		BackgroundColor3 = COLORS.Secondary,
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		Parent = header
	})
	addCorner(cashPill, 999)
	addStroke(cashPill, Color3.fromRGB(255,255,255), 0.9, 1)
	addGradient(cashPill, COLORS.Secondary, COLORS.Tertiary, 45)

	new("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 28, 1, 0),
		Position = UDim2.new(0, 12, 0, 0),
		Text = "$",
		TextColor3 = COLORS.Price,
		Font = Enum.Font.GothamBlack,
		TextSize = 18,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = cashPill
	})

	ui.CashLabel = new("TextLabel", {
		Name = "Cash",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -50, 1, 0),
		Position = UDim2.new(0, 38, 0, 0),
		Text = "0",
		TextColor3 = COLORS.Text,
		Font = Enum.Font.GothamBold,
		TextSize = 16,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = cashPill
	})

	--========================
	-- FANCY CLOSE BUTTON
	--========================
	local closeOuter = new("Frame", {
		Name = "CloseOuter",
		AnchorPoint = Vector2.new(1, 0.5),
		Position = UDim2.new(1, -10, 0.5, 0),
		Size = UDim2.new(0, 46, 0, 46),
		BackgroundColor3 = Color3.fromRGB(18,18,22),
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		Parent = header
	})
	addCorner(closeOuter, 999)
	addStroke(closeOuter, Color3.fromRGB(255,255,255), 0.9, 1)

	-- subtle glow ring
	local glowRing = new("Frame", {
		Name = "GlowRing",
		AnchorPoint = Vector2.new(0.5,0.5),
		Position = UDim2.fromScale(0.5,0.5),
		Size = UDim2.new(1, 10, 1, 10),
		BackgroundColor3 = Color3.fromRGB(255,255,255),
		BackgroundTransparency = 0.92,
		BorderSizePixel = 0,
		ZIndex = closeOuter.ZIndex - 1,
		Parent = closeOuter
	})
	addCorner(glowRing, 999)
	addGradient(glowRing, Color3.fromRGB(255,255,255), Color3.fromRGB(160,160,200), 45)

	ui.CloseBtn = new("TextButton", {
		Name = "Close",
		AnchorPoint = Vector2.new(0.5, 0.5),
		Position = UDim2.fromScale(0.5, 0.5),
		Size = UDim2.new(1, -6, 1, -6),
		Text = "‚úï",
		TextColor3 = COLORS.Text,
		Font = Enum.Font.GothamBlack,
		TextSize = 18,
		BackgroundColor3 = Color3.fromRGB(40,40,48),
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		AutoButtonColor = false,
		Parent = closeOuter
	})
	addCorner(ui.CloseBtn, 999)
	addStroke(ui.CloseBtn, Color3.fromRGB(255,255,255), 0.88, 1)
	local closeGrad = addGradient(ui.CloseBtn, Color3.fromRGB(45,45,55), Color3.fromRGB(25,25,30), 135)
	ui.CloseScale = new("UIScale", {Scale = 1, Parent = ui.CloseBtn})

	table.insert(ui.connections, ui.CloseBtn.MouseButton1Click:Connect(requestClose))

	table.insert(ui.connections, ui.CloseBtn.MouseEnter:Connect(function()
		tween(ui.CloseScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1.06})
		tween(glowRing, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 0.86})
		closeGrad.Rotation = 160
	end))
	table.insert(ui.connections, ui.CloseBtn.MouseLeave:Connect(function()
		tween(ui.CloseScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1})
		tween(glowRing, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {BackgroundTransparency = 0.92})
		closeGrad.Rotation = 135
	end))

	-- Optional ESC close (feels premium)
	table.insert(ui.connections, UserInputService.InputBegan:Connect(function(input, gp)
		if gp then return end
		if not ui.open then return end
		if input.KeyCode == Enum.KeyCode.Escape then
			requestClose()
		end
	end))

	-- Body
	local body = new("Frame", {
		Name = "Body",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -32, 1, -110),
		Position = UDim2.new(0, 16, 0, 92),
		Parent = ui.Main
	})

	-- Left panel
	ui.Left = new("Frame", {
		Name = "Left",
		BackgroundColor3 = Color3.fromRGB(14,14,18),
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		Size = UDim2.new(0.62, 0, 1, 0),
		Parent = body
	})
	addCorner(ui.Left, 18)
	addStroke(ui.Left, Color3.fromRGB(255,255,255), 0.92, 1)
	addGradient(ui.Left, Color3.fromRGB(14,14,18), Color3.fromRGB(22,22,28), 135)

	-- Pattern background (configurable)
	local tilePx =
		tonumber(ShopConfig.ItemsPanelPatternTileSize)
		or tonumber(UI.ItemsPanelPatternTileSize)
		or 90 -- default (smaller = more pattern)

	tilePx = math.clamp(tilePx, 24, 512)

	local pattern = new("ImageLabel", {
		Name = "ItemsPattern",
		BackgroundTransparency = 1,
		Size = UDim2.fromScale(1,1),
		Position = UDim2.fromScale(0,0),
		Image = ITEMS_PATTERN_ID,
		ImageTransparency = tonumber(ShopConfig.ItemsPanelPatternTransparency) or 0.94,
		ScaleType = Enum.ScaleType.Tile,
		TileSize = UDim2.new(0, tilePx, 0, tilePx),
		ZIndex = 1,
		Parent = ui.Left
	})
	addCorner(pattern, 18)

	addCorner(pattern, 18)

	-- Right panel
	ui.Right = new("Frame", {
		Name = "Right",
		BackgroundColor3 = Color3.fromRGB(14,14,18),
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		Size = UDim2.new(0.38, -12, 1, 0),
		Position = UDim2.new(0.62, 12, 0, 0),
		Parent = body
	})
	addCorner(ui.Right, 18)
	addStroke(ui.Right, Color3.fromRGB(255,255,255), 0.92, 1)
	addGradient(ui.Right, Color3.fromRGB(14,14,18), Color3.fromRGB(24,24,30), 135)

	-- Search
	local searchWrap = new("Frame", {
		Name = "SearchWrap",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -24, 0, 46),
		Position = UDim2.new(0, 12, 0, 12),
		ZIndex = 10,
		Parent = ui.Left
	})

	local searchBg = new("Frame", {
		Name = "SearchBg",
		BackgroundColor3 = COLORS.Secondary,
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 1, 0),
		ZIndex = 10,
		Parent = searchWrap
	})
	addCorner(searchBg, 14)
	addStroke(searchBg, Color3.fromRGB(255,255,255), 0.92, 1)

	new("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 34, 1, 0),
		Position = UDim2.new(0, 12, 0, 0),
		Text = "‚åï",
		TextColor3 = COLORS.SubText,
		Font = Enum.Font.GothamBold,
		TextSize = 18,
		TextXAlignment = Enum.TextXAlignment.Left,
		ZIndex = 11,
		Parent = searchBg
	})

	ui.SearchBox = new("TextBox", {
		Name = "Search",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -52, 1, 0),
		Position = UDim2.new(0, 38, 0, 0),
		PlaceholderText = "Search items...",
		Text = "",
		ClearTextOnFocus = false,
		TextColor3 = COLORS.Text,
		PlaceholderColor3 = COLORS.SubText,
		Font = Enum.Font.GothamMedium,
		TextSize = 14,
		TextXAlignment = Enum.TextXAlignment.Left,
		ZIndex = 11,
		Parent = searchBg
	})

	-- Items scroll
	ui.ItemsScroll = new("ScrollingFrame", {
		Name = "Items",
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		Size = UDim2.new(1, -24, 1, -76),
		Position = UDim2.new(0, 12, 0, 66),
		ScrollBarThickness = 6,
		ScrollBarImageColor3 = Color3.fromRGB(70,70,78),
		ZIndex = 10,
		Parent = ui.Left
	})

	local grid = new("UIGridLayout", {
		CellSize = UI.CardSize or UDim2.new(0, 210, 0, 250),
		CellPadding = UDim2.new(0, 14, 0, 14),
		SortOrder = Enum.SortOrder.LayoutOrder,
		Parent = ui.ItemsScroll
	})

	new("UIPadding", {
		PaddingTop = UDim.new(0, 6),
		PaddingLeft = UDim.new(0, 6),
		PaddingRight = UDim.new(0, 6),
		PaddingBottom = UDim.new(0, 10),
		Parent = ui.ItemsScroll
	})

	--========================
	-- DETAILS: TOP + ACTION BAR
	--========================
	local rightPad = new("Frame", {
		Name = "RightPad",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -28, 1, -28),
		Position = UDim2.new(0, 14, 0, 14),
		Parent = ui.Right
	})

	-- Action bar (premium)
	local actionBar = new("Frame", {
		Name = "ActionBar",
		AnchorPoint = Vector2.new(0,1),
		Position = UDim2.new(0, 0, 1, 0),
		Size = UDim2.new(1, 0, 0, 96),
		BackgroundColor3 = Color3.fromRGB(18,18,22),
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		Parent = rightPad
	})
	addCorner(actionBar, 18)
	addStroke(actionBar, Color3.fromRGB(255,255,255), 0.92, 1)
	addGradient(actionBar, Color3.fromRGB(22,22,28), Color3.fromRGB(14,14,18), 135)

	-- Price badge (clean + premium)
	local priceBadge = new("Frame", {
		Name = "PriceBadge",
		Position = UDim2.new(0, 12, 0, 14),
		Size = UDim2.new(0, 140, 0, 34),
		BackgroundColor3 = Color3.fromRGB(28,28,34),
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		Parent = actionBar
	})
	addCorner(priceBadge, 999)
	addStroke(priceBadge, Color3.fromRGB(255,255,255), 0.9, 1)

	new("TextLabel", {
		BackgroundTransparency = 1,
		Size = UDim2.new(0, 24, 1, 0),
		Position = UDim2.new(0, 10, 0, 0),
		Text = "$",
		TextColor3 = COLORS.Price,
		Font = Enum.Font.GothamBlack,
		TextSize = 16,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = priceBadge
	})

	ui.PriceValue = new("TextLabel", {
		Name = "PriceValue",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, -36, 1, 0),
		Position = UDim2.new(0, 28, 0, 0),
		Text = "0",
		TextColor3 = COLORS.Text,
		Font = Enum.Font.GothamBold,
		TextSize = 16,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = priceBadge
	})

	-- CTA Buy button (premium)
	ui.BuyButton = new("TextButton", {
		Name = "BuyButton",
		AnchorPoint = Vector2.new(1,1),
		Position = UDim2.new(1, -12, 1, -12),
		Size = UDim2.new(1, -(12+140+12+12), 0, 52), -- fills to right of price badge
		BackgroundColor3 = BUY.NormalColor,
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		Text = "BUY",
		TextColor3 = BUY.TextColor,
		Font = Enum.Font.GothamBlack,
		TextSize = 16,
		AutoButtonColor = false,
		Parent = actionBar
	})
	addCorner(ui.BuyButton, 14)
	addStroke(ui.BuyButton, Color3.fromRGB(255,255,255), BUY.StrokeTransparency or 0.75, 1)
	ui.BuyGradient = addGradient(ui.BuyButton, BUY.NormalColor, Color3.fromRGB(155,155,170), 45)
	ui.BuyScale = new("UIScale", {Scale = 1, Parent = ui.BuyButton})

	-- subtle inner shine
	local shine = new("Frame", {
		Name = "Shine",
		BackgroundColor3 = Color3.fromRGB(255,255,255),
		BackgroundTransparency = 0.92,
		BorderSizePixel = 0,
		Size = UDim2.new(1, -16, 0, 10),
		Position = UDim2.new(0, 8, 0, 8),
		Parent = ui.BuyButton
	})
	addCorner(shine, 999)
	addGradient(shine, Color3.fromRGB(255,255,255), Color3.fromRGB(255,255,255), 0)

	-- Hover micro animation for buy button
	table.insert(ui.connections, ui.BuyButton.MouseEnter:Connect(function()
		if ui.BuyButton.Active then
			tween(ui.BuyScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1.03})
			if ui.BuyGradient then
				ui.BuyGradient.Color = ColorSequence.new(BUY.HoverColor, Color3.fromRGB(180,180,195))
			end
		end
	end))
	table.insert(ui.connections, ui.BuyButton.MouseLeave:Connect(function()
		if ui.BuyScale then
			tween(ui.BuyScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1})
		end
		if ui.selected then
			-- restore normal gradient based on state
			-- (applyBuyState will set it properly)
		end
	end))

	-- Top scroll area
	ui.DetailsTop = new("ScrollingFrame", {
		Name = "Top",
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 1, -106),
		Position = UDim2.new(0, 0, 0, 0),
		ScrollBarThickness = 4,
		ScrollBarImageColor3 = Color3.fromRGB(70,70,78),
		Parent = rightPad
	})

	local topLayout = new("UIListLayout", {
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 10),
		Parent = ui.DetailsTop
	})

	new("UIPadding", {
		PaddingTop = UDim.new(0, 0),
		PaddingLeft = UDim.new(0, 0),
		PaddingRight = UDim.new(0, 0),
		PaddingBottom = UDim.new(0, 10),
		Parent = ui.DetailsTop
	})

	ui.DetailsAccent = new("Frame", {
		Name = "Accent",
		Size = UDim2.new(1, 0, 0, 4),
		BackgroundColor3 = Color3.fromRGB(255,255,255),
		BackgroundTransparency = 0.2,
		BorderSizePixel = 0,
		LayoutOrder = 1,
		Parent = ui.DetailsTop
	})
	addCorner(ui.DetailsAccent, 999)

	local iconWrap = new("Frame", {
		Name = "IconWrap",
		Size = UDim2.new(1, 0, 0, 220),
		BackgroundColor3 = COLORS.Secondary,
		BackgroundTransparency = 0,
		BorderSizePixel = 0,
		LayoutOrder = 2,
		Parent = ui.DetailsTop
	})
	addCorner(iconWrap, 16)
	addStroke(iconWrap, Color3.fromRGB(255,255,255), 0.92, 1)
	addGradient(iconWrap, COLORS.Secondary, COLORS.Tertiary, 135)

	ui.DetailsIcon = new("ImageLabel", {
		Name = "Icon",
		BackgroundTransparency = 1,
		AnchorPoint = Vector2.new(0.5, 0.5),
		Position = UDim2.fromScale(0.5, 0.5),
		Size = UDim2.new(0, 150, 0, 150),
		ScaleType = Enum.ScaleType.Fit,
		Image = "",
		Parent = iconWrap
	})

	ui.DetailsName = new("TextLabel", {
		Name = "Name",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 32),
		Text = "Select an item",
		TextColor3 = COLORS.Text,
		Font = Enum.Font.GothamBlack,
		TextSize = 22,
		TextXAlignment = Enum.TextXAlignment.Left,
		LayoutOrder = 3,
		Parent = ui.DetailsTop
	})

	ui.DetailsRarity = new("TextLabel", {
		Name = "Rarity",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 18),
		Text = "",
		TextColor3 = COLORS.SubText,
		Font = Enum.Font.GothamBold,
		TextSize = 12,
		TextXAlignment = Enum.TextXAlignment.Left,
		LayoutOrder = 4,
		Parent = ui.DetailsTop
	})

	ui.DetailsDesc = new("TextLabel", {
		Name = "Desc",
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 0, 0),
		AutomaticSize = Enum.AutomaticSize.Y,
		Text = "Pick something on the left to see details.",
		TextColor3 = COLORS.SubText,
		Font = Enum.Font.GothamMedium,
		TextSize = 14,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextYAlignment = Enum.TextYAlignment.Top,
		TextWrapped = true,
		LayoutOrder = 5,
		Parent = ui.DetailsTop
	})

	-- Canvas autos
	table.insert(ui.connections, topLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		if ui.DetailsTop then
			ui.DetailsTop.CanvasSize = UDim2.new(0, 0, 0, topLayout.AbsoluteContentSize.Y + 10)
		end
	end))
	table.insert(ui.connections, grid:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		if ui.ItemsScroll then
			ui.ItemsScroll.CanvasSize = UDim2.new(0, 0, 0, grid.AbsoluteContentSize.Y + 10)
		end
	end))

	ui.built = true
end

--========================
-- Details / Buy State
--========================
local function applyBuyState(item, forceText)
	if not ui.BuyButton or not ui.BuyGradient then return end

	if not item then
		ui.BuyButton.Text = "BUY"
		ui.BuyButton.Active = false
		ui.BuyButton.BackgroundColor3 = BUY.NormalColor
		ui.BuyButton.TextColor3 = BUY.TextColor
		ui.BuyGradient.Color = ColorSequence.new(BUY.NormalColor, Color3.fromRGB(155,155,170))
		return
	end

	local owned = playerOwnsItem(item.ToolName)
	if owned then
		ui.BuyButton.Text = "‚úì OWNED"
		ui.BuyButton.Active = false
		ui.BuyButton.BackgroundColor3 = BUY.SuccessColor
		ui.BuyButton.TextColor3 = BUY.SuccessTextColor
		ui.BuyGradient.Color = ColorSequence.new(BUY.SuccessColor, Color3.fromRGB(60,140,60))
		return
	end

	ui.BuyButton.Text = forceText or "BUY"
	ui.BuyButton.Active = true
	ui.BuyButton.BackgroundColor3 = BUY.NormalColor
	ui.BuyButton.TextColor3 = BUY.TextColor
	ui.BuyGradient.Color = ColorSequence.new(BUY.NormalColor, Color3.fromRGB(155,155,170))
end

local function setSelected(item)
	ui.selected = item
	if not item then return end

	local r = rarityFor(item)

	if ui.DetailsAccent then ui.DetailsAccent.BackgroundColor3 = r.StrokeColor end
	if ui.DetailsIcon then ui.DetailsIcon.Image = item.ImageId or "" end
	if ui.DetailsName then ui.DetailsName.Text = item.DisplayName or item.ToolName or "Item" end
	if ui.DetailsRarity then
		ui.DetailsRarity.Text = (item.Rarity and item.Rarity:upper()) or ""
		ui.DetailsRarity.TextColor3 = r.StrokeColor
	end
	if ui.DetailsDesc then ui.DetailsDesc.Text = item.Description or "" end
	if ui.PriceValue then ui.PriceValue.Text = tostring(item.Price or 0) end

	applyBuyState(item)
end

--========================
-- Items Render
--========================
local function renderItems()
	ui.cards = {}
	ui.cardOrder = {}
	if not ui.ItemsScroll then return end

	for i, item in ipairs(ShopConfig.Items or {}) do
		local r = rarityFor(item)

		local card = new("Frame", {
			Name = "Card_" .. tostring(item.ToolName or i),
			BackgroundColor3 = COLORS.Card,
			BackgroundTransparency = 0,
			BorderSizePixel = 0,
			LayoutOrder = i,
			ZIndex = 12,
			Parent = ui.ItemsScroll
		})
		addCorner(card, 18)
		addStroke(card, r.StrokeColor, r.StrokeTransparency or 0.6, 1)
		addGradient(card, COLORS.Card, COLORS.Secondary, 135)

		local cardScale = new("UIScale", {Scale = 0.94, Parent = card})

		local iconWrap = new("Frame", {
			BackgroundColor3 = COLORS.Secondary,
			BackgroundTransparency = 0,
			BorderSizePixel = 0,
			Size = UDim2.new(1, -16, 0, 140),
			Position = UDim2.new(0, 8, 0, 8),
			ZIndex = 13,
			Parent = card
		})
		addCorner(iconWrap, 14)
		addStroke(iconWrap, Color3.fromRGB(255,255,255), 0.92, 1)

		new("ImageLabel", {
			BackgroundTransparency = 1,
			AnchorPoint = Vector2.new(0.5,0.5),
			Position = UDim2.fromScale(0.5,0.5),
			Size = UDim2.new(0, 110, 0, 110),
			Image = item.ImageId or "",
			ScaleType = Enum.ScaleType.Fit,
			ZIndex = 14,
			Parent = iconWrap
		})

		new("TextLabel", {
			BackgroundTransparency = 1,
			Size = UDim2.new(1, -16, 0, 22),
			Position = UDim2.new(0, 8, 0, 156),
			Text = item.DisplayName or item.ToolName or "Item",
			TextColor3 = COLORS.Text,
			Font = Enum.Font.GothamBlack,
			TextSize = 16,
			TextXAlignment = Enum.TextXAlignment.Left,
			ZIndex = 13,
			Parent = card
		})

		new("TextLabel", {
			BackgroundTransparency = 1,
			Size = UDim2.new(1, -16, 0, 18),
			Position = UDim2.new(0, 8, 0, 178),
			Text = "$" .. tostring(item.Price or 0),
			TextColor3 = COLORS.Price,
			Font = Enum.Font.GothamBold,
			TextSize = 13,
			TextXAlignment = Enum.TextXAlignment.Left,
			ZIndex = 13,
			Parent = card
		})

		new("TextLabel", {
			BackgroundTransparency = 1,
			AnchorPoint = Vector2.new(1,0),
			Position = UDim2.new(1, -10, 0, 10),
			Size = UDim2.new(0, 92, 0, 22),
			Text = (item.Rarity and item.Rarity:upper()) or "COMMON",
			TextColor3 = r.StrokeColor,
			Font = Enum.Font.GothamBlack,
			TextSize = 11,
			TextXAlignment = Enum.TextXAlignment.Right,
			ZIndex = 14,
			Parent = card
		})

		local viewBtn = new("TextButton", {
			Name = "View",
			AnchorPoint = Vector2.new(1,1),
			Position = UDim2.new(1, -10, 1, -10),
			Size = UDim2.new(0, 84, 0, 30),
			BackgroundColor3 = COLORS.Secondary,
			BackgroundTransparency = 0,
			BorderSizePixel = 0,
			Text = "VIEW",
			TextColor3 = COLORS.Text,
			Font = Enum.Font.GothamBlack,
			TextSize = 12,
			AutoButtonColor = false,
			ZIndex = 14,
			Parent = card
		})
		addCorner(viewBtn, 12)
		addStroke(viewBtn, Color3.fromRGB(255,255,255), 0.9, 1)
		addGradient(viewBtn, COLORS.Secondary, COLORS.Tertiary, 45)
		local viewScale = new("UIScale", {Scale = 1, Parent = viewBtn})

		local function select()
			setSelected(item)
		end

		table.insert(ui.connections, viewBtn.MouseButton1Click:Connect(function()
			-- Play hover sound on click only if PlayOnClick is true
			if ShopConfig.Sounds and ShopConfig.Sounds.PlayOnClick then
				playSound(ShopConfig.Sounds.HoverSound)
			end
			select()
		end))
		table.insert(ui.connections, card.InputBegan:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				-- Play hover sound on click only if PlayOnClick is true
				if ShopConfig.Sounds and ShopConfig.Sounds.PlayOnClick then
					playSound(ShopConfig.Sounds.HoverSound)
				end
				select()
			end
		end))

		table.insert(ui.connections, card.MouseEnter:Connect(function()
			tween(cardScale, TweenInfo.new(0.14, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1.02})
			-- Play hover sound only if PlayOnHover is true
			if ShopConfig.Sounds and ShopConfig.Sounds.PlayOnHover then
				playSound(ShopConfig.Sounds.HoverSound)
			end
		end))
		table.insert(ui.connections, card.MouseLeave:Connect(function()
			tween(cardScale, TweenInfo.new(0.14, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1})
		end))
		table.insert(ui.connections, viewBtn.MouseEnter:Connect(function()
			tween(viewScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1.06})
		end))
		table.insert(ui.connections, viewBtn.MouseLeave:Connect(function()
			tween(viewScale, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Scale = 1})
		end))

		ui.cards[item.ToolName] = card
		table.insert(ui.cardOrder, {card = card, scale = cardScale})
	end
end

local function applySearchFilter(text)
	text = (text or ""):lower()
	for _, item in ipairs(ShopConfig.Items or {}) do
		local card = ui.cards[item.ToolName]
		if card then
			local hay = ((item.DisplayName or "") .. " " .. (item.ToolName or "") .. " " .. (item.Description or "")):lower()
			card.Visible = (text == "") or (hay:find(text, 1, true) ~= nil)
		end
	end
end

local function playOpenShake()
	for _, card in pairs(ui.cards) do
		if card and card.Parent then
			local offset = math.random(-4, 4)
			if offset == 0 then
				offset = 3
			end

			card.Rotation = offset
			tween(card, TweenInfo.new(0.08, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Rotation = -offset})

			task.delay(0.08, function()
				if card and card.Parent then
					tween(card, TweenInfo.new(0.12, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Rotation = 0})
				end
			end)
		end
	end
end

local function playCardEntrance()
	for index, entry in ipairs(ui.cardOrder) do
		local card = entry.card
		local scale = entry.scale
		if card and scale then
			local delayTime = math.min((index - 1) * 0.02, 0.3)
			task.delay(delayTime, function()
				if card and card.Parent and scale then
					tween(scale, TweenInfo.new(0.18, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Scale = 1})
				end
			end)
		end
	end
end

--========================
-- Purchase
--========================
local function bindBuyButton()
	if not ui.BuyButton then return end

	table.insert(ui.connections, ui.BuyButton.MouseButton1Click:Connect(function()
		if ui.isPurchasing then return end
		if not ui.selected then return end

		local toolName = ui.selected.ToolName
		if not toolName then return end

		if playerOwnsItem(toolName) then
			applyBuyState(ui.selected)
			return
		end

		ui.isPurchasing = true
		applyBuyState(ui.selected, "PURCHASING...")
		ui.BuyButton.Active = false

		purchaseEvent:FireServer(toolName)

		task.delay(4, function()
			if ui.isPurchasing then
				ui.isPurchasing = false
				if ui.selected and ui.selected.ToolName == toolName then
					applyBuyState(ui.selected, "BUY")
				end
			end
		end)
	end))
end

resultEvent.OnClientEvent:Connect(function(success, message, toolName)
	ui.isPurchasing = false

	if ui.selected and ui.selected.ToolName == toolName and ui.BuyButton then
		if success or playerOwnsItem(toolName) then
			playSound(ShopConfig.Sounds and ShopConfig.Sounds.SuccessSound)
			applyBuyState(ui.selected)
		else
			local msg = tostring(message or ""):lower()
			if msg:find("insufficient") or msg:find("fund") then
				playSound(ShopConfig.Sounds and ShopConfig.Sounds.FailSound)

				ui.BuyButton.BackgroundColor3 = BUY.FailColor
				ui.BuyButton.TextColor3 = BUY.FailTextColor
				if ui.BuyGradient then
					ui.BuyGradient.Color = ColorSequence.new(BUY.FailColor, Color3.fromRGB(180,60,60))
				end

				task.delay(0.55, function()
					if ui.selected and ui.selected.ToolName == toolName then
						applyBuyState(ui.selected)
					end
				end)
			else
				applyBuyState(ui.selected)
			end
		end
	end

	if success then
		safeSetCore({Text="[‚úÖ] "..tostring(message or "Purchase successful!"); Color=Color3.fromRGB(100,255,100); Font=Enum.Font.GothamBold})
	else
		safeSetCore({Text="[‚ùå] "..tostring(message or "Purchase failed."); Color=Color3.fromRGB(255,100,100); Font=Enum.Font.GothamBold})
	end
end)

--========================
-- Open / Close
--========================
local cashConn = nil
local humanoidConn = nil

local function openShop()
	if ui.open then return end
	ui.open = true

	buildUI()
	setBlur(true)

	tween(ui.MainScale, TweenInfo.new(0.22, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Scale = 1})

	renderItems()
	bindBuyButton()
	playOpenShake()
	playCardEntrance()
	startAccentPulse()

	if cashConn then cashConn:Disconnect() cashConn = nil end
	task.spawn(function()
		local cash = getCashObject()
		if not cash then return end
		if ui.CashLabel then ui.CashLabel.Text = tostring(cash.Value) end
		cashConn = cash.Changed:Connect(function()
			if ui.CashLabel then ui.CashLabel.Text = tostring(cash.Value) end
		end)
	end)

	if ui.SearchBox then
		table.insert(ui.connections, ui.SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
			applySearchFilter(ui.SearchBox.Text)
		end))
	end

	if ShopConfig.Items and ShopConfig.Items[1] then
		setSelected(ShopConfig.Items[1])
	end

	-- Play open sound
	playSound(ShopConfig.Sounds and ShopConfig.Sounds.OpenSound)
end

local function closeShopImmediate()
	if ui.open or ui.built then
		-- Play close sound
		playSound(ShopConfig.Sounds and ShopConfig.Sounds.CloseSound)
	end

	stopAccentPulse()
	setBlur(false)
	if cashConn then cashConn:Disconnect() cashConn = nil end
	disconnectAll()
	clearUI()
	ui.open = false
end

local function forceClose()
	ui.internalClosing = false
	ui.isPurchasing = false
	stopAccentPulse()
	setBlur(false)
	if cashConn then cashConn:Disconnect() cashConn = nil end
	disconnectAll()
	clearUI()
	ui.open = false
	if shopGui.Enabled then
		shopGui.Enabled = false
	end
end

local function onCharacterAdded(character)
	if humanoidConn then
		humanoidConn:Disconnect()
		humanoidConn = nil
	end

	local humanoid = character:FindFirstChildOfClass("Humanoid") or character:WaitForChild("Humanoid", 5)
	if humanoid then
		humanoidConn = humanoid.Died:Connect(function()
			forceClose()
		end)
	end

	if hasInitialized then
		forceClose()
	end
end

shopGui:GetPropertyChangedSignal("Enabled"):Connect(function()
	if shopGui.Enabled then
		openShop()
	else
		closeShopImmediate()
	end
end)

if SHOP_KEYBIND_ENABLED then
	UserInputService.InputBegan:Connect(function(input, gp)
		if gp then return end
		if UserInputService:GetFocusedTextBox() then return end
		if input.KeyCode ~= SHOP_KEYBIND then return end

		if ui.open then
			requestClose()
		else
			if shopGui.Enabled then
				openShop()
			else
				shopGui.Enabled = true
			end
		end
	end)
end

player.CharacterAdded:Connect(onCharacterAdded)
if player.Character then
	onCharacterAdded(player.Character)
end

hasInitialized = true

print("‚úÖ Premium ShopScript V2 initialized!")]]></ProtectedString>
						<bool name="Disabled">false</bool>
						<Content name="LinkedSource"><null></null></Content>
						<token name="RunContext">0</token>
						<string name="ScriptGuid">{6B2F740B-66E3-411E-923D-2FDEAF7BD582}</string>
						<BinaryString name="AttributesSerialize"></BinaryString>
						<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
						<bool name="DefinesCapabilities">false</bool>
						<string name="Name">ShopScript</string>
						<int64 name="SourceAssetId">-1</int64>
						<BinaryString name="Tags"></BinaryString>
					</Properties>
				</Item>
			</Item>
		</Item>
	</Item>
</roblox>